# DKonsole Configuration
# Only configure what you need. Leave the rest as default.

# -----------------------------------------------------------------------------
# 1. Authentication (OPTIONAL - Setup Mode Available)
# -----------------------------------------------------------------------------
# NEW: If you leave these values empty, DKonsole will start in "Setup Mode"
#      and you can configure the admin account through the web interface.
#      This is the recommended way for first-time installation.
#
#      To use Setup Mode:
#        - Leave admin.username, admin.passwordHash, and jwtSecret empty
#        - Deploy the Helm chart
#        - Access the web interface - it will show the setup page
#        - Complete the setup form to create the secret
#        - The pod will need to be restarted after setup (or it will auto-detect)
#
#      To use pre-configured credentials (traditional method):
#        - Set admin.username and admin.passwordHash (or passwordHashBase64)
#        - Optionally set jwtSecret (auto-generated if empty)
#        - The secret will be created during Helm install/upgrade
admin:
  # Username for the dashboard
  # Leave empty to use Setup Mode
  username: ""
  # Password hash (Argon2). Generate with:
  #   cd backend && go run ../scripts/generate-password-hash.go "yourpassword"
  # This generates a hash in the format that works with version 1.2.2:
  #   $argon2i$v=19$m=4096,t=3,p=1$salt$hash
  # Leave empty to use Setup Mode
  passwordHash: ""
  # RECOMMENDED: Use passwordHashBase64 instead of passwordHash when using --set
  # This avoids Helm parsing issues with special characters (commas, $, etc.)
  # To encode your hash: echo -n "$argon2i$v=19$m=4096,t=3,p=1$salt$hash" | base64
  # Or use: ./scripts/encode-hash.sh "$argon2i$v=19$m=4096,t=3,p=1$salt$hash"
  # Then use: --set admin.passwordHashBase64='<base64-encoded-hash>'
  # If passwordHashBase64 is set, it takes precedence over passwordHash
  # Leave empty to use Setup Mode
  passwordHashBase64: ""

# JWT Secret for session security. Generate with: openssl rand -base64 32
# Leave empty to use Setup Mode (will be auto-generated during setup)
jwtSecret: ""

# -----------------------------------------------------------------------------
# 2. Docker Image Configuration
# -----------------------------------------------------------------------------
image:
  repository: dkonsole/dkonsole
  tag: "1.2.6-test"  # Using test version for LoginHotFix branch
  pullPolicy: Always

# Image pull secrets (optional)
# Example: [{"name": "myregistrykey"}]
imagePullSecrets: []

# Name override for the release (optional)
nameOverride: ""

# Full name override for the release (optional)
fullnameOverride: ""

# -----------------------------------------------------------------------------
# 3. Service Account Configuration
# -----------------------------------------------------------------------------
serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

# -----------------------------------------------------------------------------
# 4. Pod Configuration
# -----------------------------------------------------------------------------
# Pod annotations (optional)
podAnnotations: {}

# Pod Security Context (Run as non-root user)
podSecurityContext:
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 2000

# Container Security Context (optional)
securityContext: {}

# -----------------------------------------------------------------------------
# 5. Ingress / External Access (REQUIRED for external access)
# -----------------------------------------------------------------------------
ingress:
  enabled: true
  className: "nginx"
  # Ingress annotations (e.g., for cert-manager)
  # Example:
  #   cert-manager.io/cluster-issuer: "letsencrypt-prod"
  #   nginx.ingress.kubernetes.io/ssl-redirect: "true"
  annotations: {}
  hosts:
    - host: dkonsole.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: dkonsole-tls
      hosts:
        - dkonsole.example.com

# Allowed Origins for WebSocket (CORS)
# Comma-separated list of allowed origins (e.g., "https://dkonsole.example.com,http://localhost:5173")
# If empty, only same-origin requests are allowed.
allowedOrigins: ""

# -----------------------------------------------------------------------------
# 6. Service Configuration
# -----------------------------------------------------------------------------
service:
  type: ClusterIP
  port: 8080

# -----------------------------------------------------------------------------
# 7. Replica Configuration
# -----------------------------------------------------------------------------
replicaCount: 1

# -----------------------------------------------------------------------------
# 8. Resource Limits and Requests
# -----------------------------------------------------------------------------
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# -----------------------------------------------------------------------------
# 9. Autoscaling Configuration (Optional)
# -----------------------------------------------------------------------------
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80

# -----------------------------------------------------------------------------
# 10. Node Selection and Scheduling
# -----------------------------------------------------------------------------
# Node selector (optional)
nodeSelector: {}

# Tolerations (optional)
tolerations: []

# Affinity rules (optional)
affinity: {}

# -----------------------------------------------------------------------------
# 11. Persistence (Optional - For custom logos)
# -----------------------------------------------------------------------------
persistence:
  enabled: true
  storageClass: "" # Specify a storage class name, or leave empty for default
  accessMode: ReadWriteOnce
  size: 1Gi

# -----------------------------------------------------------------------------
# 12. Prometheus Integration (Optional)
# -----------------------------------------------------------------------------
# Configure the Prometheus endpoint to enable historical metrics for Pods
# If not set, the Metrics tab will not be displayed in Pod details
# Example: "http://prometheus-server.monitoring.svc.cluster.local:9090"
# Features enabled:
#   - Historical CPU and memory metrics for Pods
#   - Time range selector (1h, 6h, 12h, 1d, 7d, 15d)
#   - Metrics tab in Pod details view
prometheusUrl: ""

# -----------------------------------------------------------------------------
# 13. RBAC Permissions (Required for dashboard functionality)
# -----------------------------------------------------------------------------
# FULL ACCESS to ALL resources (both cluster-scoped and namespaced) - allows importing ANY Kubernetes resource via YAML
rbac:
  create: true
  # Cluster-wide resources - FULL ACCESS to create/update/delete cluster-scoped resources
  # This allows importing ClusterRole, ClusterRoleBinding, PersistentVolume, StorageClass, etc.
  clusterResources:
    - apiGroups: ["*"]
      resources: ["*"]
      verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
  nonResourceURLs:
    - "*"
  # Namespaced resources - FULL ACCESS to all resources in all API groups
  # This allows importing ANY Kubernetes resource via YAML
  namespacedResources:
    - apiGroups: ["*"]
      resources: ["*"]
      verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
