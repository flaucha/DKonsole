# DKonsole Configuration
# Only configure what you need. Leave the rest as default.

# -----------------------------------------------------------------------------
# 1. Authentication (REQUIRED)
# -----------------------------------------------------------------------------
admin:
  # Username for the dashboard
  username: admin
  # Password hash (Argon2). Generate with:
  # echo -n "password" | argon2 $(openssl rand -base64 16) -id -t 3 -m 12 -p 1 -l 32 -e
  passwordHash: ""

# JWT Secret for session security. Generate with: openssl rand -base64 32
jwtSecret: ""

# -----------------------------------------------------------------------------
# 2. Ingress / External Access (REQUIRED for external access)
# -----------------------------------------------------------------------------
ingress:
  enabled: true
  className: "nginx"
  hosts:
    - host: dkonsole.example.com
      paths:
        - path: /api
          pathType: Prefix
          backend: backend
        - path: /
          pathType: Prefix
          backend: frontend
  tls:
    - secretName: dkonsole-tls
      hosts:
        - dkonsole.example.com

# Allowed Origins for WebSocket (CORS)
# Comma-separated list of allowed origins (e.g., "https://dkonsole.example.com,http://localhost:5173")
# If empty, only same-origin requests are allowed.
allowedOrigins: ""

# Pod Security Context (Run as non-root user 'app' uid 1000)
podSecurityContext:
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

# -----------------------------------------------------------------------------
# 3. Docker Images (Optional - Defaults to official images)
# -----------------------------------------------------------------------------
image:
  backend:
    repository: dkonsole/dkonsole-backend
    tag: "1.0.7"
    pullPolicy: Always
  frontend:
    repository: dkonsole/dkonsole-frontend
    tag: "1.0.7"
    pullPolicy: Always

# -----------------------------------------------------------------------------
# 4. Persistence (Optional - For custom logos)
# -----------------------------------------------------------------------------
persistence:
  enabled: true
  size: 1Gi
  # storageClass: "standard" # Uncomment to specify a storage class

# -----------------------------------------------------------------------------
# Advanced Configuration (Defaults are usually fine)
# -----------------------------------------------------------------------------

# Prometheus Integration (Optional)
# Configure the Prometheus endpoint to enable historical metrics for Pods
# If not set, the Metrics tab will not be displayed in Pod details
# Example: "http://prometheus-server.monitoring.svc.cluster.local:9090"
# Features enabled:
#   - Historical CPU and memory metrics for Pods
#   - Time range selector (1h, 6h, 12h, 1d, 7d, 15d)
#   - Metrics tab in Pod details view
prometheusUrl: ""

replicaCount: 1

service:
  type: ClusterIP
  backend: { port: 8080 }
  frontend: { port: 80 }

resources:
  backend:
    limits: { cpu: 500m, memory: 512Mi }
    requests: { cpu: 100m, memory: 128Mi }
  frontend:
    limits: { cpu: 200m, memory: 256Mi }
    requests: { cpu: 50m, memory: 64Mi }

# RBAC Permissions (Required for dashboard functionality)
rbac:
  create: true
  clusterResources:
    # Read-only access to non-sensitive cluster resources
    - apiGroups: [""]
      resources: ["nodes", "persistentvolumes", "storageclasses"]
      verbs: ["get", "list", "watch"]
    - apiGroups: ["apiextensions.k8s.io"]
      resources: ["customresourcedefinitions"]
      verbs: ["get", "list", "watch"]
  nonResourceURLs: ["*"]
  namespacedResources:
    # Read-only resources
    - apiGroups: [""]
      resources: ["pods", "services", "configmaps", "namespaces", "persistentvolumeclaims", "serviceaccounts", "resourcequotas", "limitranges"]
      verbs: ["get", "list", "watch"]
    - apiGroups: ["apps"]
      resources: ["deployments", "statefulsets", "daemonsets", "replicasets"]
      verbs: ["get", "list", "watch"]
    - apiGroups: ["batch"]
      resources: ["jobs", "cronjobs"]
      verbs: ["get", "list", "watch"]
    - apiGroups: ["networking.k8s.io"]
      resources: ["ingresses", "networkpolicies"]
      verbs: ["get", "list", "watch"]
    - apiGroups: ["metrics.k8s.io"]
      resources: ["pods", "nodes"]
      verbs: ["get", "list"]
    - apiGroups: ["autoscaling"]
      resources: ["horizontalpodautoscalers"]
      verbs: ["get", "list", "watch"]
    - apiGroups: ["storage.k8s.io"]
      resources: ["storageclasses"]
      verbs: ["get", "list", "watch"]
    
    # Write access (limited)
    - apiGroups: [""]
      resources: ["configmaps"]
      verbs: ["get", "list", "watch", "create", "update", "patch"]
    - apiGroups: ["apps"]
      resources: ["deployments"]
      verbs: ["get", "list", "watch", "update", "patch"]
    
    # Secrets: Metadata only (backend filters data)
    - apiGroups: [""]
      resources: ["secrets"]
      verbs: ["get", "list", "watch"]
    
    # RBAC: Read-only
    - apiGroups: ["rbac.authorization.k8s.io"]
      resources: ["roles", "rolebindings", "clusterroles", "clusterrolebindings"]
      verbs: ["get", "list", "watch"]
    
    # Pod operations
    - apiGroups: [""]
      resources: ["pods/log", "pods/exec"]
      verbs: ["get", "create"]
    
    # Scaling
    - apiGroups: ["apps"]
      resources: ["deployments/scale"]
      verbs: ["get", "update", "patch"]
    
    # Jobs
    - apiGroups: ["batch"]
      resources: ["jobs"]
      verbs: ["create"]
