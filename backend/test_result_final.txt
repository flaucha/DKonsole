?   	github.com/flaucha/DKonsole/backend	[no test files]
?   	github.com/flaucha/DKonsole/backend/docs	[no test files]
{"fields.level":"warning","level":"warning","msg":"Generated random JWT_SECRET for non-production (set JWT_SECRET to persist sessions)","time":"2025-12-13T11:55:35.012-03:00","type":"warn"}
=== RUN   TestListAPIResources_HandlerSuccessAndError
--- PASS: TestListAPIResources_HandlerSuccessAndError (0.00s)
=== RUN   TestListAPIResourceObjects_Handler
--- PASS: TestListAPIResourceObjects_Handler (0.00s)
=== RUN   TestGetAPIResourceYAML_Handler
--- PASS: TestGetAPIResourceYAML_Handler (0.00s)
=== RUN   TestGetCRDs_Handler
--- PASS: TestGetCRDs_Handler (0.00s)
=== RUN   TestGetCRDResourcesAndYAML_Handler
--- PASS: TestGetCRDResourcesAndYAML_Handler (0.00s)
=== RUN   TestAPIService_ListAPIResources
=== RUN   TestAPIService_ListAPIResources/successful_list_API_resources
=== RUN   TestAPIService_ListAPIResources/filter_out_subresources_(contain_/)
=== RUN   TestAPIService_ListAPIResources/repository_error
=== RUN   TestAPIService_ListAPIResources/discovery_repository_not_set
=== RUN   TestAPIService_ListAPIResources/empty_API_resources_list
--- PASS: TestAPIService_ListAPIResources (0.00s)
    --- PASS: TestAPIService_ListAPIResources/successful_list_API_resources (0.00s)
    --- PASS: TestAPIService_ListAPIResources/filter_out_subresources_(contain_/) (0.00s)
    --- PASS: TestAPIService_ListAPIResources/repository_error (0.00s)
    --- PASS: TestAPIService_ListAPIResources/discovery_repository_not_set (0.00s)
    --- PASS: TestAPIService_ListAPIResources/empty_API_resources_list (0.00s)
=== RUN   TestAPIService_GetResourceYAML
=== RUN   TestAPIService_GetResourceYAML/successful_get_resource_YAML
=== RUN   TestAPIService_GetResourceYAML/resource_repository_not_set
=== RUN   TestAPIService_GetResourceYAML/repository_get_error
--- PASS: TestAPIService_GetResourceYAML (0.00s)
    --- PASS: TestAPIService_GetResourceYAML/successful_get_resource_YAML (0.00s)
    --- PASS: TestAPIService_GetResourceYAML/resource_repository_not_set (0.00s)
    --- PASS: TestAPIService_GetResourceYAML/repository_get_error (0.00s)
=== RUN   TestAPIService_ListAPIResourceObjects
=== RUN   TestAPIService_ListAPIResourceObjects/happy_path_filters_unauthorized_namespaces
=== RUN   TestAPIService_ListAPIResourceObjects/deny_namespace_without_permission
=== RUN   TestAPIService_ListAPIResourceObjects/resource_repository_not_set
--- PASS: TestAPIService_ListAPIResourceObjects (0.00s)
    --- PASS: TestAPIService_ListAPIResourceObjects/happy_path_filters_unauthorized_namespaces (0.00s)
    --- PASS: TestAPIService_ListAPIResourceObjects/deny_namespace_without_permission (0.00s)
    --- PASS: TestAPIService_ListAPIResourceObjects/resource_repository_not_set (0.00s)
=== RUN   TestCRDService_GetCRDs
=== RUN   TestCRDService_GetCRDs/happy_path
=== RUN   TestCRDService_GetCRDs/repo_error
--- PASS: TestCRDService_GetCRDs (0.00s)
    --- PASS: TestCRDService_GetCRDs/happy_path (0.00s)
    --- PASS: TestCRDService_GetCRDs/repo_error (0.00s)
=== RUN   TestAPIService_GetCRDResources
=== RUN   TestAPIService_GetCRDResources/happy_path
=== RUN   TestAPIService_GetCRDResources/repository_error
--- PASS: TestAPIService_GetCRDResources (0.00s)
    --- PASS: TestAPIService_GetCRDResources/happy_path (0.00s)
    --- PASS: TestAPIService_GetCRDResources/repository_error (0.00s)
PASS
ok  	github.com/flaucha/DKonsole/backend/internal/api	(cached)
{"fields.level":"warning","level":"warning","msg":"Generated random JWT_SECRET for non-production (set JWT_SECRET to persist sessions)","time":"2025-12-13T11:57:29.790-03:00","type":"warn"}
=== RUN   TestLoginHandler
=== RUN   TestLoginHandler/successful_login
{"idp":"","level":"info","msg":"Login attempt","time":"2025-12-13T11:57:29.888-03:00","type":"info","username":"admin"}
{"idp":"core","level":"info","msg":"Login successful","role":"admin","time":"2025-12-13T11:57:29.988-03:00","type":"info","username":"admin"}
=== RUN   TestLoginHandler/invalid_JSON_body
=== RUN   TestLoginHandler/invalid_credentials
{"idp":"","level":"info","msg":"Login attempt","time":"2025-12-13T11:57:29.988-03:00","type":"info","username":"admin"}
=== RUN   TestLoginHandler/setup_mode_blocks_login
=== RUN   TestLoginHandler/auth_service_not_initialized
--- PASS: TestLoginHandler (0.26s)
    --- PASS: TestLoginHandler/successful_login (0.10s)
    --- PASS: TestLoginHandler/invalid_JSON_body (0.00s)
    --- PASS: TestLoginHandler/invalid_credentials (0.06s)
    --- PASS: TestLoginHandler/setup_mode_blocks_login (0.00s)
    --- PASS: TestLoginHandler/auth_service_not_initialized (0.00s)
=== RUN   TestLogoutHandler
--- PASS: TestLogoutHandler (0.00s)
=== RUN   TestMeHandler
=== RUN   TestMeHandler/authenticated_user
{"level":"info","msg":"GetCurrentUser: extracted from AuthClaims","permissions":null,"role":"admin","time":"2025-12-13T11:57:30.111-03:00","type":"info","username":"admin"}
{"level":"info","msg":"GetCurrentUser: returning claims","permissions":null,"role":"admin","time":"2025-12-13T11:57:30.111-03:00","type":"info","username":"admin"}
{"idp":"","level":"info","msg":"MeHandler: returning user info","permissions":{},"role":"admin","time":"2025-12-13T11:57:30.111-03:00","type":"info","username":"admin"}
=== RUN   TestMeHandler/no_user_in_context
=== RUN   TestMeHandler/setup_mode_blocks_access
=== RUN   TestMeHandler/auth_service_not_initialized
--- PASS: TestMeHandler (0.06s)
    --- PASS: TestMeHandler/authenticated_user (0.00s)
    --- PASS: TestMeHandler/no_user_in_context (0.00s)
    --- PASS: TestMeHandler/setup_mode_blocks_access (0.00s)
    --- PASS: TestMeHandler/auth_service_not_initialized (0.00s)
=== RUN   TestChangePasswordHandler
=== RUN   TestChangePasswordHandler/setup_mode_blocks_access
=== RUN   TestChangePasswordHandler/K8s_repo_not_available
=== RUN   TestChangePasswordHandler/unauthorized_user_-_K8s_repo_checked_first
--- PASS: TestChangePasswordHandler (0.06s)
    --- PASS: TestChangePasswordHandler/setup_mode_blocks_access (0.00s)
    --- PASS: TestChangePasswordHandler/K8s_repo_not_available (0.00s)
    --- PASS: TestChangePasswordHandler/unauthorized_user_-_K8s_repo_checked_first (0.00s)
=== RUN   TestChangePasswordHandler_WithK8s
=== RUN   TestChangePasswordHandler_WithK8s/Success
{"level":"info","msg":"GetCurrentUser: extracted from AuthClaims","permissions":null,"role":"admin","time":"2025-12-13T11:57:30.193-03:00","type":"info","username":"admin"}
{"level":"info","msg":"GetCurrentUser: returning claims","permissions":null,"role":"admin","time":"2025-12-13T11:57:30.193-03:00","type":"info","username":"admin"}
{"idp":"","level":"info","msg":"Login attempt","time":"2025-12-13T11:57:30.193-03:00","type":"info","username":"admin"}
{"idp":"core","level":"info","msg":"Login successful","role":"admin","time":"2025-12-13T11:57:30.210-03:00","type":"info","username":"admin"}
{"level":"info","msg":"Password updated in Kubernetes secret","namespace":"default","secret_name":"dkonsole-auth","time":"2025-12-13T11:57:30.226-03:00","type":"info"}
{"level":"info","msg":"Password changed successfully","time":"2025-12-13T11:57:30.226-03:00","type":"info","username":"admin"}
=== RUN   TestChangePasswordHandler_WithK8s/Wrong_Current_Password
{"level":"info","msg":"GetCurrentUser: extracted from AuthClaims","permissions":null,"role":"admin","time":"2025-12-13T11:57:30.226-03:00","type":"info","username":"admin"}
{"level":"info","msg":"GetCurrentUser: returning claims","permissions":null,"role":"admin","time":"2025-12-13T11:57:30.226-03:00","type":"info","username":"admin"}
{"idp":"","level":"info","msg":"Login attempt","time":"2025-12-13T11:57:30.226-03:00","type":"info","username":"admin"}
=== RUN   TestChangePasswordHandler_WithK8s/Short_New_Password
=== RUN   TestChangePasswordHandler_WithK8s/No_Token
--- PASS: TestChangePasswordHandler_WithK8s (0.07s)
    --- PASS: TestChangePasswordHandler_WithK8s/Success (0.03s)
    --- PASS: TestChangePasswordHandler_WithK8s/Wrong_Current_Password (0.02s)
    --- PASS: TestChangePasswordHandler_WithK8s/Short_New_Password (0.00s)
    --- PASS: TestChangePasswordHandler_WithK8s/No_Token (0.00s)
=== RUN   TestJWTService_ValidateToken
=== RUN   TestJWTService_ValidateToken/valid_token
=== RUN   TestJWTService_ValidateToken/expired_token
=== RUN   TestJWTService_ValidateToken/invalid_signature
=== RUN   TestJWTService_ValidateToken/malformed_token
=== RUN   TestJWTService_ValidateToken/empty_token
--- PASS: TestJWTService_ValidateToken (0.00s)
    --- PASS: TestJWTService_ValidateToken/valid_token (0.00s)
    --- PASS: TestJWTService_ValidateToken/expired_token (0.00s)
    --- PASS: TestJWTService_ValidateToken/invalid_signature (0.00s)
    --- PASS: TestJWTService_ValidateToken/malformed_token (0.00s)
    --- PASS: TestJWTService_ValidateToken/empty_token (0.00s)
=== RUN   TestJWTService_ExtractToken
=== RUN   TestJWTService_ExtractToken/token_in_Authorization_header
=== RUN   TestJWTService_ExtractToken/token_in_query_parameter
=== RUN   TestJWTService_ExtractToken/token_in_access_token_query_parameter
=== RUN   TestJWTService_ExtractToken/token_in_Sec-WebSocket-Protocol_header
=== RUN   TestJWTService_ExtractToken/token_in_cookie
=== RUN   TestJWTService_ExtractToken/no_token
--- PASS: TestJWTService_ExtractToken (0.00s)
    --- PASS: TestJWTService_ExtractToken/token_in_Authorization_header (0.00s)
    --- PASS: TestJWTService_ExtractToken/token_in_query_parameter (0.00s)
    --- PASS: TestJWTService_ExtractToken/token_in_access_token_query_parameter (0.00s)
    --- PASS: TestJWTService_ExtractToken/token_in_Sec-WebSocket-Protocol_header (0.00s)
    --- PASS: TestJWTService_ExtractToken/token_in_cookie (0.00s)
    --- PASS: TestJWTService_ExtractToken/no_token (0.00s)
=== RUN   TestJWTService_AuthenticateRequest
=== RUN   TestJWTService_AuthenticateRequest/valid_token_in_header
=== RUN   TestJWTService_AuthenticateRequest/no_token
=== RUN   TestJWTService_AuthenticateRequest/invalid_token
--- PASS: TestJWTService_AuthenticateRequest (0.00s)
    --- PASS: TestJWTService_AuthenticateRequest/valid_token_in_header (0.00s)
    --- PASS: TestJWTService_AuthenticateRequest/no_token (0.00s)
    --- PASS: TestJWTService_AuthenticateRequest/invalid_token (0.00s)
=== RUN   TestK8sUserRepository_GetAdminUserAndPassword
--- PASS: TestK8sUserRepository_GetAdminUserAndPassword (0.00s)
=== RUN   TestK8sUserRepository_SecretExistsAndCreateSecret
{"level":"info","msg":"Creating Kubernetes secret","namespace":"ns-create","secret_name":"dkonsole-auth","time":"2025-12-13T11:57:30.244-03:00","type":"info","username":"admin"}
{"level":"info","msg":"Secret created successfully","namespace":"ns-create","secret_name":"dkonsole-auth","time":"2025-12-13T11:57:30.244-03:00","type":"info"}
--- PASS: TestK8sUserRepository_SecretExistsAndCreateSecret (0.00s)
=== RUN   TestEnvUserRepository
--- PASS: TestEnvUserRepository (0.00s)
=== RUN   TestUserContextKey
--- PASS: TestUserContextKey (0.00s)
=== RUN   TestAuthMiddleware
=== RUN   TestAuthMiddleware/Setup_Mode_Active
=== RUN   TestAuthMiddleware/JWT_Service_Not_Initialized
=== RUN   TestAuthMiddleware/OPTIONS_Request
=== RUN   TestAuthMiddleware/No_Token
=== RUN   TestAuthMiddleware/Invalid_Token
=== RUN   TestAuthMiddleware/Valid_Admin_Token
{"level":"info","msg":"AuthMiddleware: extracted claims from JWT","permissions":null,"role":"admin","time":"2025-12-13T11:57:30.245-03:00","type":"info","username":"admin"}
--- PASS: TestAuthMiddleware (0.00s)
    --- PASS: TestAuthMiddleware/Setup_Mode_Active (0.00s)
    --- PASS: TestAuthMiddleware/JWT_Service_Not_Initialized (0.00s)
    --- PASS: TestAuthMiddleware/OPTIONS_Request (0.00s)
    --- PASS: TestAuthMiddleware/No_Token (0.00s)
    --- PASS: TestAuthMiddleware/Invalid_Token (0.00s)
    --- PASS: TestAuthMiddleware/Valid_Admin_Token (0.00s)
=== RUN   TestVerifyPassword
=== RUN   TestVerifyPassword/correct_password
=== RUN   TestVerifyPassword/wrong_password
=== RUN   TestVerifyPassword/invalid_hash_format_-_too_few_parts
=== RUN   TestVerifyPassword/unsupported_variant
=== RUN   TestVerifyPassword/incompatible_version
=== RUN   TestVerifyPassword/invalid_base64_salt
=== RUN   TestVerifyPassword/invalid_base64_hash
--- PASS: TestVerifyPassword (0.19s)
    --- PASS: TestVerifyPassword/correct_password (0.06s)
    --- PASS: TestVerifyPassword/wrong_password (0.06s)
    --- PASS: TestVerifyPassword/invalid_hash_format_-_too_few_parts (0.00s)
    --- PASS: TestVerifyPassword/unsupported_variant (0.00s)
    --- PASS: TestVerifyPassword/incompatible_version (0.00s)
    --- PASS: TestVerifyPassword/invalid_base64_salt (0.00s)
    --- PASS: TestVerifyPassword/invalid_base64_hash (0.00s)
=== RUN   TestNewService
=== RUN   TestNewService/Initialize_with_K8s_client_-_Secret_Missing_(Setup_Mode)
{"level":"info","msg":"Running in setup mode - secret does not exist","secret_name":"dkonsole-auth","time":"2025-12-13T11:57:30.430-03:00","type":"info"}
=== RUN   TestNewService/Initialize_with_K8s_client_-_Secret_Exists
=== RUN   TestNewService/Initialize_without_K8s_client_(Env_Fallback)
--- PASS: TestNewService (0.00s)
    --- PASS: TestNewService/Initialize_with_K8s_client_-_Secret_Missing_(Setup_Mode) (0.00s)
    --- PASS: TestNewService/Initialize_with_K8s_client_-_Secret_Exists (0.00s)
    --- PASS: TestNewService/Initialize_without_K8s_client_(Env_Fallback) (0.00s)
=== RUN   TestAuthService_Login
=== RUN   TestAuthService_Login/successful_login
{"idp":"","level":"info","msg":"Login attempt","time":"2025-12-13T11:57:30.492-03:00","type":"info","username":"admin"}
{"idp":"core","level":"info","msg":"Login successful","role":"admin","time":"2025-12-13T11:57:30.577-03:00","type":"info","username":"admin"}
=== RUN   TestAuthService_Login/invalid_username
{"idp":"","level":"info","msg":"Login attempt","time":"2025-12-13T11:57:30.577-03:00","type":"info","username":"wronguser"}
=== RUN   TestAuthService_Login/invalid_password
{"idp":"","level":"info","msg":"Login attempt","time":"2025-12-13T11:57:30.577-03:00","type":"info","username":"admin"}
=== RUN   TestAuthService_Login/missing_admin_user
{"idp":"","level":"info","msg":"Login attempt","time":"2025-12-13T11:57:30.643-03:00","type":"info","username":"admin"}
=== RUN   TestAuthService_Login/missing_admin_password
{"idp":"","level":"info","msg":"Login attempt","time":"2025-12-13T11:57:30.643-03:00","type":"info","username":"admin"}
--- PASS: TestAuthService_Login (0.21s)
    --- PASS: TestAuthService_Login/successful_login (0.08s)
    --- PASS: TestAuthService_Login/invalid_username (0.00s)
    --- PASS: TestAuthService_Login/invalid_password (0.07s)
    --- PASS: TestAuthService_Login/missing_admin_user (0.00s)
    --- PASS: TestAuthService_Login/missing_admin_password (0.00s)
=== RUN   TestAuthService_GetCurrentUser
=== RUN   TestAuthService_GetCurrentUser/valid_user_in_context
{"level":"info","msg":"GetCurrentUser: extracted from AuthClaims","permissions":null,"role":"admin","time":"2025-12-13T11:57:30.643-03:00","type":"info","username":"admin"}
{"level":"info","msg":"GetCurrentUser: returning claims","permissions":null,"role":"admin","time":"2025-12-13T11:57:30.643-03:00","type":"info","username":"admin"}
=== RUN   TestAuthService_GetCurrentUser/no_user_in_context
=== RUN   TestAuthService_GetCurrentUser/invalid_user_type_in_context
--- PASS: TestAuthService_GetCurrentUser (0.00s)
    --- PASS: TestAuthService_GetCurrentUser/valid_user_in_context (0.00s)
    --- PASS: TestAuthService_GetCurrentUser/no_user_in_context (0.00s)
    --- PASS: TestAuthService_GetCurrentUser/invalid_user_type_in_context (0.00s)
=== RUN   TestAuthService_LoginWithLDAP
=== RUN   TestAuthService_LoginWithLDAP/successful_LDAP_login_with_no_permissions_(empty_map)
{"idp":"ldap","level":"info","msg":"Login attempt","time":"2025-12-13T11:57:30.643-03:00","type":"info","username":"ldapuser"}
{"idp":"ldap","level":"info","msg":"Login successful","role":"user","time":"2025-12-13T11:57:30.643-03:00","type":"info","username":"ldapuser"}
=== RUN   TestAuthService_LoginWithLDAP/successful_LDAP_login_with_admin_permissions_(nil)
{"idp":"ldap","level":"info","msg":"Login attempt","time":"2025-12-13T11:57:30.643-03:00","type":"info","username":"ldapuser"}
{"idp":"ldap","level":"info","msg":"Login successful","role":"admin","time":"2025-12-13T11:57:30.644-03:00","type":"info","username":"ldapuser"}
=== RUN   TestAuthService_LoginWithLDAP/successful_LDAP_login_with_user_permissions
{"idp":"ldap","level":"info","msg":"Login attempt","time":"2025-12-13T11:57:30.644-03:00","type":"info","username":"ldapuser"}
{"idp":"ldap","level":"info","msg":"Login successful","role":"user","time":"2025-12-13T11:57:30.644-03:00","type":"info","username":"ldapuser"}
=== RUN   TestAuthService_LoginWithLDAP/LDAP_authentication_failed
{"idp":"ldap","level":"info","msg":"Login attempt","time":"2025-12-13T11:57:30.644-03:00","type":"info","username":"ldapuser"}
{"error":"invalid credentials","level":"warning","msg":"LDAP authentication failed","time":"2025-12-13T11:57:30.644-03:00","type":"warn","username":"ldapuser"}
=== RUN   TestAuthService_LoginWithLDAP/LDAP_disabled
{"idp":"ldap","level":"info","msg":"Login attempt","time":"2025-12-13T11:57:30.644-03:00","type":"info","username":"ldapuser"}
=== RUN   TestAuthService_LoginWithLDAP/user_not_in_required_group
{"idp":"ldap","level":"info","msg":"Login attempt","time":"2025-12-13T11:57:30.644-03:00","type":"info","username":"ldapuser"}
{"error":"user not in required group","level":"warning","msg":"LDAP user validation failed","time":"2025-12-13T11:57:30.644-03:00","type":"warn","username":"ldapuser"}
=== RUN   TestAuthService_LoginWithLDAP/failed_to_get_permissions,_continues_as_user
{"idp":"ldap","level":"info","msg":"Login attempt","time":"2025-12-13T11:57:30.644-03:00","type":"info","username":"ldapuser"}
{"error":"failed to get permissions","level":"warning","msg":"Failed to get user permissions","time":"2025-12-13T11:57:30.644-03:00","type":"warn","username":"ldapuser"}
{"idp":"ldap","level":"info","msg":"Login successful","role":"user","time":"2025-12-13T11:57:30.644-03:00","type":"info","username":"ldapuser"}
--- PASS: TestAuthService_LoginWithLDAP (0.00s)
    --- PASS: TestAuthService_LoginWithLDAP/successful_LDAP_login_with_no_permissions_(empty_map) (0.00s)
    --- PASS: TestAuthService_LoginWithLDAP/successful_LDAP_login_with_admin_permissions_(nil) (0.00s)
    --- PASS: TestAuthService_LoginWithLDAP/successful_LDAP_login_with_user_permissions (0.00s)
    --- PASS: TestAuthService_LoginWithLDAP/LDAP_authentication_failed (0.00s)
    --- PASS: TestAuthService_LoginWithLDAP/LDAP_disabled (0.00s)
    --- PASS: TestAuthService_LoginWithLDAP/user_not_in_required_group (0.00s)
    --- PASS: TestAuthService_LoginWithLDAP/failed_to_get_permissions,_continues_as_user (0.00s)
=== RUN   TestSetupStatusHandler
--- PASS: TestSetupStatusHandler (0.00s)
=== RUN   TestSetupCompleteHandler_Success
{"ip":"192.0.2.1:1234","level":"info","method":"POST","msg":"SetupCompleteHandler called","path":"/api/setup/complete","time":"2025-12-13T11:57:30.644-03:00","type":"info"}
{"endpoint":"/api/setup/complete","level":"info","msg":"Checking if secret exists before setup","time":"2025-12-13T11:57:30.644-03:00","type":"info"}
{"exists":false,"level":"info","msg":"Secret existence check completed","time":"2025-12-13T11:57:30.644-03:00","type":"info"}
{"level":"info","msg":"Attempting to create secret","namespace":"setup-ns","secret_name":"dkonsole-auth","time":"2025-12-13T11:57:30.661-03:00","type":"info","username":"admin"}
{"level":"info","msg":"Creating Kubernetes secret","namespace":"setup-ns","secret_name":"dkonsole-auth","time":"2025-12-13T11:57:30.661-03:00","type":"info","username":"admin"}
{"level":"info","msg":"Secret created successfully","namespace":"setup-ns","secret_name":"dkonsole-auth","time":"2025-12-13T11:57:30.661-03:00","type":"info"}
{"level":"info","msg":"Setup completed successfully, attempting to reload service","time":"2025-12-13T11:57:30.661-03:00","type":"info","username":"admin"}
{"level":"info","msg":"Reloading auth service - secret now exists","secret_name":"dkonsole-auth","time":"2025-12-13T11:57:30.661-03:00","type":"info"}
{"error":"jwt-secret key not found in secret during reload","level":"error","message":"Failed to reload service after setup","msg":"Failed to reload service after setup","time":"2025-12-13T11:57:30.661-03:00","type":"error","username":"admin"}
--- PASS: TestSetupCompleteHandler_Success (0.02s)
=== RUN   TestSetupCompleteHandler_ForbiddenWhenExists
{"ip":"192.0.2.1:1234","level":"info","method":"POST","msg":"SetupCompleteHandler called","path":"/api/setup/complete","time":"2025-12-13T11:57:30.661-03:00","type":"info"}
{"endpoint":"/api/setup/complete","level":"info","msg":"Checking if secret exists before setup","time":"2025-12-13T11:57:30.661-03:00","type":"info"}
{"exists":true,"level":"info","msg":"Secret existence check completed","time":"2025-12-13T11:57:30.661-03:00","type":"info"}
{"endpoint":"/api/setup/complete","level":"warning","msg":"Setup attempted but secret already exists","time":"2025-12-13T11:57:30.661-03:00","type":"warn"}
--- PASS: TestSetupCompleteHandler_ForbiddenWhenExists (0.00s)
PASS
ok  	github.com/flaucha/DKonsole/backend/internal/auth	(cached)
=== RUN   TestService_GetClient_DefaultAndCustomCluster
--- PASS: TestService_GetClient_DefaultAndCustomCluster (0.00s)
=== RUN   TestService_GetClient_NotFound
--- PASS: TestService_GetClient_NotFound (0.00s)
=== RUN   TestService_GetDynamicClient
--- PASS: TestService_GetDynamicClient (0.00s)
=== RUN   TestService_GetMetricsClient
--- PASS: TestService_GetMetricsClient (0.00s)
=== RUN   TestService_GetRESTConfig
--- PASS: TestService_GetRESTConfig (0.00s)
PASS
ok  	github.com/flaucha/DKonsole/backend/internal/cluster	(cached)
=== RUN   TestHealthHandler
=== RUN   TestHealthHandler/GET_request_returns_OK
=== RUN   TestHealthHandler/POST_request_returns_OK
=== RUN   TestHealthHandler/HEAD_request_returns_OK_(body_may_be_present)
--- PASS: TestHealthHandler (0.00s)
    --- PASS: TestHealthHandler/GET_request_returns_OK (0.00s)
    --- PASS: TestHealthHandler/POST_request_returns_OK (0.00s)
    --- PASS: TestHealthHandler/HEAD_request_returns_OK_(body_may_be_present) (0.00s)
=== RUN   TestHealthHandler_ResponseFormat
--- PASS: TestHealthHandler_ResponseFormat (0.00s)
=== RUN   TestHealthHandler_MultipleCalls
--- PASS: TestHealthHandler_MultipleCalls (0.00s)
PASS
ok  	github.com/flaucha/DKonsole/backend/internal/health	(cached)
=== RUN   TestServiceFactory
=== RUN   TestServiceFactory/CreateHelmReleaseService
=== RUN   TestServiceFactory/CreateHelmInstallService
=== RUN   TestServiceFactory/CreateHelmUpgradeService
=== RUN   TestServiceFactory/CreateHelmJobService
--- PASS: TestServiceFactory (0.00s)
    --- PASS: TestServiceFactory/CreateHelmReleaseService (0.00s)
    --- PASS: TestServiceFactory/CreateHelmInstallService (0.00s)
    --- PASS: TestServiceFactory/CreateHelmUpgradeService (0.00s)
    --- PASS: TestServiceFactory/CreateHelmJobService (0.00s)
=== RUN   TestInstallHelmRelease
=== RUN   TestInstallHelmRelease/Success
=== RUN   TestInstallHelmRelease/Missing_Chart
=== RUN   TestInstallHelmRelease/Job_Creation_Failure
=== RUN   TestInstallHelmRelease/ConfigMap_Creation_Failure
=== RUN   TestInstallHelmRelease/Success_with_Values
--- PASS: TestInstallHelmRelease (0.00s)
    --- PASS: TestInstallHelmRelease/Success (0.00s)
    --- PASS: TestInstallHelmRelease/Missing_Chart (0.00s)
    --- PASS: TestInstallHelmRelease/Job_Creation_Failure (0.00s)
    --- PASS: TestInstallHelmRelease/ConfigMap_Creation_Failure (0.00s)
    --- PASS: TestInstallHelmRelease/Success_with_Values (0.00s)
=== RUN   TestHelmJobService_BuildHelmRepoName
=== RUN   TestHelmJobService_BuildHelmRepoName/prometheus-community_repo
=== RUN   TestHelmJobService_BuildHelmRepoName/bitnami_repo
=== RUN   TestHelmJobService_BuildHelmRepoName/ingress-nginx_repo
=== RUN   TestHelmJobService_BuildHelmRepoName/stable_repo
=== RUN   TestHelmJobService_BuildHelmRepoName/generic_github_repo
=== RUN   TestHelmJobService_BuildHelmRepoName/HTTP_repo_URL
=== RUN   TestHelmJobService_BuildHelmRepoName/custom_domain_repo
--- PASS: TestHelmJobService_BuildHelmRepoName (0.00s)
    --- PASS: TestHelmJobService_BuildHelmRepoName/prometheus-community_repo (0.00s)
    --- PASS: TestHelmJobService_BuildHelmRepoName/bitnami_repo (0.00s)
    --- PASS: TestHelmJobService_BuildHelmRepoName/ingress-nginx_repo (0.00s)
    --- PASS: TestHelmJobService_BuildHelmRepoName/stable_repo (0.00s)
    --- PASS: TestHelmJobService_BuildHelmRepoName/generic_github_repo (0.00s)
    --- PASS: TestHelmJobService_BuildHelmRepoName/HTTP_repo_URL (0.00s)
    --- PASS: TestHelmJobService_BuildHelmRepoName/custom_domain_repo (0.00s)
=== RUN   TestHelmJobService_CreateValuesConfigMap
=== RUN   TestHelmJobService_CreateValuesConfigMap/successful_create_ConfigMap_with_valid_YAML
=== RUN   TestHelmJobService_CreateValuesConfigMap/empty_values_YAML_returns_empty_name
=== RUN   TestHelmJobService_CreateValuesConfigMap/error_creating_ConfigMap
--- PASS: TestHelmJobService_CreateValuesConfigMap (0.00s)
    --- PASS: TestHelmJobService_CreateValuesConfigMap/successful_create_ConfigMap_with_valid_YAML (0.00s)
    --- PASS: TestHelmJobService_CreateValuesConfigMap/empty_values_YAML_returns_empty_name (0.00s)
    --- PASS: TestHelmJobService_CreateValuesConfigMap/error_creating_ConfigMap (0.00s)
=== RUN   TestHelmJobService_CreateHelmJob
=== RUN   TestHelmJobService_CreateHelmJob/successful_create_helm_job_for_install
=== RUN   TestHelmJobService_CreateHelmJob/service_account_not_found,_fallback_to_default
=== RUN   TestHelmJobService_CreateHelmJob/service_account_not_found,_default_also_not_found
=== RUN   TestHelmJobService_CreateHelmJob/error_creating_job
--- PASS: TestHelmJobService_CreateHelmJob (0.00s)
    --- PASS: TestHelmJobService_CreateHelmJob/successful_create_helm_job_for_install (0.00s)
    --- PASS: TestHelmJobService_CreateHelmJob/service_account_not_found,_fallback_to_default (0.00s)
    --- PASS: TestHelmJobService_CreateHelmJob/service_account_not_found,_default_also_not_found (0.00s)
    --- PASS: TestHelmJobService_CreateHelmJob/error_creating_job (0.00s)
=== RUN   TestHelmJobService_BuildHelmCommand
--- PASS: TestHelmJobService_BuildHelmCommand (0.00s)
=== RUN   TestHelmJobService_CreateHelmJob_AddsValuesVolume
--- PASS: TestHelmJobService_CreateHelmJob_AddsValuesVolume (0.00s)
=== RUN   TestHelmReleaseService_GetHelmReleases
=== RUN   TestHelmReleaseService_GetHelmReleases/successful_list_with_secrets
=== RUN   TestHelmReleaseService_GetHelmReleases/empty_releases_list
=== RUN   TestHelmReleaseService_GetHelmReleases/error_listing_secrets_is_ignored
--- PASS: TestHelmReleaseService_GetHelmReleases (0.00s)
    --- PASS: TestHelmReleaseService_GetHelmReleases/successful_list_with_secrets (0.00s)
    --- PASS: TestHelmReleaseService_GetHelmReleases/empty_releases_list (0.00s)
    --- PASS: TestHelmReleaseService_GetHelmReleases/error_listing_secrets_is_ignored (0.00s)
=== RUN   TestHelmReleaseService_DeleteHelmRelease
=== RUN   TestHelmReleaseService_DeleteHelmRelease/successful_delete_with_secrets_and_configmaps
=== RUN   TestHelmReleaseService_DeleteHelmRelease/no_release_found
=== RUN   TestHelmReleaseService_DeleteHelmRelease/error_listing_secrets_is_ignored
--- PASS: TestHelmReleaseService_DeleteHelmRelease (0.00s)
    --- PASS: TestHelmReleaseService_DeleteHelmRelease/successful_delete_with_secrets_and_configmaps (0.00s)
    --- PASS: TestHelmReleaseService_DeleteHelmRelease/no_release_found (0.00s)
    --- PASS: TestHelmReleaseService_DeleteHelmRelease/error_listing_secrets_is_ignored (0.00s)
=== RUN   TestHelmReleaseService_IsSecretRelatedToRelease
=== RUN   TestHelmReleaseService_IsSecretRelatedToRelease/secret_with_matching_annotations
=== RUN   TestHelmReleaseService_IsSecretRelatedToRelease/secret_with_matching_name_prefix
=== RUN   TestHelmReleaseService_IsSecretRelatedToRelease/secret_not_related_to_release
--- PASS: TestHelmReleaseService_IsSecretRelatedToRelease (0.00s)
    --- PASS: TestHelmReleaseService_IsSecretRelatedToRelease/secret_with_matching_annotations (0.00s)
    --- PASS: TestHelmReleaseService_IsSecretRelatedToRelease/secret_with_matching_name_prefix (0.00s)
    --- PASS: TestHelmReleaseService_IsSecretRelatedToRelease/secret_not_related_to_release (0.00s)
=== RUN   TestHelmReleaseService_ParseReleaseFromSecretAndConfigMap
--- PASS: TestHelmReleaseService_ParseReleaseFromSecretAndConfigMap (0.00s)
=== RUN   TestHelmReleaseService_GetHelmReleasesPrefersNewestDeployed
--- PASS: TestHelmReleaseService_GetHelmReleasesPrefersNewestDeployed (0.01s)
=== RUN   TestHelmReleaseService_GetChartInfo
=== RUN   TestHelmReleaseService_GetChartInfo/list_error
=== RUN   TestHelmReleaseService_GetChartInfo/no_matching_release
=== RUN   TestHelmReleaseService_GetChartInfo/success_with_valid_release_data_including_repo
=== RUN   TestHelmReleaseService_GetChartInfo/success_with_repo_from_sources
=== RUN   TestHelmReleaseService_GetChartInfo/fallback_to_labels_when_decode_fails
=== RUN   TestHelmReleaseService_GetChartInfo/fallback_to_labels_when_data_missing
--- PASS: TestHelmReleaseService_GetChartInfo (0.00s)
    --- PASS: TestHelmReleaseService_GetChartInfo/list_error (0.00s)
    --- PASS: TestHelmReleaseService_GetChartInfo/no_matching_release (0.00s)
    --- PASS: TestHelmReleaseService_GetChartInfo/success_with_valid_release_data_including_repo (0.00s)
    --- PASS: TestHelmReleaseService_GetChartInfo/success_with_repo_from_sources (0.00s)
    --- PASS: TestHelmReleaseService_GetChartInfo/fallback_to_labels_when_decode_fails (0.00s)
    --- PASS: TestHelmReleaseService_GetChartInfo/fallback_to_labels_when_data_missing (0.00s)
=== RUN   TestParseReleaseErrors
--- PASS: TestParseReleaseErrors (0.00s)
=== RUN   TestMalformedReleaseStructure
--- PASS: TestMalformedReleaseStructure (0.00s)
=== RUN   TestK8sHelmReleaseRepository
=== RUN   TestK8sHelmReleaseRepository/ListHelmSecrets
=== RUN   TestK8sHelmReleaseRepository/ListHelmConfigMaps
=== RUN   TestK8sHelmReleaseRepository/ListSecretsInNamespace
=== RUN   TestK8sHelmReleaseRepository/ListConfigMapsInNamespace
=== RUN   TestK8sHelmReleaseRepository/DeleteSecret
=== RUN   TestK8sHelmReleaseRepository/DeleteConfigMap
=== RUN   TestK8sHelmReleaseRepository/ListHelmSecretsError
=== RUN   TestK8sHelmReleaseRepository/ListHelmConfigMapsError
=== RUN   TestK8sHelmReleaseRepository/ListSecretsInNamespaceError
=== RUN   TestK8sHelmReleaseRepository/ListConfigMapsInNamespaceError
=== RUN   TestK8sHelmReleaseRepository/DeleteConfigMapError
--- PASS: TestK8sHelmReleaseRepository (0.00s)
    --- PASS: TestK8sHelmReleaseRepository/ListHelmSecrets (0.00s)
    --- PASS: TestK8sHelmReleaseRepository/ListHelmConfigMaps (0.00s)
    --- PASS: TestK8sHelmReleaseRepository/ListSecretsInNamespace (0.00s)
    --- PASS: TestK8sHelmReleaseRepository/ListConfigMapsInNamespace (0.00s)
    --- PASS: TestK8sHelmReleaseRepository/DeleteSecret (0.00s)
    --- PASS: TestK8sHelmReleaseRepository/DeleteConfigMap (0.00s)
    --- PASS: TestK8sHelmReleaseRepository/ListHelmSecretsError (0.00s)
    --- PASS: TestK8sHelmReleaseRepository/ListHelmConfigMapsError (0.00s)
    --- PASS: TestK8sHelmReleaseRepository/ListSecretsInNamespaceError (0.00s)
    --- PASS: TestK8sHelmReleaseRepository/ListConfigMapsInNamespaceError (0.00s)
    --- PASS: TestK8sHelmReleaseRepository/DeleteConfigMapError (0.00s)
=== RUN   TestK8sHelmJobRepository
=== RUN   TestK8sHelmJobRepository/CreateConfigMap
=== RUN   TestK8sHelmJobRepository/CreateJob
=== RUN   TestK8sHelmJobRepository/GetServiceAccount
=== RUN   TestK8sHelmJobRepository/GetMissingSA
=== RUN   TestK8sHelmJobRepository/CreateConfigMapError
=== RUN   TestK8sHelmJobRepository/CreateJobError
=== RUN   TestK8sHelmJobRepository/DeleteSecretError
--- PASS: TestK8sHelmJobRepository (0.00s)
    --- PASS: TestK8sHelmJobRepository/CreateConfigMap (0.00s)
    --- PASS: TestK8sHelmJobRepository/CreateJob (0.00s)
    --- PASS: TestK8sHelmJobRepository/GetServiceAccount (0.00s)
    --- PASS: TestK8sHelmJobRepository/GetMissingSA (0.00s)
    --- PASS: TestK8sHelmJobRepository/CreateConfigMapError (0.00s)
    --- PASS: TestK8sHelmJobRepository/CreateJobError (0.00s)
    --- PASS: TestK8sHelmJobRepository/DeleteSecretError (0.00s)
=== RUN   TestGetHelmReleases
=== RUN   TestGetHelmReleases/Success
=== RUN   TestGetHelmReleases/Service_Error
--- PASS: TestGetHelmReleases (0.00s)
    --- PASS: TestGetHelmReleases/Success (0.00s)
    --- PASS: TestGetHelmReleases/Service_Error (0.00s)
=== RUN   TestDeleteHelmRelease
=== RUN   TestDeleteHelmRelease/Success
{"action":"delete","ip":"192.0.2.1","level":"info","msg":"audit log","namespace":"default","resource":"HelmRelease/my-release","secrets_deleted":3,"success":true,"time":"2025-12-13T11:55:35.194-03:00","type":"audit","user":"anonymous"}
=== RUN   TestDeleteHelmRelease/Method_Not_Allowed
=== RUN   TestDeleteHelmRelease/Missing_Parameters
=== RUN   TestDeleteHelmRelease/Invalid_Name
=== RUN   TestDeleteHelmRelease/Service_Error
--- PASS: TestDeleteHelmRelease (0.00s)
    --- PASS: TestDeleteHelmRelease/Success (0.00s)
    --- PASS: TestDeleteHelmRelease/Method_Not_Allowed (0.00s)
    --- PASS: TestDeleteHelmRelease/Missing_Parameters (0.00s)
    --- PASS: TestDeleteHelmRelease/Invalid_Name (0.00s)
    --- PASS: TestDeleteHelmRelease/Service_Error (0.00s)
=== RUN   TestNewService
--- PASS: TestNewService (0.00s)
=== RUN   TestInstallHelmReleaseHandler
=== RUN   TestInstallHelmReleaseHandler/Success
{"action":"install","chart":"stable/chart","ip":"192.0.2.1","job":"job-123","level":"info","msg":"audit log","namespace":"default","resource":"HelmRelease/my-release","success":true,"time":"2025-12-13T11:55:35.196-03:00","type":"audit","user":"anonymous","version":""}
=== RUN   TestInstallHelmReleaseHandler/Method_Not_Allowed
=== RUN   TestInstallHelmReleaseHandler/Missing_Required_Fields
=== RUN   TestInstallHelmReleaseHandler/Invalid_Name
=== RUN   TestInstallHelmReleaseHandler/Service_Error
--- PASS: TestInstallHelmReleaseHandler (0.00s)
    --- PASS: TestInstallHelmReleaseHandler/Success (0.00s)
    --- PASS: TestInstallHelmReleaseHandler/Method_Not_Allowed (0.00s)
    --- PASS: TestInstallHelmReleaseHandler/Missing_Required_Fields (0.00s)
    --- PASS: TestInstallHelmReleaseHandler/Invalid_Name (0.00s)
    --- PASS: TestInstallHelmReleaseHandler/Service_Error (0.00s)
=== RUN   TestUpgradeHelmReleaseHandler
=== RUN   TestUpgradeHelmReleaseHandler/Success
{"action":"upgrade","chart":"stable/chart","ip":"192.0.2.1","job":"job-123","level":"info","msg":"audit log","namespace":"default","resource":"HelmRelease/my-release","success":true,"time":"2025-12-13T11:55:35.196-03:00","type":"audit","user":"anonymous","version":""}
=== RUN   TestUpgradeHelmReleaseHandler/Method_Not_Allowed
=== RUN   TestUpgradeHelmReleaseHandler/Missing_Required_Fields
=== RUN   TestUpgradeHelmReleaseHandler/Invalid_Name
=== RUN   TestUpgradeHelmReleaseHandler/Service_Error
--- PASS: TestUpgradeHelmReleaseHandler (0.00s)
    --- PASS: TestUpgradeHelmReleaseHandler/Success (0.00s)
    --- PASS: TestUpgradeHelmReleaseHandler/Method_Not_Allowed (0.00s)
    --- PASS: TestUpgradeHelmReleaseHandler/Missing_Required_Fields (0.00s)
    --- PASS: TestUpgradeHelmReleaseHandler/Invalid_Name (0.00s)
    --- PASS: TestUpgradeHelmReleaseHandler/Service_Error (0.00s)
=== RUN   TestUpgradeHelmRelease
=== RUN   TestUpgradeHelmRelease/Success_with_explicit_chart
=== RUN   TestUpgradeHelmRelease/Success_inferring_chart_from_release
=== RUN   TestUpgradeHelmRelease/Partial_Inference_(Chart_explicit,_Repo_inferred)
=== RUN   TestUpgradeHelmRelease/Failure_inferring_chart_(error_getting_info)
=== RUN   TestUpgradeHelmRelease/Failure_inferring_chart_(no_chart_name_found)
=== RUN   TestUpgradeHelmRelease/ConfigMap_Creation_Failure
=== RUN   TestUpgradeHelmRelease/Job_Creation_Failure
--- PASS: TestUpgradeHelmRelease (0.00s)
    --- PASS: TestUpgradeHelmRelease/Success_with_explicit_chart (0.00s)
    --- PASS: TestUpgradeHelmRelease/Success_inferring_chart_from_release (0.00s)
    --- PASS: TestUpgradeHelmRelease/Partial_Inference_(Chart_explicit,_Repo_inferred) (0.00s)
    --- PASS: TestUpgradeHelmRelease/Failure_inferring_chart_(error_getting_info) (0.00s)
    --- PASS: TestUpgradeHelmRelease/Failure_inferring_chart_(no_chart_name_found) (0.00s)
    --- PASS: TestUpgradeHelmRelease/ConfigMap_Creation_Failure (0.00s)
    --- PASS: TestUpgradeHelmRelease/Job_Creation_Failure (0.00s)
PASS
ok  	github.com/flaucha/DKonsole/backend/internal/helm	(cached)
{"fields.level":"warning","level":"warning","msg":"Generated random JWT_SECRET for non-production (set JWT_SECRET to persist sessions)","time":"2025-12-13T11:55:35.489-03:00","type":"warn"}
=== RUN   TestClusterStatsService_GetClusterStats
=== RUN   TestClusterStatsService_GetClusterStats/successful_stats_retrieval
=== RUN   TestClusterStatsService_GetClusterStats/partial_errors_-_some_stats_succeed
{"error":"failed to get pod count","level":"error","message":"Error fetching pod count","msg":"Error fetching pod count","resource":"pods","time":"2025-12-13T11:55:35.491-03:00","type":"error"}
{"error":"failed to get service count","level":"error","message":"Error fetching service count","msg":"Error fetching service count","resource":"services","time":"2025-12-13T11:55:35.491-03:00","type":"error"}
=== RUN   TestClusterStatsService_GetClusterStats/all_stats_succeed
--- PASS: TestClusterStatsService_GetClusterStats (0.00s)
    --- PASS: TestClusterStatsService_GetClusterStats/successful_stats_retrieval (0.00s)
    --- PASS: TestClusterStatsService_GetClusterStats/partial_errors_-_some_stats_succeed (0.00s)
    --- PASS: TestClusterStatsService_GetClusterStats/all_stats_succeed (0.00s)
=== RUN   TestK8sCronJobRepository
--- PASS: TestK8sCronJobRepository (0.00s)
=== RUN   TestService_TriggerCronJobHandler
--- PASS: TestService_TriggerCronJobHandler (0.00s)
=== RUN   TestService_TriggerCronJobHandler_Errors
=== RUN   TestService_TriggerCronJobHandler_Errors/missing_client
=== RUN   TestService_TriggerCronJobHandler_Errors/invalid_body
--- PASS: TestService_TriggerCronJobHandler_Errors (0.00s)
    --- PASS: TestService_TriggerCronJobHandler_Errors/missing_client (0.00s)
    --- PASS: TestService_TriggerCronJobHandler_Errors/invalid_body (0.00s)
=== RUN   TestCronJobService_TriggerCronJob
=== RUN   TestCronJobService_TriggerCronJob/successful_trigger
=== RUN   TestCronJobService_TriggerCronJob/cronjob_not_found
=== RUN   TestCronJobService_TriggerCronJob/create_job_fails
--- PASS: TestCronJobService_TriggerCronJob (0.00s)
    --- PASS: TestCronJobService_TriggerCronJob/successful_trigger (0.00s)
    --- PASS: TestCronJobService_TriggerCronJob/cronjob_not_found (0.00s)
    --- PASS: TestCronJobService_TriggerCronJob/create_job_fails (0.00s)
=== RUN   TestDeploymentService_ScaleDeployment
=== RUN   TestDeploymentService_ScaleDeployment/scale_up_successfully
=== RUN   TestDeploymentService_ScaleDeployment/scale_down_successfully
=== RUN   TestDeploymentService_ScaleDeployment/scale_to_zero_when_delta_is_negative_enough
=== RUN   TestDeploymentService_ScaleDeployment/scale_from_zero
=== RUN   TestDeploymentService_ScaleDeployment/get_scale_error
=== RUN   TestDeploymentService_ScaleDeployment/update_scale_error
--- PASS: TestDeploymentService_ScaleDeployment (0.00s)
    --- PASS: TestDeploymentService_ScaleDeployment/scale_up_successfully (0.00s)
    --- PASS: TestDeploymentService_ScaleDeployment/scale_down_successfully (0.00s)
    --- PASS: TestDeploymentService_ScaleDeployment/scale_to_zero_when_delta_is_negative_enough (0.00s)
    --- PASS: TestDeploymentService_ScaleDeployment/scale_from_zero (0.00s)
    --- PASS: TestDeploymentService_ScaleDeployment/get_scale_error (0.00s)
    --- PASS: TestDeploymentService_ScaleDeployment/update_scale_error (0.00s)
=== RUN   TestDeploymentService_RolloutDeployment
=== RUN   TestDeploymentService_RolloutDeployment/rollout_successful
=== RUN   TestDeploymentService_RolloutDeployment/deployment_not_found
=== RUN   TestDeploymentService_RolloutDeployment/update_deployment_error
=== RUN   TestDeploymentService_RolloutDeployment/rollout_with_existing_annotations
--- PASS: TestDeploymentService_RolloutDeployment (0.00s)
    --- PASS: TestDeploymentService_RolloutDeployment/rollout_successful (0.00s)
    --- PASS: TestDeploymentService_RolloutDeployment/deployment_not_found (0.00s)
    --- PASS: TestDeploymentService_RolloutDeployment/update_deployment_error (0.00s)
    --- PASS: TestDeploymentService_RolloutDeployment/rollout_with_existing_annotations (0.00s)
=== RUN   TestServiceFactory_CreateServices
--- PASS: TestServiceFactory_CreateServices (0.00s)
=== RUN   TestImportService_ImportResources
=== RUN   TestImportService_ImportResources/empty_YAML
=== RUN   TestImportService_ImportResources/missing_kind
=== RUN   TestImportService_ImportResources/system_namespace_blocked
--- PASS: TestImportService_ImportResources (0.00s)
    --- PASS: TestImportService_ImportResources/empty_YAML (0.00s)
    --- PASS: TestImportService_ImportResources/missing_kind (0.00s)
    --- PASS: TestImportService_ImportResources/system_namespace_blocked (0.00s)
=== RUN   TestGetResourceYAML_Handler
--- PASS: TestGetResourceYAML_Handler (0.00s)
=== RUN   TestGetResourceYAML_Handler_Success
--- PASS: TestGetResourceYAML_Handler_Success (0.00s)
=== RUN   TestGetResourceYAML_MissingParams
--- PASS: TestGetResourceYAML_MissingParams (0.00s)
=== RUN   TestGetNamespacesHandler_Success
--- PASS: TestGetNamespacesHandler_Success (0.12s)
=== RUN   TestGetNamespacesHandler_ClusterNotFound
--- PASS: TestGetNamespacesHandler_ClusterNotFound (0.00s)
=== RUN   TestGetNamespacesHandler_ServiceError
--- PASS: TestGetNamespacesHandler_ServiceError (0.00s)
=== RUN   TestGetResourcesHandler_Success
--- PASS: TestGetResourcesHandler_Success (0.00s)
=== RUN   TestGetResourcesHandler_AccessDenied
--- PASS: TestGetResourcesHandler_AccessDenied (0.00s)
=== RUN   TestGetResourcesHandler_MissingKind
--- PASS: TestGetResourcesHandler_MissingKind (0.00s)
=== RUN   TestGetResourcesHandler_ClusterNotFound
--- PASS: TestGetResourcesHandler_ClusterNotFound (0.00s)
=== RUN   TestGetResourcesHandler_InternalError
--- PASS: TestGetResourcesHandler_InternalError (0.00s)
=== RUN   TestScaleResourceHandler_Success
--- PASS: TestScaleResourceHandler_Success (0.00s)
=== RUN   TestScaleResourceHandler_InvalidDelta
--- PASS: TestScaleResourceHandler_InvalidDelta (0.00s)
=== RUN   TestScaleResourceHandler_Forbidden
--- PASS: TestScaleResourceHandler_Forbidden (0.00s)
=== RUN   TestScaleResourceHandler_ValidationErrors
=== RUN   TestScaleResourceHandler_ValidationErrors/method_not_allowed
=== RUN   TestScaleResourceHandler_ValidationErrors/unsupported_kind
=== RUN   TestScaleResourceHandler_ValidationErrors/missing_name
=== RUN   TestScaleResourceHandler_ValidationErrors/invalid_name
=== RUN   TestScaleResourceHandler_ValidationErrors/invalid_namespace
=== RUN   TestScaleResourceHandler_ValidationErrors/missing_delta
=== RUN   TestScaleResourceHandler_ValidationErrors/zero_delta
=== RUN   TestScaleResourceHandler_ValidationErrors/cluster_not_found
--- PASS: TestScaleResourceHandler_ValidationErrors (0.00s)
    --- PASS: TestScaleResourceHandler_ValidationErrors/method_not_allowed (0.00s)
    --- PASS: TestScaleResourceHandler_ValidationErrors/unsupported_kind (0.00s)
    --- PASS: TestScaleResourceHandler_ValidationErrors/missing_name (0.00s)
    --- PASS: TestScaleResourceHandler_ValidationErrors/invalid_name (0.00s)
    --- PASS: TestScaleResourceHandler_ValidationErrors/invalid_namespace (0.00s)
    --- PASS: TestScaleResourceHandler_ValidationErrors/missing_delta (0.00s)
    --- PASS: TestScaleResourceHandler_ValidationErrors/zero_delta (0.00s)
    --- PASS: TestScaleResourceHandler_ValidationErrors/cluster_not_found (0.00s)
=== RUN   TestScaleResourceHandler_ServiceError
--- PASS: TestScaleResourceHandler_ServiceError (0.00s)
=== RUN   TestGetClusterStatsHandler_Success
--- PASS: TestGetClusterStatsHandler_Success (0.00s)
=== RUN   TestGetClusterStatsHandler_Error
{"error":"boom","level":"error","message":"Error fetching node count","msg":"Error fetching node count","resource":"nodes","time":"2025-12-13T11:55:35.610-03:00","type":"error"}
{"error":"boom","level":"error","message":"Error fetching namespace count","msg":"Error fetching namespace count","resource":"namespaces","time":"2025-12-13T11:55:35.610-03:00","type":"error"}
{"error":"boom","level":"error","message":"Error fetching pod count","msg":"Error fetching pod count","resource":"pods","time":"2025-12-13T11:55:35.610-03:00","type":"error"}
{"error":"boom","level":"error","message":"Error fetching deployment count","msg":"Error fetching deployment count","resource":"deployments","time":"2025-12-13T11:55:35.610-03:00","type":"error"}
{"error":"boom","level":"error","message":"Error fetching service count","msg":"Error fetching service count","resource":"services","time":"2025-12-13T11:55:35.610-03:00","type":"error"}
{"error":"boom","level":"error","message":"Error fetching ingress count","msg":"Error fetching ingress count","resource":"ingresses","time":"2025-12-13T11:55:35.610-03:00","type":"error"}
{"error":"boom","level":"error","message":"Error fetching PVC count","msg":"Error fetching PVC count","resource":"pvcs","time":"2025-12-13T11:55:35.610-03:00","type":"error"}
{"error":"boom","level":"error","message":"Error fetching PV count","msg":"Error fetching PV count","resource":"pvs","time":"2025-12-13T11:55:35.610-03:00","type":"error"}
--- PASS: TestGetClusterStatsHandler_Error (0.00s)
=== RUN   TestGetClusterStatsHandler_ClusterNotFound
--- PASS: TestGetClusterStatsHandler_ClusterNotFound (0.00s)
=== RUN   TestRolloutDeploymentHandler
=== RUN   TestRolloutDeploymentHandler/success
=== RUN   TestRolloutDeploymentHandler/method_not_allowed
=== RUN   TestRolloutDeploymentHandler/invalid_json
=== RUN   TestRolloutDeploymentHandler/missing_params
=== RUN   TestRolloutDeploymentHandler/invalid_name
=== RUN   TestRolloutDeploymentHandler/forbidden
=== RUN   TestRolloutDeploymentHandler/service_error
=== RUN   TestRolloutDeploymentHandler/cluster_not_found
--- PASS: TestRolloutDeploymentHandler (0.00s)
    --- PASS: TestRolloutDeploymentHandler/success (0.00s)
    --- PASS: TestRolloutDeploymentHandler/method_not_allowed (0.00s)
    --- PASS: TestRolloutDeploymentHandler/invalid_json (0.00s)
    --- PASS: TestRolloutDeploymentHandler/missing_params (0.00s)
    --- PASS: TestRolloutDeploymentHandler/invalid_name (0.00s)
    --- PASS: TestRolloutDeploymentHandler/forbidden (0.00s)
    --- PASS: TestRolloutDeploymentHandler/service_error (0.00s)
    --- PASS: TestRolloutDeploymentHandler/cluster_not_found (0.00s)
=== RUN   TestResourceListService_ListPods_WithMetrics
--- PASS: TestResourceListService_ListPods_WithMetrics (0.00s)
=== RUN   TestListPods
--- PASS: TestListPods (0.00s)
=== RUN   TestListServices
--- PASS: TestListServices (0.00s)
=== RUN   TestResourceListService_ListIngresses
--- PASS: TestResourceListService_ListIngresses (0.00s)
=== RUN   TestResourceListService_ListServices_ExternalIPs
--- PASS: TestResourceListService_ListServices_ExternalIPs (0.00s)
=== RUN   TestListRoles
--- PASS: TestListRoles (0.00s)
=== RUN   TestListPVCs
--- PASS: TestListPVCs (0.00s)
=== RUN   TestListDeployments
--- PASS: TestListDeployments (0.00s)
=== RUN   TestNamespaceService_GetNamespaces
=== RUN   TestNamespaceService_GetNamespaces/successful_list_all_namespaces_(admin)
=== RUN   TestNamespaceService_GetNamespaces/repository_error
=== RUN   TestNamespaceService_GetNamespaces/empty_namespaces_list
=== RUN   TestNamespaceService_GetNamespaces/restricted_user_sees_only_allowed_namespaces
--- PASS: TestNamespaceService_GetNamespaces (0.00s)
    --- PASS: TestNamespaceService_GetNamespaces/successful_list_all_namespaces_(admin) (0.00s)
    --- PASS: TestNamespaceService_GetNamespaces/repository_error (0.00s)
    --- PASS: TestNamespaceService_GetNamespaces/empty_namespaces_list (0.00s)
    --- PASS: TestNamespaceService_GetNamespaces/restricted_user_sees_only_allowed_namespaces (0.00s)
=== RUN   TestK8sClusterStatsRepository_Counts
--- PASS: TestK8sClusterStatsRepository_Counts (0.00s)
=== RUN   TestK8sDeploymentRepository
--- PASS: TestK8sDeploymentRepository (0.00s)
=== RUN   TestResourceListService_ListResources_PermissionDenied
--- PASS: TestResourceListService_ListResources_PermissionDenied (0.00s)
=== RUN   TestResourceListService_ListResources_FiltersByPermissions
--- PASS: TestResourceListService_ListResources_FiltersByPermissions (0.00s)
=== RUN   TestResourceListService_ListResources_NoUser
--- PASS: TestResourceListService_ListResources_NoUser (0.00s)
=== RUN   TestResourceListService_ListResources_ManyKinds
=== RUN   TestResourceListService_ListResources_ManyKinds/secret
=== RUN   TestResourceListService_ListResources_ManyKinds/job
=== RUN   TestResourceListService_ListResources_ManyKinds/cronjob
=== RUN   TestResourceListService_ListResources_ManyKinds/statefulset
=== RUN   TestResourceListService_ListResources_ManyKinds/daemonset
=== RUN   TestResourceListService_ListResources_ManyKinds/hpa
=== RUN   TestResourceListService_ListResources_ManyKinds/ingress
=== RUN   TestResourceListService_ListResources_ManyKinds/serviceaccount
=== RUN   TestResourceListService_ListResources_ManyKinds/role
=== RUN   TestResourceListService_ListResources_ManyKinds/clusterrole
=== RUN   TestResourceListService_ListResources_ManyKinds/rolebinding
=== RUN   TestResourceListService_ListResources_ManyKinds/clusterrolebinding
=== RUN   TestResourceListService_ListResources_ManyKinds/networkpolicy
=== RUN   TestResourceListService_ListResources_ManyKinds/pvc
=== RUN   TestResourceListService_ListResources_ManyKinds/pv
=== RUN   TestResourceListService_ListResources_ManyKinds/storageclass
=== RUN   TestResourceListService_ListResources_ManyKinds/resourcequota
=== RUN   TestResourceListService_ListResources_ManyKinds/limitrange
--- PASS: TestResourceListService_ListResources_ManyKinds (0.00s)
    --- PASS: TestResourceListService_ListResources_ManyKinds/secret (0.00s)
    --- PASS: TestResourceListService_ListResources_ManyKinds/job (0.00s)
    --- PASS: TestResourceListService_ListResources_ManyKinds/cronjob (0.00s)
    --- PASS: TestResourceListService_ListResources_ManyKinds/statefulset (0.00s)
    --- PASS: TestResourceListService_ListResources_ManyKinds/daemonset (0.00s)
    --- PASS: TestResourceListService_ListResources_ManyKinds/hpa (0.00s)
    --- PASS: TestResourceListService_ListResources_ManyKinds/ingress (0.00s)
    --- PASS: TestResourceListService_ListResources_ManyKinds/serviceaccount (0.00s)
    --- PASS: TestResourceListService_ListResources_ManyKinds/role (0.00s)
    --- PASS: TestResourceListService_ListResources_ManyKinds/clusterrole (0.00s)
    --- PASS: TestResourceListService_ListResources_ManyKinds/rolebinding (0.00s)
    --- PASS: TestResourceListService_ListResources_ManyKinds/clusterrolebinding (0.00s)
    --- PASS: TestResourceListService_ListResources_ManyKinds/networkpolicy (0.00s)
    --- PASS: TestResourceListService_ListResources_ManyKinds/pvc (0.00s)
    --- PASS: TestResourceListService_ListResources_ManyKinds/pv (0.00s)
    --- PASS: TestResourceListService_ListResources_ManyKinds/storageclass (0.00s)
    --- PASS: TestResourceListService_ListResources_ManyKinds/resourcequota (0.00s)
    --- PASS: TestResourceListService_ListResources_ManyKinds/limitrange (0.00s)
=== RUN   TestUpdateResourceYAMLHandler_Success
--- PASS: TestUpdateResourceYAMLHandler_Success (0.00s)
=== RUN   TestUpdateResourceYAMLHandler_MissingParams
--- PASS: TestUpdateResourceYAMLHandler_MissingParams (0.00s)
=== RUN   TestUpdateResourceYAMLHandler_Forbidden
--- PASS: TestUpdateResourceYAMLHandler_Forbidden (0.00s)
=== RUN   TestCreateResourceYAMLHandler_Success
--- PASS: TestCreateResourceYAMLHandler_Success (0.00s)
=== RUN   TestCreateResourceYAMLHandler_ClusterNotFound
--- PASS: TestCreateResourceYAMLHandler_ClusterNotFound (0.00s)
=== RUN   TestDryRunResourceYAML_InvalidYAML
--- PASS: TestDryRunResourceYAML_InvalidYAML (0.00s)
=== RUN   TestDryRunResourceYAML_ClusterNotFound
--- PASS: TestDryRunResourceYAML_ClusterNotFound (0.00s)
=== RUN   TestValidateResourceYAML_MissingKind
--- PASS: TestValidateResourceYAML_MissingKind (0.00s)
=== RUN   TestServerSideApply_ClusterError
--- PASS: TestServerSideApply_ClusterError (0.00s)
=== RUN   TestImportResourceYAMLHandler_Success
--- PASS: TestImportResourceYAMLHandler_Success (0.00s)
=== RUN   TestStreamResourceCreation_Success
--- PASS: TestStreamResourceCreation_Success (0.00s)
=== RUN   TestStreamResourceCreation_Error
--- PASS: TestStreamResourceCreation_Error (0.00s)
=== RUN   TestDeleteResourceHandler_Success
--- PASS: TestDeleteResourceHandler_Success (0.00s)
=== RUN   TestDeleteResourceHandler_Forbidden
--- PASS: TestDeleteResourceHandler_Forbidden (0.00s)
=== RUN   TestDeleteResourceHandler_MissingParams
--- PASS: TestDeleteResourceHandler_MissingParams (0.00s)
=== RUN   TestWatchResources_Success
--- PASS: TestWatchResources_Success (0.00s)
=== RUN   TestWatchResources_StartWatchError
--- PASS: TestWatchResources_StartWatchError (0.00s)
=== RUN   TestDryRunResourceYAML_Success
--- PASS: TestDryRunResourceYAML_Success (0.00s)
=== RUN   TestValidateResourceYAML_Success
--- PASS: TestValidateResourceYAML_Success (0.00s)
=== RUN   TestServerSideApply_Success
--- PASS: TestServerSideApply_Success (0.00s)
=== RUN   TestImportResourceYAMLHandler_ClusterError
--- PASS: TestImportResourceYAMLHandler_ClusterError (0.00s)
=== RUN   TestImportResourceYAMLHandler_ImportError
--- PASS: TestImportResourceYAMLHandler_ImportError (0.00s)
=== RUN   TestK8sResourceRepository_CRUD
--- PASS: TestK8sResourceRepository_CRUD (0.00s)
=== RUN   TestK8sResourceRepository_Errors
--- PASS: TestK8sResourceRepository_Errors (0.00s)
=== RUN   TestResolveGVR
--- PASS: TestResolveGVR (0.00s)
=== RUN   TestNewK8sGVRResolver
--- PASS: TestNewK8sGVRResolver (0.00s)
=== RUN   TestResourceService_GetResourceYAML
--- PASS: TestResourceService_GetResourceYAML (0.00s)
=== RUN   TestResourceService_UpdateResource_Success
--- PASS: TestResourceService_UpdateResource_Success (0.00s)
=== RUN   TestResourceService_UpdateResource_InvalidYAML
--- PASS: TestResourceService_UpdateResource_InvalidYAML (0.00s)
=== RUN   TestResourceService_UpdateResource_PermissionDenied
--- PASS: TestResourceService_UpdateResource_PermissionDenied (0.00s)
=== RUN   TestResourceService_DeleteResource_RequiresNamespace
--- PASS: TestResourceService_DeleteResource_RequiresNamespace (0.00s)
=== RUN   TestResourceService_DeleteResource_Success
--- PASS: TestResourceService_DeleteResource_Success (0.00s)
=== RUN   TestResourceService_CreateResource_DefaultNamespace
--- PASS: TestResourceService_CreateResource_DefaultNamespace (0.00s)
=== RUN   TestResourceListService_listNodes
--- PASS: TestResourceListService_listNodes (0.00s)
=== RUN   TestResourceListService_listPods
--- PASS: TestResourceListService_listPods (0.00s)
=== RUN   TestResourceListService_listConfigMaps
--- PASS: TestResourceListService_listConfigMaps (0.00s)
=== RUN   TestResourceListService_listServices
--- PASS: TestResourceListService_listServices (0.00s)
=== RUN   TestResourceListService_DeniesNamespaceWithoutAccess
--- PASS: TestResourceListService_DeniesNamespaceWithoutAccess (0.00s)
=== RUN   TestResourceListService_AllNamespacesFilteredAndSelector
--- PASS: TestResourceListService_AllNamespacesFilteredAndSelector (0.00s)
=== RUN   TestResourceListService_FailsWithoutUserContext
--- PASS: TestResourceListService_FailsWithoutUserContext (0.00s)
=== RUN   TestWatchService_TransformEvent
=== RUN   TestWatchService_TransformEvent/valid_ADD_event
=== RUN   TestWatchService_TransformEvent/valid_MODIFIED_event
=== RUN   TestWatchService_TransformEvent/valid_DELETED_event
=== RUN   TestWatchService_TransformEvent/cluster-scoped_resource_(no_namespace)
=== RUN   TestWatchService_TransformEvent/invalid_object_type
--- PASS: TestWatchService_TransformEvent (0.00s)
    --- PASS: TestWatchService_TransformEvent/valid_ADD_event (0.00s)
    --- PASS: TestWatchService_TransformEvent/valid_MODIFIED_event (0.00s)
    --- PASS: TestWatchService_TransformEvent/valid_DELETED_event (0.00s)
    --- PASS: TestWatchService_TransformEvent/cluster-scoped_resource_(no_namespace) (0.00s)
    --- PASS: TestWatchService_TransformEvent/invalid_object_type (0.00s)
=== RUN   TestWatchService_StartWatch
--- PASS: TestWatchService_StartWatch (0.00s)
PASS
ok  	github.com/flaucha/DKonsole/backend/internal/k8s	(cached)
=== RUN   TestConnectAndBindService
=== RUN   TestConnectAndBindService/GetCredentials_Error
{"error":"creds error","level":"warning","msg":"Failed to get LDAP service credentials","time":"2025-12-13T11:55:35.479-03:00","type":"warn","username":"user"}
=== RUN   TestConnectAndBindService/Dial_Error
=== RUN   TestConnectAndBindService/Bind_Error
=== RUN   TestConnectAndBindService/Success
--- PASS: TestConnectAndBindService (0.00s)
    --- PASS: TestConnectAndBindService/GetCredentials_Error (0.00s)
    --- PASS: TestConnectAndBindService/Dial_Error (0.00s)
    --- PASS: TestConnectAndBindService/Bind_Error (0.00s)
    --- PASS: TestConnectAndBindService/Success (0.00s)
=== RUN   TestVerifyUserPassword
=== RUN   TestVerifyUserPassword/Dial_Error
{"bindDN":"cn=user","level":"info","msg":"Attempting to bind with user credentials","time":"2025-12-13T11:55:35.479-03:00","type":"info","username":"user"}
=== RUN   TestVerifyUserPassword/Bind_Error
{"bindDN":"cn=user","level":"info","msg":"Attempting to bind with user credentials","time":"2025-12-13T11:55:35.479-03:00","type":"info","username":"user"}
{"bindDN":"cn=user","error":"invalid password","level":"warning","msg":"Failed to bind with user credentials","time":"2025-12-13T11:55:35.479-03:00","type":"warn","username":"user"}
=== RUN   TestVerifyUserPassword/Success
{"bindDN":"cn=user","level":"info","msg":"Attempting to bind with user credentials","time":"2025-12-13T11:55:35.479-03:00","type":"info","username":"user"}
{"bindDN":"cn=user","level":"info","msg":"User authenticated successfully","time":"2025-12-13T11:55:35.479-03:00","type":"info","username":"user"}
--- PASS: TestVerifyUserPassword (0.00s)
    --- PASS: TestVerifyUserPassword/Dial_Error (0.00s)
    --- PASS: TestVerifyUserPassword/Bind_Error (0.00s)
    --- PASS: TestVerifyUserPassword/Success (0.00s)
=== RUN   TestFindUserDN
=== RUN   TestFindUserDN/Already_Full_DN
=== RUN   TestFindUserDN/Search_Success
=== RUN   TestFindUserDN/Search_Fail_(Fallback)
--- PASS: TestFindUserDN (0.00s)
    --- PASS: TestFindUserDN/Already_Full_DN (0.00s)
    --- PASS: TestFindUserDN/Search_Success (0.00s)
    --- PASS: TestFindUserDN/Search_Fail_(Fallback) (0.00s)
=== RUN   TestNewLDAPClientRepository
=== RUN   TestNewLDAPClientRepository/Success
=== RUN   TestNewLDAPClientRepository/Dial_Fail
{"error":"failed to dial LDAP server: dial fail","level":"warning","msg":"Failed to pre-populate LDAP connection pool","time":"2025-12-13T11:55:35.480-03:00","type":"warn"}
--- PASS: TestNewLDAPClientRepository (0.00s)
    --- PASS: TestNewLDAPClientRepository/Success (0.00s)
    --- PASS: TestNewLDAPClientRepository/Dial_Fail (0.00s)
=== RUN   TestLDAPClientRepository_Methods
=== RUN   TestLDAPClientRepository_Methods/Bind
=== RUN   TestLDAPClientRepository_Methods/Search
=== RUN   TestLDAPClientRepository_Methods/Close
=== RUN   TestLDAPClientRepository_Methods/Nil_Conn
--- PASS: TestLDAPClientRepository_Methods (0.00s)
    --- PASS: TestLDAPClientRepository_Methods/Bind (0.00s)
    --- PASS: TestLDAPClientRepository_Methods/Search (0.00s)
    --- PASS: TestLDAPClientRepository_Methods/Close (0.00s)
    --- PASS: TestLDAPClientRepository_Methods/Nil_Conn (0.00s)
=== RUN   TestExtractServerName
--- PASS: TestExtractServerName (0.00s)
=== RUN   TestBuildTLSConfig
--- PASS: TestBuildTLSConfig (0.00s)
=== RUN   TestBuildTLSConfig_InvalidCA
--- PASS: TestBuildTLSConfig_InvalidCA (0.00s)
=== RUN   TestNewLDAPClient_NilConfig
--- PASS: TestNewLDAPClient_NilConfig (0.00s)
=== RUN   TestNewLDAPClient_InvalidTLS
--- PASS: TestNewLDAPClient_InvalidTLS (0.00s)
=== RUN   TestLDAPClient_UpdateConfig
--- PASS: TestLDAPClient_UpdateConfig (0.00s)
=== RUN   TestLDAPClient_UpdateConfig_Error
--- PASS: TestLDAPClient_UpdateConfig_Error (0.00s)
=== RUN   TestConnectionPool_ReturnConnection_Full
--- PASS: TestConnectionPool_ReturnConnection_Full (0.00s)
=== RUN   TestConnectionPool_CreateConnection_Error
--- PASS: TestConnectionPool_CreateConnection_Error (0.00s)
=== RUN   TestConnectionPool_ReturnConnection_Nil
--- PASS: TestConnectionPool_ReturnConnection_Nil (0.00s)
=== RUN   TestLDAPClient_Delegation
--- PASS: TestLDAPClient_Delegation (0.00s)
=== RUN   TestConstructors
=== RUN   TestConstructors/NewRepository
{"error":"could not determine namespace: service account file not found and POD_NAMESPACE not set","level":"warning","msg":"Failed to get current namespace, using default","time":"2025-12-13T11:55:35.481-03:00","type":"warn"}
=== RUN   TestConstructors/NewService
=== RUN   TestConstructors/NewServiceFactory
{"error":"could not determine namespace: service account file not found and POD_NAMESPACE not set","level":"warning","msg":"Failed to get current namespace, using default","time":"2025-12-13T11:55:35.481-03:00","type":"warn"}
=== RUN   TestConstructors/NewLDAPClient
{"error":"failed to dial LDAP server: LDAP Result Code 200 \"Network Error\": dial tcp 23.220.75.232:389: i/o timeout","level":"warning","msg":"Failed to pre-populate LDAP connection pool","time":"2025-12-13T11:56:35.490-03:00","type":"warn"}
--- PASS: TestConstructors (60.01s)
    --- PASS: TestConstructors/NewRepository (0.00s)
    --- PASS: TestConstructors/NewService (0.00s)
    --- PASS: TestConstructors/NewServiceFactory (0.00s)
    --- PASS: TestConstructors/NewLDAPClient (60.01s)
=== RUN   TestGetUserGroupsWithRepo
=== RUN   TestGetUserGroupsWithRepo/User_Already_DN
{"level":"info","msg":"Username is already a DN","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"uid=test,dc=example,dc=com","username":"uid=test,dc=example,dc=com"}
{"level":"info","msg":"Searching for user groups","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"uid=test,dc=example,dc=com","username":"uid=test,dc=example,dc=com"}
{"level":"info","msg":"Searching for memberOf attribute","scope":"base","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"uid=test,dc=example,dc=com","username":"uid=test,dc=example,dc=com"}
{"attributes":["memberOf"],"level":"info","msg":"User entry attributes","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"uid=test,dc=example,dc=com","username":"uid=test,dc=example,dc=com"}
{"level":"info","memberOf":["cn=dev,ou=groups"],"memberOf_count":1,"msg":"Found memberOf attributes","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"uid=test,dc=example,dc=com","username":"uid=test,dc=example,dc=com"}
{"groups":["dev"],"level":"info","msg":"Extracted groups from memberOf","time":"2025-12-13T11:56:35.491-03:00","type":"info","username":"uid=test,dc=example,dc=com"}
=== RUN   TestGetUserGroupsWithRepo/Extract_Groups_Logic
{"level":"info","msg":"Found user DN","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"uid=test,dc=example,dc=com","username":"test"}
{"level":"info","msg":"Searching for user groups","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"uid=test,dc=example,dc=com","username":"test"}
{"level":"info","msg":"Searching for memberOf attribute","scope":"base","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"uid=test,dc=example,dc=com","username":"test"}
{"attributes":["memberOf"],"level":"info","msg":"User entry attributes","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"uid=test,dc=example,dc=com","username":"test"}
{"level":"info","memberOf":["cn=admin,ou=groups","ou=editors,ou=groups","cn=viewers,ou=other"],"memberOf_count":3,"msg":"Found memberOf attributes","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"uid=test,dc=example,dc=com","username":"test"}
{"groups":["admin","editors","viewers"],"level":"info","msg":"Extracted groups from memberOf","time":"2025-12-13T11:56:35.491-03:00","type":"info","username":"test"}
=== RUN   TestGetUserGroupsWithRepo/Fallback_Search
{"level":"info","msg":"Found user DN","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"uid=test,dc=example,dc=com","username":"test"}
{"level":"info","msg":"Searching for user groups","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"uid=test,dc=example,dc=com","username":"test"}
{"level":"info","msg":"Searching for memberOf attribute","scope":"base","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"uid=test,dc=example,dc=com","username":"test"}
{"attributes":["cn"],"level":"info","msg":"User entry attributes","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"uid=test,dc=example,dc=com","username":"test"}
{"level":"info","memberOf":[],"memberOf_count":0,"msg":"Found memberOf attributes","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"uid=test,dc=example,dc=com","username":"test"}
{"available_attributes":["cn"],"level":"warning","msg":"User has no memberOf attributes","time":"2025-12-13T11:56:35.491-03:00","type":"warn","userDN":"uid=test,dc=example,dc=com","username":"test"}
{"groups":[],"level":"info","msg":"Extracted groups from memberOf","time":"2025-12-13T11:56:35.491-03:00","type":"info","username":"test"}
{"level":"warning","msg":"No groups found from memberOf, trying fallback search","time":"2025-12-13T11:56:35.491-03:00","type":"warn","userDN":"uid=test,dc=example,dc=com","username":"test"}
{"groupDN":"ou=groups,dc=example,dc=com","level":"info","msg":"Trying fallback search for groups","searchFilter":"(|(member=uid=test,dc=example,dc=com)(uniqueMember=uid=test,dc=example,dc=com))","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"uid=test,dc=example,dc=com","username":"test"}
{"entry_count":1,"level":"info","msg":"Fallback search completed","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"uid=test,dc=example,dc=com","username":"test"}
{"groups":["dev"],"level":"info","msg":"Groups extracted from fallback search","time":"2025-12-13T11:56:35.491-03:00","type":"info","username":"test"}
=== RUN   TestGetUserGroupsWithRepo/Search_Error
{"level":"info","msg":"Found user DN","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"uid=test,dc=example,dc=com","username":"test"}
{"level":"info","msg":"Searching for user groups","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"uid=test,dc=example,dc=com","username":"test"}
{"level":"info","msg":"Searching for memberOf attribute","scope":"base","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"uid=test,dc=example,dc=com","username":"test"}
{"error":"search fail","level":"warning","msg":"Failed to search user for memberOf","time":"2025-12-13T11:56:35.491-03:00","type":"warn","userDN":"uid=test,dc=example,dc=com","username":"test"}
{"level":"warning","msg":"No groups found from memberOf, trying fallback search","time":"2025-12-13T11:56:35.491-03:00","type":"warn","userDN":"uid=test,dc=example,dc=com","username":"test"}
{"groupDN":"ou=groups,dc=example,dc=com","level":"info","msg":"Trying fallback search for groups","searchFilter":"(|(member=uid=test,dc=example,dc=com)(uniqueMember=uid=test,dc=example,dc=com))","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"uid=test,dc=example,dc=com","username":"test"}
{"error":"search fail","level":"warning","msg":"Fallback search failed","time":"2025-12-13T11:56:35.491-03:00","type":"warn","userDN":"uid=test,dc=example,dc=com","username":"test"}
=== RUN   TestGetUserGroupsWithRepo/Bind_Error
--- PASS: TestGetUserGroupsWithRepo (0.00s)
    --- PASS: TestGetUserGroupsWithRepo/User_Already_DN (0.00s)
    --- PASS: TestGetUserGroupsWithRepo/Extract_Groups_Logic (0.00s)
    --- PASS: TestGetUserGroupsWithRepo/Fallback_Search (0.00s)
    --- PASS: TestGetUserGroupsWithRepo/Search_Error (0.00s)
    --- PASS: TestGetUserGroupsWithRepo/Bind_Error (0.00s)
=== RUN   TestValidateUserGroup
=== RUN   TestValidateUserGroup/No_Configured_Required_Group
{"level":"info","msg":"ValidateUserGroup called","time":"2025-12-13T11:56:35.491-03:00","type":"info","username":"user"}
{"level":"info","msg":"No required group configured, allowing user","time":"2025-12-13T11:56:35.491-03:00","type":"info","username":"user"}
=== RUN   TestValidateUserGroup/Required_Group_Found
{"level":"info","msg":"ValidateUserGroup called","time":"2025-12-13T11:56:35.491-03:00","type":"info","username":"user"}
{"level":"info","msg":"Required group is configured","required_group":"admins","time":"2025-12-13T11:56:35.491-03:00","type":"info","username":"user"}
{"level":"info","msg":"GetUserGroups called","time":"2025-12-13T11:56:35.491-03:00","type":"info","username":"user"}
{"level":"info","msg":"Got service credentials","service_username":"svc","time":"2025-12-13T11:56:35.491-03:00","type":"info"}
{"level":"info","msg":"Found user DN","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"cn=user,dc=example","username":"user"}
{"level":"info","msg":"Searching for user groups","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"cn=user,dc=example","username":"user"}
{"level":"info","msg":"Searching for memberOf attribute","scope":"base","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"cn=user,dc=example","username":"user"}
{"attributes":["memberOf"],"level":"info","msg":"User entry attributes","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"cn=user,dc=example","username":"user"}
{"level":"info","memberOf":["cn=devs,ou=groups","cn=admins,ou=groups"],"memberOf_count":2,"msg":"Found memberOf attributes","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"cn=user,dc=example","username":"user"}
{"groups":["devs","admins"],"level":"info","msg":"Extracted groups from memberOf","time":"2025-12-13T11:56:35.491-03:00","type":"info","username":"user"}
{"level":"info","msg":"Validating user group membership","required_group":"admins","time":"2025-12-13T11:56:35.491-03:00","type":"info","user_groups":["devs","admins"],"username":"user"}
{"level":"info","msg":"User belongs to required group","required_group":"admins","time":"2025-12-13T11:56:35.491-03:00","type":"info","username":"user"}
=== RUN   TestValidateUserGroup/Required_Group_Missing
{"level":"info","msg":"ValidateUserGroup called","time":"2025-12-13T11:56:35.491-03:00","type":"info","username":"user"}
{"level":"info","msg":"Required group is configured","required_group":"superusers","time":"2025-12-13T11:56:35.491-03:00","type":"info","username":"user"}
{"level":"info","msg":"GetUserGroups called","time":"2025-12-13T11:56:35.491-03:00","type":"info","username":"user"}
{"level":"info","msg":"Got service credentials","service_username":"svc","time":"2025-12-13T11:56:35.491-03:00","type":"info"}
{"level":"info","msg":"Found user DN","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"cn=user,dc=example","username":"user"}
{"level":"info","msg":"Searching for user groups","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"cn=user,dc=example","username":"user"}
{"level":"info","msg":"Searching for memberOf attribute","scope":"base","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"cn=user,dc=example","username":"user"}
{"attributes":["memberOf"],"level":"info","msg":"User entry attributes","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"cn=user,dc=example","username":"user"}
{"level":"info","memberOf":["cn=devs,ou=groups","cn=admins,ou=groups"],"memberOf_count":2,"msg":"Found memberOf attributes","time":"2025-12-13T11:56:35.491-03:00","type":"info","userDN":"cn=user,dc=example","username":"user"}
{"groups":["devs","admins"],"level":"info","msg":"Extracted groups from memberOf","time":"2025-12-13T11:56:35.491-03:00","type":"info","username":"user"}
{"level":"info","msg":"Validating user group membership","required_group":"superusers","time":"2025-12-13T11:56:35.491-03:00","type":"info","user_groups":["devs","admins"],"username":"user"}
{"level":"warning","msg":"User does not belong to required group","required_group":"superusers","time":"2025-12-13T11:56:35.491-03:00","type":"warn","user_groups":["devs","admins"],"username":"user"}
--- PASS: TestValidateUserGroup (0.00s)
    --- PASS: TestValidateUserGroup/No_Configured_Required_Group (0.00s)
    --- PASS: TestValidateUserGroup/Required_Group_Found (0.00s)
    --- PASS: TestValidateUserGroup/Required_Group_Missing (0.00s)
=== RUN   TestUpdateConfigHandler_Detailed
=== RUN   TestUpdateConfigHandler_Detailed/Invalid_JSON
=== RUN   TestUpdateConfigHandler_Detailed/Invalid_URL
=== RUN   TestUpdateConfigHandler_Detailed/Repo_Error
=== RUN   TestUpdateConfigHandler_Detailed/Success
{"level":"warning","msg":"LDAP InsecureSkipVerify enabled - TLS certificate verification is disabled","time":"2025-12-13T11:56:35.492-03:00","type":"warn","url":"ldap://example.com"}
{"enabled":true,"hasCACert":false,"insecureSkipVerify":true,"level":"info","msg":"LDAP config updated","time":"2025-12-13T11:56:35.492-03:00","type":"info","url":"ldap://example.com"}
--- PASS: TestUpdateConfigHandler_Detailed (0.00s)
    --- PASS: TestUpdateConfigHandler_Detailed/Invalid_JSON (0.00s)
    --- PASS: TestUpdateConfigHandler_Detailed/Invalid_URL (0.00s)
    --- PASS: TestUpdateConfigHandler_Detailed/Repo_Error (0.00s)
    --- PASS: TestUpdateConfigHandler_Detailed/Success (0.00s)
=== RUN   TestUpdateGroupsHandler_Detailed
=== RUN   TestUpdateGroupsHandler_Detailed/Invalid_JSON
{"error":"invalid character 'i' looking for beginning of object key string","level":"warning","msg":"Failed to decode LDAP groups request","time":"2025-12-13T11:56:35.492-03:00","type":"warn"}
=== RUN   TestUpdateGroupsHandler_Detailed/Empty_Group_Name
=== RUN   TestUpdateGroupsHandler_Detailed/Invalid_Permission
=== RUN   TestUpdateGroupsHandler_Detailed/Repo_Error
=== RUN   TestUpdateGroupsHandler_Detailed/Success_with_filtering_empty_namespaces
{"groups_count":1,"level":"info","msg":"LDAP groups updated","time":"2025-12-13T11:56:35.492-03:00","type":"info"}
--- PASS: TestUpdateGroupsHandler_Detailed (0.00s)
    --- PASS: TestUpdateGroupsHandler_Detailed/Invalid_JSON (0.00s)
    --- PASS: TestUpdateGroupsHandler_Detailed/Empty_Group_Name (0.00s)
    --- PASS: TestUpdateGroupsHandler_Detailed/Invalid_Permission (0.00s)
    --- PASS: TestUpdateGroupsHandler_Detailed/Repo_Error (0.00s)
    --- PASS: TestUpdateGroupsHandler_Detailed/Success_with_filtering_empty_namespaces (0.00s)
=== RUN   TestUpdateCredentialsHandler
=== RUN   TestUpdateCredentialsHandler/Invalid_JSON
=== RUN   TestUpdateCredentialsHandler/Empty_Username
=== RUN   TestUpdateCredentialsHandler/Repo_Error
=== RUN   TestUpdateCredentialsHandler/Success_New_Password
{"level":"info","msg":"LDAP credentials updated","time":"2025-12-13T11:56:35.492-03:00","type":"info","username":"admin"}
=== RUN   TestUpdateCredentialsHandler/Keep_Existing_Password_-_Success
=== RUN   TestUpdateCredentialsHandler/Keep_Existing_Password_-_Fail_(Empty_existing)
=== RUN   TestUpdateCredentialsHandler/Keep_Existing_Password_-_Repo_Get_Error
--- PASS: TestUpdateCredentialsHandler (0.00s)
    --- PASS: TestUpdateCredentialsHandler/Invalid_JSON (0.00s)
    --- PASS: TestUpdateCredentialsHandler/Empty_Username (0.00s)
    --- PASS: TestUpdateCredentialsHandler/Repo_Error (0.00s)
    --- PASS: TestUpdateCredentialsHandler/Success_New_Password (0.00s)
    --- PASS: TestUpdateCredentialsHandler/Keep_Existing_Password_-_Success (0.00s)
    --- PASS: TestUpdateCredentialsHandler/Keep_Existing_Password_-_Fail_(Empty_existing) (0.00s)
    --- PASS: TestUpdateCredentialsHandler/Keep_Existing_Password_-_Repo_Get_Error (0.00s)
=== RUN   TestTestConnectionHandler_Errors
=== RUN   TestTestConnectionHandler_Errors/Invalid_JSON
=== RUN   TestTestConnectionHandler_Errors/Connection_Fail
{"error":"failed to dial LDAP server: conn fail","level":"warning","msg":"Failed to pre-populate LDAP connection pool","time":"2025-12-13T11:56:35.492-03:00","type":"warn"}
--- PASS: TestTestConnectionHandler_Errors (0.00s)
    --- PASS: TestTestConnectionHandler_Errors/Invalid_JSON (0.00s)
    --- PASS: TestTestConnectionHandler_Errors/Connection_Fail (0.00s)
=== RUN   TestGetConfigHandler_Error
--- PASS: TestGetConfigHandler_Error (0.00s)
=== RUN   TestGetGroupsHandler_Error
--- PASS: TestGetGroupsHandler_Error (0.00s)
=== RUN   TestGetCredentialsHandler_Error
--- PASS: TestGetCredentialsHandler_Error (0.00s)
=== RUN   TestCalculatePermissions
=== RUN   TestCalculatePermissions/Admin_Group
{"admin_group":"admin-group","level":"info","msg":"GetUserPermissions: user is admin group member, returning nil permissions","time":"2025-12-13T11:56:35.492-03:00","type":"info"}
=== RUN   TestCalculatePermissions/Regular_User
=== RUN   TestCalculatePermissions/Permission_Upgrade
=== RUN   TestCalculatePermissions/No_Groups
--- PASS: TestCalculatePermissions (0.00s)
    --- PASS: TestCalculatePermissions/Admin_Group (0.00s)
    --- PASS: TestCalculatePermissions/Regular_User (0.00s)
    --- PASS: TestCalculatePermissions/Permission_Upgrade (0.00s)
    --- PASS: TestCalculatePermissions/No_Groups (0.00s)
=== RUN   TestK8sRepository_GetConfig
=== RUN   TestK8sRepository_GetConfig/DefaultsWithoutClient
=== RUN   TestK8sRepository_GetConfig/NotFound
=== RUN   TestK8sRepository_GetConfig/EmptyData
=== RUN   TestK8sRepository_GetConfig/InvalidJSON
=== RUN   TestK8sRepository_GetConfig/Success
=== RUN   TestK8sRepository_GetConfig/K8sError
--- PASS: TestK8sRepository_GetConfig (0.00s)
    --- PASS: TestK8sRepository_GetConfig/DefaultsWithoutClient (0.00s)
    --- PASS: TestK8sRepository_GetConfig/NotFound (0.00s)
    --- PASS: TestK8sRepository_GetConfig/EmptyData (0.00s)
    --- PASS: TestK8sRepository_GetConfig/InvalidJSON (0.00s)
    --- PASS: TestK8sRepository_GetConfig/Success (0.00s)
    --- PASS: TestK8sRepository_GetConfig/K8sError (0.00s)
=== RUN   TestK8sRepository_UpdateConfig
=== RUN   TestK8sRepository_UpdateConfig/NoClient
=== RUN   TestK8sRepository_UpdateConfig/CreateNew
{"level":"info","msg":"Created Secret for LDAP config","namespace":"ns","secret_name":"ldap-config","time":"2025-12-13T11:56:35.493-03:00","type":"info"}
=== RUN   TestK8sRepository_UpdateConfig/UpdateExisting
{"enabled":true,"level":"info","msg":"Updated LDAP config in Secret","namespace":"ns","secret_name":"ldap-config","time":"2025-12-13T11:56:35.493-03:00","type":"info"}
=== RUN   TestK8sRepository_UpdateConfig/CreateError
=== RUN   TestK8sRepository_UpdateConfig/UpdateError
=== RUN   TestK8sRepository_UpdateConfig/GetError
--- PASS: TestK8sRepository_UpdateConfig (0.00s)
    --- PASS: TestK8sRepository_UpdateConfig/NoClient (0.00s)
    --- PASS: TestK8sRepository_UpdateConfig/CreateNew (0.00s)
    --- PASS: TestK8sRepository_UpdateConfig/UpdateExisting (0.00s)
    --- PASS: TestK8sRepository_UpdateConfig/CreateError (0.00s)
    --- PASS: TestK8sRepository_UpdateConfig/UpdateError (0.00s)
    --- PASS: TestK8sRepository_UpdateConfig/GetError (0.00s)
=== RUN   TestK8sRepository_GetGroups
=== RUN   TestK8sRepository_GetGroups/Defaults
=== RUN   TestK8sRepository_GetGroups/Success
=== RUN   TestK8sRepository_GetGroups/NoClient
=== RUN   TestK8sRepository_GetGroups/InvalidJSON
=== RUN   TestK8sRepository_GetGroups/GetError
--- PASS: TestK8sRepository_GetGroups (0.00s)
    --- PASS: TestK8sRepository_GetGroups/Defaults (0.00s)
    --- PASS: TestK8sRepository_GetGroups/Success (0.00s)
    --- PASS: TestK8sRepository_GetGroups/NoClient (0.00s)
    --- PASS: TestK8sRepository_GetGroups/InvalidJSON (0.00s)
    --- PASS: TestK8sRepository_GetGroups/GetError (0.00s)
=== RUN   TestK8sRepository_UpdateGroups
=== RUN   TestK8sRepository_UpdateGroups/NoClient
=== RUN   TestK8sRepository_UpdateGroups/Success
{"level":"info","msg":"Created Secret for LDAP groups","namespace":"ns","secret_name":"ldap-config","time":"2025-12-13T11:56:35.493-03:00","type":"info"}
=== RUN   TestK8sRepository_UpdateGroups/GetError
=== RUN   TestK8sRepository_UpdateGroups/CreateError
=== RUN   TestK8sRepository_UpdateGroups/UpdateError
--- PASS: TestK8sRepository_UpdateGroups (0.00s)
    --- PASS: TestK8sRepository_UpdateGroups/NoClient (0.00s)
    --- PASS: TestK8sRepository_UpdateGroups/Success (0.00s)
    --- PASS: TestK8sRepository_UpdateGroups/GetError (0.00s)
    --- PASS: TestK8sRepository_UpdateGroups/CreateError (0.00s)
    --- PASS: TestK8sRepository_UpdateGroups/UpdateError (0.00s)
=== RUN   TestK8sRepository_GetCredentials
=== RUN   TestK8sRepository_GetCredentials/Success
=== RUN   TestK8sRepository_GetCredentials/NoClient
=== RUN   TestK8sRepository_GetCredentials/NotFound
=== RUN   TestK8sRepository_GetCredentials/GetError
=== RUN   TestK8sRepository_GetCredentials/MissingFields
--- PASS: TestK8sRepository_GetCredentials (0.00s)
    --- PASS: TestK8sRepository_GetCredentials/Success (0.00s)
    --- PASS: TestK8sRepository_GetCredentials/NoClient (0.00s)
    --- PASS: TestK8sRepository_GetCredentials/NotFound (0.00s)
    --- PASS: TestK8sRepository_GetCredentials/GetError (0.00s)
    --- PASS: TestK8sRepository_GetCredentials/MissingFields (0.00s)
=== RUN   TestK8sRepository_UpdateCredentials
=== RUN   TestK8sRepository_UpdateCredentials/Success
{"level":"info","msg":"Created Secret for LDAP credentials","namespace":"ns","secret_name":"ldap-config","time":"2025-12-13T11:56:35.493-03:00","type":"info"}
=== RUN   TestK8sRepository_UpdateCredentials/NoClient
=== RUN   TestK8sRepository_UpdateCredentials/CreateError
=== RUN   TestK8sRepository_UpdateCredentials/UpdateError
=== RUN   TestK8sRepository_UpdateCredentials/GetError
--- PASS: TestK8sRepository_UpdateCredentials (0.00s)
    --- PASS: TestK8sRepository_UpdateCredentials/Success (0.00s)
    --- PASS: TestK8sRepository_UpdateCredentials/NoClient (0.00s)
    --- PASS: TestK8sRepository_UpdateCredentials/CreateError (0.00s)
    --- PASS: TestK8sRepository_UpdateCredentials/UpdateError (0.00s)
    --- PASS: TestK8sRepository_UpdateCredentials/GetError (0.00s)
=== RUN   TestService_InitializeClient_Error
--- PASS: TestService_InitializeClient_Error (0.00s)
=== RUN   TestService_GetClient_Reinit
--- PASS: TestService_GetClient_Reinit (0.00s)
=== RUN   TestService_InitializeClient_UpdateError
{"error":"failed to rebuild TLS config: failed to parse CA certificate","level":"warning","msg":"Failed to update LDAP client config, recreating","time":"2025-12-13T11:56:35.493-03:00","type":"warn"}
--- PASS: TestService_InitializeClient_UpdateError (0.00s)
=== RUN   TestService_TestConnection_BindError
--- PASS: TestService_TestConnection_BindError (0.00s)
=== RUN   TestService_AuthenticateUser_Integration
=== RUN   TestService_AuthenticateUser_Integration/Success
{"level":"info","msg":"AuthenticateUser called","time":"2025-12-13T11:56:35.493-03:00","type":"info","username":"testuser"}
{"bindDN":"uid=testuser,dc=example,dc=com","level":"info","msg":"Attempting to bind with user credentials","time":"2025-12-13T11:56:35.493-03:00","type":"info","username":"testuser"}
{"bindDN":"uid=testuser,dc=example,dc=com","level":"info","msg":"User authenticated successfully","time":"2025-12-13T11:56:35.493-03:00","type":"info","username":"testuser"}
=== RUN   TestService_AuthenticateUser_Integration/Service_Bind_Error
{"level":"info","msg":"AuthenticateUser called","time":"2025-12-13T11:56:35.493-03:00","type":"info","username":"testuser"}
=== RUN   TestService_AuthenticateUser_Integration/User_Bind_Error_(Invalid_Password)
{"level":"info","msg":"AuthenticateUser called","time":"2025-12-13T11:56:35.493-03:00","type":"info","username":"testuser"}
{"bindDN":"uid=testuser,dc=example,dc=com","level":"info","msg":"Attempting to bind with user credentials","time":"2025-12-13T11:56:35.493-03:00","type":"info","username":"testuser"}
{"bindDN":"uid=testuser,dc=example,dc=com","error":"invalid credentials","level":"warning","msg":"Failed to bind with user credentials","time":"2025-12-13T11:56:35.493-03:00","type":"warn","username":"testuser"}
=== RUN   TestService_AuthenticateUser_Integration/Dial_Error
{"level":"info","msg":"AuthenticateUser called","time":"2025-12-13T11:56:35.494-03:00","type":"info","username":"testuser"}
--- PASS: TestService_AuthenticateUser_Integration (0.00s)
    --- PASS: TestService_AuthenticateUser_Integration/Success (0.00s)
    --- PASS: TestService_AuthenticateUser_Integration/Service_Bind_Error (0.00s)
    --- PASS: TestService_AuthenticateUser_Integration/User_Bind_Error_(Invalid_Password) (0.00s)
    --- PASS: TestService_AuthenticateUser_Integration/Dial_Error (0.00s)
=== RUN   TestTestConnectionHandler_Integration
=== RUN   TestTestConnectionHandler_Integration/Success
--- PASS: TestTestConnectionHandler_Integration (0.00s)
    --- PASS: TestTestConnectionHandler_Integration/Success (0.00s)
=== RUN   TestService_GetUserGroups_Integration
{"level":"info","msg":"GetUserGroups called","time":"2025-12-13T11:56:35.494-03:00","type":"info","username":"john"}
{"level":"info","msg":"Got service credentials","service_username":"admin","time":"2025-12-13T11:56:35.494-03:00","type":"info"}
{"level":"info","msg":"Found user DN","time":"2025-12-13T11:56:35.494-03:00","type":"info","userDN":"uid=john,dc=c","username":"john"}
{"level":"info","msg":"Searching for user groups","time":"2025-12-13T11:56:35.494-03:00","type":"info","userDN":"uid=john,dc=c","username":"john"}
{"level":"info","msg":"Searching for memberOf attribute","scope":"base","time":"2025-12-13T11:56:35.494-03:00","type":"info","userDN":"uid=john,dc=c","username":"john"}
{"attributes":["memberOf"],"level":"info","msg":"User entry attributes","time":"2025-12-13T11:56:35.494-03:00","type":"info","userDN":"uid=john,dc=c","username":"john"}
{"level":"info","memberOf":["cn=admins,ou=groups,dc=c"],"memberOf_count":1,"msg":"Found memberOf attributes","time":"2025-12-13T11:56:35.494-03:00","type":"info","userDN":"uid=john,dc=c","username":"john"}
{"groups":["admins"],"level":"info","msg":"Extracted groups from memberOf","time":"2025-12-13T11:56:35.494-03:00","type":"info","username":"john"}
--- PASS: TestService_GetUserGroups_Integration (0.00s)
=== RUN   TestService_GetUserPermissions_Integration
{"level":"info","msg":"GetUserGroups called","time":"2025-12-13T11:56:35.494-03:00","type":"info","username":"john"}
{"level":"info","msg":"Got service credentials","service_username":"admin","time":"2025-12-13T11:56:35.494-03:00","type":"info"}
{"level":"info","msg":"Found user DN","time":"2025-12-13T11:56:35.494-03:00","type":"info","userDN":"uid=john,dc=c","username":"john"}
{"level":"info","msg":"Searching for user groups","time":"2025-12-13T11:56:35.494-03:00","type":"info","userDN":"uid=john,dc=c","username":"john"}
{"level":"info","msg":"Searching for memberOf attribute","scope":"base","time":"2025-12-13T11:56:35.494-03:00","type":"info","userDN":"uid=john,dc=c","username":"john"}
{"attributes":["memberOf"],"level":"info","msg":"User entry attributes","time":"2025-12-13T11:56:35.494-03:00","type":"info","userDN":"uid=john,dc=c","username":"john"}
{"level":"info","memberOf":["cn=admins,ou=groups,dc=c"],"memberOf_count":1,"msg":"Found memberOf attributes","time":"2025-12-13T11:56:35.494-03:00","type":"info","userDN":"uid=john,dc=c","username":"john"}
{"groups":["admins"],"level":"info","msg":"Extracted groups from memberOf","time":"2025-12-13T11:56:35.494-03:00","type":"info","username":"john"}
{"groups":["admins"],"level":"info","msg":"GetUserPermissions: user groups retrieved","time":"2025-12-13T11:56:35.494-03:00","type":"info","username":"john"}
{"admin_group":"admins","level":"info","msg":"GetUserPermissions: user is admin group member, returning nil permissions","time":"2025-12-13T11:56:35.494-03:00","type":"info"}
--- PASS: TestService_GetUserPermissions_Integration (0.00s)
=== RUN   TestIsValidLDAPURL
=== RUN   TestIsValidLDAPURL/valid_ldap_URL
=== RUN   TestIsValidLDAPURL/valid_ldaps_URL
=== RUN   TestIsValidLDAPURL/valid_ldap_URL_with_port
=== RUN   TestIsValidLDAPURL/valid_ldaps_URL_with_port
=== RUN   TestIsValidLDAPURL/invalid_URL_-_http
=== RUN   TestIsValidLDAPURL/invalid_URL_-_empty
=== RUN   TestIsValidLDAPURL/invalid_URL_-_no_protocol
=== RUN   TestIsValidLDAPURL/invalid_URL_-_wrong_protocol
--- PASS: TestIsValidLDAPURL (0.00s)
    --- PASS: TestIsValidLDAPURL/valid_ldap_URL (0.00s)
    --- PASS: TestIsValidLDAPURL/valid_ldaps_URL (0.00s)
    --- PASS: TestIsValidLDAPURL/valid_ldap_URL_with_port (0.00s)
    --- PASS: TestIsValidLDAPURL/valid_ldaps_URL_with_port (0.00s)
    --- PASS: TestIsValidLDAPURL/invalid_URL_-_http (0.00s)
    --- PASS: TestIsValidLDAPURL/invalid_URL_-_empty (0.00s)
    --- PASS: TestIsValidLDAPURL/invalid_URL_-_no_protocol (0.00s)
    --- PASS: TestIsValidLDAPURL/invalid_URL_-_wrong_protocol (0.00s)
=== RUN   TestService_AuthenticateUser_LDAPDisabled
{"level":"info","msg":"AuthenticateUser called","time":"2025-12-13T11:56:35.494-03:00","type":"info","username":"testuser"}
--- PASS: TestService_AuthenticateUser_LDAPDisabled (0.00s)
=== RUN   TestService_AuthenticateUser_InvalidUsername
{"level":"info","msg":"AuthenticateUser called","time":"2025-12-13T11:56:35.494-03:00","type":"info","username":"admin*"}
{"error":"username contains invalid character: *","level":"warning","msg":"Invalid username format","time":"2025-12-13T11:56:35.494-03:00","type":"warn","username":"admin*"}
--- PASS: TestService_AuthenticateUser_InvalidUsername (0.00s)
=== RUN   TestService_AuthenticateUser_FullFlow
=== RUN   TestService_AuthenticateUser_FullFlow/Success
{"level":"info","msg":"AuthenticateUser called","time":"2025-12-13T11:56:35.494-03:00","type":"info","username":"testuser"}
{"bindDN":"uid=testuser,dc=example,dc=com","level":"info","msg":"Attempting to bind with user credentials","time":"2025-12-13T11:56:35.494-03:00","type":"info","username":"testuser"}
{"bindDN":"uid=testuser,dc=example,dc=com","level":"info","msg":"User authenticated successfully","time":"2025-12-13T11:56:35.494-03:00","type":"info","username":"testuser"}
=== RUN   TestService_AuthenticateUser_FullFlow/Service_Bind_Error
{"level":"info","msg":"AuthenticateUser called","time":"2025-12-13T11:56:35.494-03:00","type":"info","username":"testuser"}
=== RUN   TestService_AuthenticateUser_FullFlow/User_Bind_Error_(Invalid_Password)
{"level":"info","msg":"AuthenticateUser called","time":"2025-12-13T11:56:35.494-03:00","type":"info","username":"testuser"}
{"bindDN":"uid=testuser,dc=example,dc=com","level":"info","msg":"Attempting to bind with user credentials","time":"2025-12-13T11:56:35.494-03:00","type":"info","username":"testuser"}
{"bindDN":"uid=testuser,dc=example,dc=com","error":"invalid credentials","level":"warning","msg":"Failed to bind with user credentials","time":"2025-12-13T11:56:35.494-03:00","type":"warn","username":"testuser"}
=== RUN   TestService_AuthenticateUser_FullFlow/Dial_Error
{"level":"info","msg":"AuthenticateUser called","time":"2025-12-13T11:56:35.494-03:00","type":"info","username":"testuser"}
--- PASS: TestService_AuthenticateUser_FullFlow (0.00s)
    --- PASS: TestService_AuthenticateUser_FullFlow/Success (0.00s)
    --- PASS: TestService_AuthenticateUser_FullFlow/Service_Bind_Error (0.00s)
    --- PASS: TestService_AuthenticateUser_FullFlow/User_Bind_Error_(Invalid_Password) (0.00s)
    --- PASS: TestService_AuthenticateUser_FullFlow/Dial_Error (0.00s)
=== RUN   TestService_ValidateUserGroup_NoRequiredGroup
{"level":"info","msg":"ValidateUserGroup called","time":"2025-12-13T11:56:35.494-03:00","type":"info","username":"testuser"}
{"level":"info","msg":"No required group configured, allowing user","time":"2025-12-13T11:56:35.494-03:00","type":"info","username":"testuser"}
--- PASS: TestService_ValidateUserGroup_NoRequiredGroup (0.00s)
=== RUN   TestService_ValidateUserGroup_ConfigError
{"level":"info","msg":"ValidateUserGroup called","time":"2025-12-13T11:56:35.494-03:00","type":"info","username":"testuser"}
--- PASS: TestService_ValidateUserGroup_ConfigError (0.00s)
=== RUN   TestGetLDAPStatusHandler_ErrorReturnsDisabled
--- PASS: TestGetLDAPStatusHandler_ErrorReturnsDisabled (0.00s)
=== RUN   TestUpdateConfigHandler_InvalidURL
--- PASS: TestUpdateConfigHandler_InvalidURL (0.00s)
=== RUN   TestUpdateGroupsHandler_InvalidPermission
--- PASS: TestUpdateGroupsHandler_InvalidPermission (0.00s)
=== RUN   TestUpdateCredentialsHandler_ValidationPaths
=== RUN   TestUpdateCredentialsHandler_ValidationPaths/missing_username
=== RUN   TestUpdateCredentialsHandler_ValidationPaths/username_changed_without_password_and_none_stored
=== RUN   TestUpdateCredentialsHandler_ValidationPaths/no_changes_to_save
--- PASS: TestUpdateCredentialsHandler_ValidationPaths (0.00s)
    --- PASS: TestUpdateCredentialsHandler_ValidationPaths/missing_username (0.00s)
    --- PASS: TestUpdateCredentialsHandler_ValidationPaths/username_changed_without_password_and_none_stored (0.00s)
    --- PASS: TestUpdateCredentialsHandler_ValidationPaths/no_changes_to_save (0.00s)
=== RUN   TestService_GetConfig
--- PASS: TestService_GetConfig (0.00s)
=== RUN   TestService_GetUserPermissions_LDAPDisabled
{"level":"info","msg":"GetUserGroups called","time":"2025-12-13T11:56:35.494-03:00","type":"info","username":"testuser"}
{"error":"LDAP is not enabled","level":"warning","msg":"Failed to get user groups for permissions","time":"2025-12-13T11:56:35.494-03:00","type":"warn","username":"testuser"}
--- PASS: TestService_GetUserPermissions_LDAPDisabled (0.00s)
=== RUN   TestService_GetUserPermissions_ConfigError
{"level":"info","msg":"GetUserGroups called","time":"2025-12-13T11:56:35.494-03:00","type":"info","username":"testuser"}
{"error":"failed to get LDAP config: config error","level":"warning","msg":"Failed to get user groups for permissions","time":"2025-12-13T11:56:35.494-03:00","type":"warn","username":"testuser"}
--- PASS: TestService_GetUserPermissions_ConfigError (0.00s)
=== RUN   TestBuildBindDN
=== RUN   TestBuildBindDN/username_without_equals_(simple)
=== RUN   TestBuildBindDN/username_with_equals_(full_DN)
=== RUN   TestBuildBindDN/username_is_already_full_DN
--- PASS: TestBuildBindDN (0.00s)
    --- PASS: TestBuildBindDN/username_without_equals_(simple) (0.00s)
    --- PASS: TestBuildBindDN/username_with_equals_(full_DN) (0.00s)
    --- PASS: TestBuildBindDN/username_is_already_full_DN (0.00s)
=== RUN   TestSanitizeLDAPFilter
=== RUN   TestSanitizeLDAPFilter/safe_input
=== RUN   TestSanitizeLDAPFilter/input_with_wildcard
{"escaped":"admin\\2a","level":"warning","msg":"LDAP filter sanitized - potential injection attempt","original":"admin*","time":"2025-12-13T11:56:35.494-03:00","type":"warn"}
=== RUN   TestSanitizeLDAPFilter/input_with_parentheses
{"escaped":"admin\\29\\28cn=\\2a","level":"warning","msg":"LDAP filter sanitized - potential injection attempt","original":"admin)(cn=*","time":"2025-12-13T11:56:35.494-03:00","type":"warn"}
--- PASS: TestSanitizeLDAPFilter (0.00s)
    --- PASS: TestSanitizeLDAPFilter/safe_input (0.00s)
    --- PASS: TestSanitizeLDAPFilter/input_with_wildcard (0.00s)
    --- PASS: TestSanitizeLDAPFilter/input_with_parentheses (0.00s)
=== RUN   TestGetLDAPStatusHandler_Enabled
--- PASS: TestGetLDAPStatusHandler_Enabled (0.00s)
=== RUN   TestGetConfigHandler
=== RUN   TestGetConfigHandler/success
=== RUN   TestGetConfigHandler/repo_error
--- PASS: TestGetConfigHandler (0.00s)
    --- PASS: TestGetConfigHandler/success (0.00s)
    --- PASS: TestGetConfigHandler/repo_error (0.00s)
=== RUN   TestUpdateConfigHandler
=== RUN   TestUpdateConfigHandler/success
{"enabled":false,"hasCACert":false,"insecureSkipVerify":false,"level":"info","msg":"LDAP config updated","time":"2025-12-13T11:56:35.495-03:00","type":"info","url":"ldap://example.com"}
=== RUN   TestUpdateConfigHandler/invalid_body
=== RUN   TestUpdateConfigHandler/update_error
--- PASS: TestUpdateConfigHandler (0.00s)
    --- PASS: TestUpdateConfigHandler/success (0.00s)
    --- PASS: TestUpdateConfigHandler/invalid_body (0.00s)
    --- PASS: TestUpdateConfigHandler/update_error (0.00s)
=== RUN   TestGetGroupsHandler
=== RUN   TestGetGroupsHandler/success
=== RUN   TestGetGroupsHandler/error
--- PASS: TestGetGroupsHandler (0.00s)
    --- PASS: TestGetGroupsHandler/success (0.00s)
    --- PASS: TestGetGroupsHandler/error (0.00s)
=== RUN   TestUpdateGroupsHandler
=== RUN   TestUpdateGroupsHandler/empty_group_name
=== RUN   TestUpdateGroupsHandler/repo_error
--- PASS: TestUpdateGroupsHandler (0.00s)
    --- PASS: TestUpdateGroupsHandler/empty_group_name (0.00s)
    --- PASS: TestUpdateGroupsHandler/repo_error (0.00s)
=== RUN   TestCredentialsHandlers
=== RUN   TestCredentialsHandlers/get_credentials_success
=== RUN   TestCredentialsHandlers/get_credentials_error
=== RUN   TestCredentialsHandlers/update_credentials_error
--- PASS: TestCredentialsHandlers (0.00s)
    --- PASS: TestCredentialsHandlers/get_credentials_success (0.00s)
    --- PASS: TestCredentialsHandlers/get_credentials_error (0.00s)
    --- PASS: TestCredentialsHandlers/update_credentials_error (0.00s)
=== RUN   TestTestConnectionHandler_InvalidBody
--- PASS: TestTestConnectionHandler_InvalidBody (0.00s)
=== RUN   TestService_initializeClient
=== RUN   TestService_initializeClient/config_error
=== RUN   TestService_initializeClient/disabled_closes_existing_client
--- PASS: TestService_initializeClient (0.00s)
    --- PASS: TestService_initializeClient/config_error (0.00s)
    --- PASS: TestService_initializeClient/disabled_closes_existing_client (0.00s)
=== RUN   TestService_getClient
=== RUN   TestService_getClient/returns_existing_client_without_hitting_repo
=== RUN   TestService_getClient/initialize_error_is_propagated
--- PASS: TestService_getClient (0.00s)
    --- PASS: TestService_getClient/returns_existing_client_without_hitting_repo (0.00s)
    --- PASS: TestService_getClient/initialize_error_is_propagated (0.00s)
=== RUN   TestSearchUserDN
=== RUN   TestSearchUserDN/uses_found_DN_and_filter_includes_user_filter
=== RUN   TestSearchUserDN/fallback_to_buildBindDN_on_search_error
--- PASS: TestSearchUserDN (0.00s)
    --- PASS: TestSearchUserDN/uses_found_DN_and_filter_includes_user_filter (0.00s)
    --- PASS: TestSearchUserDN/fallback_to_buildBindDN_on_search_error (0.00s)
=== RUN   TestValidateLDAPUsername
=== RUN   TestValidateLDAPUsername/Valid_username
=== RUN   TestValidateLDAPUsername/Valid_username_with_numbers
=== RUN   TestValidateLDAPUsername/LDAP_injection_attempt_-_wildcard
=== RUN   TestValidateLDAPUsername/LDAP_injection_attempt_-_filter
=== RUN   TestValidateLDAPUsername/Empty_username
=== RUN   TestValidateLDAPUsername/Too_long_username
=== RUN   TestValidateLDAPUsername/Null_byte_injection
--- PASS: TestValidateLDAPUsername (0.00s)
    --- PASS: TestValidateLDAPUsername/Valid_username (0.00s)
    --- PASS: TestValidateLDAPUsername/Valid_username_with_numbers (0.00s)
    --- PASS: TestValidateLDAPUsername/LDAP_injection_attempt_-_wildcard (0.00s)
    --- PASS: TestValidateLDAPUsername/LDAP_injection_attempt_-_filter (0.00s)
    --- PASS: TestValidateLDAPUsername/Empty_username (0.00s)
    --- PASS: TestValidateLDAPUsername/Too_long_username (0.00s)
    --- PASS: TestValidateLDAPUsername/Null_byte_injection (0.00s)
=== RUN   TestIsValidLDAPDN
=== RUN   TestIsValidLDAPDN/Valid_DN
=== RUN   TestIsValidLDAPDN/Valid_DN_with_OU
=== RUN   TestIsValidLDAPDN/Invalid_DN_-_no_comma
=== RUN   TestIsValidLDAPDN/Invalid_DN_-_no_equals
=== RUN   TestIsValidLDAPDN/Empty_DN
--- PASS: TestIsValidLDAPDN (0.00s)
    --- PASS: TestIsValidLDAPDN/Valid_DN (0.00s)
    --- PASS: TestIsValidLDAPDN/Valid_DN_with_OU (0.00s)
    --- PASS: TestIsValidLDAPDN/Invalid_DN_-_no_comma (0.00s)
    --- PASS: TestIsValidLDAPDN/Invalid_DN_-_no_equals (0.00s)
    --- PASS: TestIsValidLDAPDN/Empty_DN (0.00s)
PASS
ok  	github.com/flaucha/DKonsole/backend/internal/ldap	(cached)
=== RUN   TestConfigMapLogoStorage_EnsureDataDirCreatesConfigMap
--- PASS: TestConfigMapLogoStorage_EnsureDataDirCreatesConfigMap (0.00s)
=== RUN   TestConfigMapLogoStorage_SaveAndGet
{"key":"logo.png","level":"info","msg":"Saving logo to ConfigMap","namespace":"dkonsole","time":"2025-12-13T11:55:35.663-03:00","type":"normal"}
--- PASS: TestConfigMapLogoStorage_SaveAndGet (0.00s)
=== RUN   TestConfigMapLogoStorage_SaveUpdatesExisting
{"key":"logo.png","level":"info","msg":"Saving logo to ConfigMap","namespace":"dkonsole","time":"2025-12-13T11:55:35.664-03:00","type":"normal"}
--- PASS: TestConfigMapLogoStorage_SaveUpdatesExisting (0.00s)
=== RUN   TestConfigMapLogoStorage_RemoveAll
--- PASS: TestConfigMapLogoStorage_RemoveAll (0.00s)
=== RUN   TestConfigMapLogoStorage_ListKeysAndByKey
--- PASS: TestConfigMapLogoStorage_ListKeysAndByKey (0.00s)
=== RUN   TestUploadLogoHandler_Success
--- PASS: TestUploadLogoHandler_Success (0.00s)
=== RUN   TestUploadLogoHandler_InvalidType
--- PASS: TestUploadLogoHandler_InvalidType (0.00s)
=== RUN   TestGetLogoHandler_ConfigMapContent
--- PASS: TestGetLogoHandler_ConfigMapContent (0.00s)
=== RUN   TestGetLogoHandler_NotFound
--- PASS: TestGetLogoHandler_NotFound (0.00s)
=== RUN   TestGetLogoHandler_InvalidType
--- PASS: TestGetLogoHandler_InvalidType (0.00s)
=== RUN   TestLogoService_UploadLogo
=== RUN   TestLogoService_UploadLogo/successful_upload_PNG_normal
=== RUN   TestLogoService_UploadLogo/successful_upload_SVG_light
=== RUN   TestLogoService_UploadLogo/default_to_normal_logo_type
=== RUN   TestLogoService_UploadLogo/error_ensuring_data_directory
=== RUN   TestLogoService_UploadLogo/validation_error
=== RUN   TestLogoService_UploadLogo/error_removing_existing_logos
=== RUN   TestLogoService_UploadLogo/error_saving_logo
--- PASS: TestLogoService_UploadLogo (0.00s)
    --- PASS: TestLogoService_UploadLogo/successful_upload_PNG_normal (0.00s)
    --- PASS: TestLogoService_UploadLogo/successful_upload_SVG_light (0.00s)
    --- PASS: TestLogoService_UploadLogo/default_to_normal_logo_type (0.00s)
    --- PASS: TestLogoService_UploadLogo/error_ensuring_data_directory (0.00s)
    --- PASS: TestLogoService_UploadLogo/validation_error (0.00s)
    --- PASS: TestLogoService_UploadLogo/error_removing_existing_logos (0.00s)
    --- PASS: TestLogoService_UploadLogo/error_saving_logo (0.00s)
=== RUN   TestLogoService_GetLogoPath
=== RUN   TestLogoService_GetLogoPath/get_existing_normal_logo_PNG
=== RUN   TestLogoService_GetLogoPath/get_existing_light_logo_SVG
=== RUN   TestLogoService_GetLogoPath/default_to_normal_when_logo_type_is_empty
=== RUN   TestLogoService_GetLogoPath/logo_not_found
--- PASS: TestLogoService_GetLogoPath (0.00s)
    --- PASS: TestLogoService_GetLogoPath/get_existing_normal_logo_PNG (0.00s)
    --- PASS: TestLogoService_GetLogoPath/get_existing_light_logo_SVG (0.00s)
    --- PASS: TestLogoService_GetLogoPath/default_to_normal_when_logo_type_is_empty (0.00s)
    --- PASS: TestLogoService_GetLogoPath/logo_not_found (0.00s)
=== RUN   TestLogoService_GetLogoContent
=== RUN   TestLogoService_GetLogoContent/returns_png_content_with_content_type
=== RUN   TestLogoService_GetLogoContent/falls_back_to_filesystem_path
--- PASS: TestLogoService_GetLogoContent (0.00s)
    --- PASS: TestLogoService_GetLogoContent/returns_png_content_with_content_type (0.00s)
    --- PASS: TestLogoService_GetLogoContent/falls_back_to_filesystem_path (0.00s)
=== RUN   TestFileSystemLogoStorage_EnsureDataDir
--- PASS: TestFileSystemLogoStorage_EnsureDataDir (0.00s)
=== RUN   TestFileSystemLogoStorage_Save
=== RUN   TestFileSystemLogoStorage_Save/save_normal_logo_PNG
{"level":"info","msg":"Saving logo","path":"/tmp/TestFileSystemLogoStorage_Save2783598892/001/logo.png","time":"2025-12-13T11:55:35.667-03:00","type":"normal"}
=== RUN   TestFileSystemLogoStorage_Save/save_light_logo_PNG
{"level":"info","msg":"Saving logo","path":"/tmp/TestFileSystemLogoStorage_Save2783598892/001/logo-light.png","time":"2025-12-13T11:55:35.667-03:00","type":"light"}
=== RUN   TestFileSystemLogoStorage_Save/save_normal_logo_SVG
{"level":"info","msg":"Saving logo","path":"/tmp/TestFileSystemLogoStorage_Save2783598892/001/logo.svg","time":"2025-12-13T11:55:35.667-03:00","type":"normal"}
=== RUN   TestFileSystemLogoStorage_Save/save_light_logo_SVG
{"level":"info","msg":"Saving logo","path":"/tmp/TestFileSystemLogoStorage_Save2783598892/001/logo-light.svg","time":"2025-12-13T11:55:35.667-03:00","type":"light"}
--- PASS: TestFileSystemLogoStorage_Save (0.00s)
    --- PASS: TestFileSystemLogoStorage_Save/save_normal_logo_PNG (0.00s)
    --- PASS: TestFileSystemLogoStorage_Save/save_light_logo_PNG (0.00s)
    --- PASS: TestFileSystemLogoStorage_Save/save_normal_logo_SVG (0.00s)
    --- PASS: TestFileSystemLogoStorage_Save/save_light_logo_SVG (0.00s)
=== RUN   TestFileSystemLogoStorage_Get
=== RUN   TestFileSystemLogoStorage_Get/get_existing_normal_logo_PNG
=== RUN   TestFileSystemLogoStorage_Get/get_existing_light_logo_SVG
=== RUN   TestFileSystemLogoStorage_Get/get_non-existent_logo
--- PASS: TestFileSystemLogoStorage_Get (0.00s)
    --- PASS: TestFileSystemLogoStorage_Get/get_existing_normal_logo_PNG (0.00s)
    --- PASS: TestFileSystemLogoStorage_Get/get_existing_light_logo_SVG (0.00s)
    --- PASS: TestFileSystemLogoStorage_Get/get_non-existent_logo (0.00s)
=== RUN   TestFileSystemLogoStorage_RemoveAll
=== RUN   TestFileSystemLogoStorage_RemoveAll/remove_all_normal_logos
=== RUN   TestFileSystemLogoStorage_RemoveAll/remove_all_light_logos
=== RUN   TestFileSystemLogoStorage_RemoveAll/remove_when_no_files_exist_(should_not_error)
=== RUN   TestFileSystemLogoStorage_RemoveAll/remove_only_removes_files_of_correct_type
--- PASS: TestFileSystemLogoStorage_RemoveAll (0.00s)
    --- PASS: TestFileSystemLogoStorage_RemoveAll/remove_all_normal_logos (0.00s)
    --- PASS: TestFileSystemLogoStorage_RemoveAll/remove_all_light_logos (0.00s)
    --- PASS: TestFileSystemLogoStorage_RemoveAll/remove_when_no_files_exist_(should_not_error) (0.00s)
    --- PASS: TestFileSystemLogoStorage_RemoveAll/remove_only_removes_files_of_correct_type (0.00s)
=== RUN   TestDefaultLogoValidator_ValidateFile
=== RUN   TestDefaultLogoValidator_ValidateFile/valid_PNG_file
=== RUN   TestDefaultLogoValidator_ValidateFile/valid_SVG_file
=== RUN   TestDefaultLogoValidator_ValidateFile/file_too_large
=== RUN   TestDefaultLogoValidator_ValidateFile/invalid_extension_-_jpg
=== RUN   TestDefaultLogoValidator_ValidateFile/invalid_extension_-_gif
=== RUN   TestDefaultLogoValidator_ValidateFile/PNG_file_with_wrong_content_type
=== RUN   TestDefaultLogoValidator_ValidateFile/case_insensitive_extension_-_PNG
=== RUN   TestDefaultLogoValidator_ValidateFile/case_insensitive_extension_-_SVG
--- PASS: TestDefaultLogoValidator_ValidateFile (0.00s)
    --- PASS: TestDefaultLogoValidator_ValidateFile/valid_PNG_file (0.00s)
    --- PASS: TestDefaultLogoValidator_ValidateFile/valid_SVG_file (0.00s)
    --- PASS: TestDefaultLogoValidator_ValidateFile/file_too_large (0.00s)
    --- PASS: TestDefaultLogoValidator_ValidateFile/invalid_extension_-_jpg (0.00s)
    --- PASS: TestDefaultLogoValidator_ValidateFile/invalid_extension_-_gif (0.00s)
    --- PASS: TestDefaultLogoValidator_ValidateFile/PNG_file_with_wrong_content_type (0.00s)
    --- PASS: TestDefaultLogoValidator_ValidateFile/case_insensitive_extension_-_PNG (0.00s)
    --- PASS: TestDefaultLogoValidator_ValidateFile/case_insensitive_extension_-_SVG (0.00s)
=== RUN   TestDefaultLogoValidator_ValidateSVGSecurity
=== RUN   TestDefaultLogoValidator_ValidateSVGSecurity/SVG_with_script_tag
=== RUN   TestDefaultLogoValidator_ValidateSVGSecurity/SVG_with_javascript:_protocol
=== RUN   TestDefaultLogoValidator_ValidateSVGSecurity/SVG_with_onload_handler
=== RUN   TestDefaultLogoValidator_ValidateSVGSecurity/SVG_with_onerror_handler
=== RUN   TestDefaultLogoValidator_ValidateSVGSecurity/SVG_with_script_in_uppercase
=== RUN   TestDefaultLogoValidator_ValidateSVGSecurity/valid_SVG_passes_security_check
--- PASS: TestDefaultLogoValidator_ValidateSVGSecurity (0.00s)
    --- PASS: TestDefaultLogoValidator_ValidateSVGSecurity/SVG_with_script_tag (0.00s)
    --- PASS: TestDefaultLogoValidator_ValidateSVGSecurity/SVG_with_javascript:_protocol (0.00s)
    --- PASS: TestDefaultLogoValidator_ValidateSVGSecurity/SVG_with_onload_handler (0.00s)
    --- PASS: TestDefaultLogoValidator_ValidateSVGSecurity/SVG_with_onerror_handler (0.00s)
    --- PASS: TestDefaultLogoValidator_ValidateSVGSecurity/SVG_with_script_in_uppercase (0.00s)
    --- PASS: TestDefaultLogoValidator_ValidateSVGSecurity/valid_SVG_passes_security_check (0.00s)
=== RUN   TestDetectContentType
=== RUN   TestDetectContentType/valid_PNG_header
=== RUN   TestDetectContentType/SVG_with_XML_declaration
=== RUN   TestDetectContentType/SVG_without_XML_declaration
=== RUN   TestDetectContentType/empty_buffer
=== RUN   TestDetectContentType/invalid_content
--- PASS: TestDetectContentType (0.00s)
    --- PASS: TestDetectContentType/valid_PNG_header (0.00s)
    --- PASS: TestDetectContentType/SVG_with_XML_declaration (0.00s)
    --- PASS: TestDetectContentType/SVG_without_XML_declaration (0.00s)
    --- PASS: TestDetectContentType/empty_buffer (0.00s)
    --- PASS: TestDetectContentType/invalid_content (0.00s)
PASS
ok  	github.com/flaucha/DKonsole/backend/internal/logo	(cached)
=== RUN   TestAuditMiddleware
=== RUN   TestAuditMiddleware/GET_request_without_user
{"action":"http_request","duration":"2.4s","ip":"192.0.2.1","level":"info","method":"GET","msg":"audit log","path":"/api/test","status":200,"success":true,"time":"2025-12-13T12:16:45.371-03:00","type":"audit","user":"anonymous","user_agent":""}
=== RUN   TestAuditMiddleware/POST_request_with_user_in_context_(map_format)
{"action":"http_request","duration":"1.83s","ip":"192.0.2.1","level":"info","method":"POST","msg":"audit log","path":"/api/resources","status":200,"success":true,"time":"2025-12-13T12:16:45.373-03:00","type":"audit","user":"admin","user_agent":""}
=== RUN   TestAuditMiddleware/request_with_404_status
{"action":"http_request","duration":"540ns","ip":"192.0.2.1","level":"info","method":"GET","msg":"audit log","path":"/api/notfound","status":404,"success":false,"time":"2025-12-13T12:16:45.373-03:00","type":"audit","user":"anonymous","user_agent":""}
=== RUN   TestAuditMiddleware/request_with_500_status
{"action":"http_request","duration":"380ns","ip":"192.0.2.1","level":"info","method":"POST","msg":"audit log","path":"/api/error","status":500,"success":false,"time":"2025-12-13T12:16:45.373-03:00","type":"audit","user":"anonymous","user_agent":""}
=== RUN   TestAuditMiddleware/websocket_request_should_pass
{"action":"http_request","duration":"610ns","ip":"192.0.2.1","level":"info","method":"GET","msg":"audit log","path":"/ws/pods","status":101,"success":true,"time":"2025-12-13T12:16:45.373-03:00","type":"audit","user":"anonymous","user_agent":""}
--- PASS: TestAuditMiddleware (0.00s)
    --- PASS: TestAuditMiddleware/GET_request_without_user (0.00s)
    --- PASS: TestAuditMiddleware/POST_request_with_user_in_context_(map_format) (0.00s)
    --- PASS: TestAuditMiddleware/request_with_404_status (0.00s)
    --- PASS: TestAuditMiddleware/request_with_500_status (0.00s)
    --- PASS: TestAuditMiddleware/websocket_request_should_pass (0.00s)
=== RUN   TestAuditMiddleware_UserExtraction
=== RUN   TestAuditMiddleware_UserExtraction/user_as_map[string]interface{}
{"action":"http_request","duration":"650ns","ip":"192.0.2.1","level":"info","method":"GET","msg":"audit log","path":"/api/test","status":200,"success":true,"time":"2025-12-13T12:16:45.373-03:00","type":"audit","user":"admin","user_agent":""}
=== RUN   TestAuditMiddleware_UserExtraction/no_user_in_context
{"action":"http_request","duration":"250ns","ip":"192.0.2.1","level":"info","method":"GET","msg":"audit log","path":"/api/test","status":200,"success":true,"time":"2025-12-13T12:16:45.373-03:00","type":"audit","user":"anonymous","user_agent":""}
--- PASS: TestAuditMiddleware_UserExtraction (0.00s)
    --- PASS: TestAuditMiddleware_UserExtraction/user_as_map[string]interface{} (0.00s)
    --- PASS: TestAuditMiddleware_UserExtraction/no_user_in_context (0.00s)
=== RUN   TestStatusRecorder
=== RUN   TestStatusRecorder/record_200_status
=== RUN   TestStatusRecorder/record_404_status
=== RUN   TestStatusRecorder/record_500_status
--- PASS: TestStatusRecorder (0.00s)
    --- PASS: TestStatusRecorder/record_200_status (0.00s)
    --- PASS: TestStatusRecorder/record_404_status (0.00s)
    --- PASS: TestStatusRecorder/record_500_status (0.00s)
=== RUN   TestStatusRecorder_Flush
--- PASS: TestStatusRecorder_Flush (0.00s)
=== RUN   TestChain
--- PASS: TestChain (0.00s)
=== RUN   TestCSRFMiddleware
=== RUN   TestCSRFMiddleware/GET_request_should_pass_(safe_method)
=== RUN   TestCSRFMiddleware/HEAD_request_should_pass_(safe_method)
=== RUN   TestCSRFMiddleware/OPTIONS_request_should_pass_(safe_method)
=== RUN   TestCSRFMiddleware/POST_with_Origin_header_should_pass
=== RUN   TestCSRFMiddleware/POST_with_Referer_header_should_pass
=== RUN   TestCSRFMiddleware/POST_with_both_Origin_and_Referer_should_pass
=== RUN   TestCSRFMiddleware/POST_without_Origin_or_Referer_should_be_rejected
=== RUN   TestCSRFMiddleware/PUT_without_Origin_or_Referer_should_be_rejected
=== RUN   TestCSRFMiddleware/DELETE_without_Origin_or_Referer_should_be_rejected
=== RUN   TestCSRFMiddleware/PATCH_with_Origin_should_pass
--- PASS: TestCSRFMiddleware (0.00s)
    --- PASS: TestCSRFMiddleware/GET_request_should_pass_(safe_method) (0.00s)
    --- PASS: TestCSRFMiddleware/HEAD_request_should_pass_(safe_method) (0.00s)
    --- PASS: TestCSRFMiddleware/OPTIONS_request_should_pass_(safe_method) (0.00s)
    --- PASS: TestCSRFMiddleware/POST_with_Origin_header_should_pass (0.00s)
    --- PASS: TestCSRFMiddleware/POST_with_Referer_header_should_pass (0.00s)
    --- PASS: TestCSRFMiddleware/POST_with_both_Origin_and_Referer_should_pass (0.00s)
    --- PASS: TestCSRFMiddleware/POST_without_Origin_or_Referer_should_be_rejected (0.00s)
    --- PASS: TestCSRFMiddleware/PUT_without_Origin_or_Referer_should_be_rejected (0.00s)
    --- PASS: TestCSRFMiddleware/DELETE_without_Origin_or_Referer_should_be_rejected (0.00s)
    --- PASS: TestCSRFMiddleware/PATCH_with_Origin_should_pass (0.00s)
=== RUN   TestRateLimitMiddleware
=== RUN   TestRateLimitMiddleware/single_request_should_pass
=== RUN   TestRateLimitMiddleware/multiple_requests_under_limit_should_pass
=== RUN   TestRateLimitMiddleware/websocket_request_should_bypass_rate_limit
--- PASS: TestRateLimitMiddleware (0.02s)
    --- PASS: TestRateLimitMiddleware/single_request_should_pass (0.00s)
    --- PASS: TestRateLimitMiddleware/multiple_requests_under_limit_should_pass (0.02s)
    --- PASS: TestRateLimitMiddleware/websocket_request_should_bypass_rate_limit (0.00s)
=== RUN   TestRateLimitMiddleware_Headers
--- PASS: TestRateLimitMiddleware_Headers (0.00s)
=== RUN   TestLoginRateLimitMiddleware
=== RUN   TestLoginRateLimitMiddleware/single_login_request_should_pass
=== RUN   TestLoginRateLimitMiddleware/multiple_rapid_login_requests_should_hit_limit
--- PASS: TestLoginRateLimitMiddleware (0.00s)
    --- PASS: TestLoginRateLimitMiddleware/single_login_request_should_pass (0.00s)
    --- PASS: TestLoginRateLimitMiddleware/multiple_rapid_login_requests_should_hit_limit (0.00s)
=== RUN   TestGetClientIP
=== RUN   TestGetClientIP/X-Real-IP_header_should_be_used_first
    ratelimit_test.go:272: getClientIP() = 192.168.1.1, want 10.0.0.1
=== RUN   TestGetClientIP/X-Forwarded-For_should_be_used_if_X-Real-IP_not_present
    ratelimit_test.go:272: getClientIP() = 192.168.1.1, want 10.0.0.2
=== RUN   TestGetClientIP/X-Forwarded-For_with_multiple_IPs_should_use_first
    ratelimit_test.go:272: getClientIP() = 192.168.1.1, want 10.0.0.3
=== RUN   TestGetClientIP/RemoteAddr_should_be_used_as_fallback
--- FAIL: TestGetClientIP (0.00s)
    --- FAIL: TestGetClientIP/X-Real-IP_header_should_be_used_first (0.00s)
    --- FAIL: TestGetClientIP/X-Forwarded-For_should_be_used_if_X-Real-IP_not_present (0.00s)
    --- FAIL: TestGetClientIP/X-Forwarded-For_with_multiple_IPs_should_use_first (0.00s)
    --- PASS: TestGetClientIP/RemoteAddr_should_be_used_as_fallback (0.00s)
=== RUN   TestRateLimiterMap_CleanupInactive
--- PASS: TestRateLimiterMap_CleanupInactive (0.00s)
=== RUN   TestSecurityHeadersMiddleware
=== RUN   TestSecurityHeadersMiddleware/API_route_with_HTTP
=== RUN   TestSecurityHeadersMiddleware/API_route_with_HTTPS
=== RUN   TestSecurityHeadersMiddleware/Static_route
--- PASS: TestSecurityHeadersMiddleware (0.00s)
    --- PASS: TestSecurityHeadersMiddleware/API_route_with_HTTP (0.00s)
    --- PASS: TestSecurityHeadersMiddleware/API_route_with_HTTPS (0.00s)
    --- PASS: TestSecurityHeadersMiddleware/Static_route (0.00s)
=== RUN   TestBuildCSP
=== RUN   TestBuildCSP/API_route
=== RUN   TestBuildCSP/Static_route
=== RUN   TestBuildCSP/Assets_route
--- PASS: TestBuildCSP (0.00s)
    --- PASS: TestBuildCSP/API_route (0.00s)
    --- PASS: TestBuildCSP/Static_route (0.00s)
    --- PASS: TestBuildCSP/Assets_route (0.00s)
=== RUN   TestSecurityHeadersHandler
--- PASS: TestSecurityHeadersHandler (0.00s)
=== RUN   TestWebSocketConnectionLimiter_Cleanup
--- PASS: TestWebSocketConnectionLimiter_Cleanup (0.00s)
=== RUN   TestWebSocketLimitMiddleware
--- PASS: TestWebSocketLimitMiddleware (0.00s)
=== RUN   TestWebSocketConnectionLimiter_Decrement
--- PASS: TestWebSocketConnectionLimiter_Decrement (0.00s)
FAIL
FAIL	github.com/flaucha/DKonsole/backend/internal/middleware	0.034s
=== RUN   TestHandlers_Lock
--- PASS: TestHandlers_Lock (0.00s)
=== RUN   TestHandlers_RLock
--- PASS: TestHandlers_RLock (0.00s)
=== RUN   TestNormalizeKind
=== RUN   TestNormalizeKind/HPA_alias
=== RUN   TestNormalizeKind/PVC_alias
=== RUN   TestNormalizeKind/PV_alias
=== RUN   TestNormalizeKind/SC_alias
=== RUN   TestNormalizeKind/SA_alias
=== RUN   TestNormalizeKind/CR_alias
=== RUN   TestNormalizeKind/CRB_alias
=== RUN   TestNormalizeKind/RB_alias
=== RUN   TestNormalizeKind/No_alias
=== RUN   TestNormalizeKind/No_alias_Deployment
=== RUN   TestNormalizeKind/Empty
--- PASS: TestNormalizeKind (0.00s)
    --- PASS: TestNormalizeKind/HPA_alias (0.00s)
    --- PASS: TestNormalizeKind/PVC_alias (0.00s)
    --- PASS: TestNormalizeKind/PV_alias (0.00s)
    --- PASS: TestNormalizeKind/SC_alias (0.00s)
    --- PASS: TestNormalizeKind/SA_alias (0.00s)
    --- PASS: TestNormalizeKind/CR_alias (0.00s)
    --- PASS: TestNormalizeKind/CRB_alias (0.00s)
    --- PASS: TestNormalizeKind/RB_alias (0.00s)
    --- PASS: TestNormalizeKind/No_alias (0.00s)
    --- PASS: TestNormalizeKind/No_alias_Deployment (0.00s)
    --- PASS: TestNormalizeKind/Empty (0.00s)
=== RUN   TestResolveGVR
=== RUN   TestResolveGVR/Pod
=== RUN   TestResolveGVR/Deployment
=== RUN   TestResolveGVR/Service
=== RUN   TestResolveGVR/ConfigMap
=== RUN   TestResolveGVR/Secret
=== RUN   TestResolveGVR/Unknown
--- PASS: TestResolveGVR (0.00s)
    --- PASS: TestResolveGVR/Pod (0.00s)
    --- PASS: TestResolveGVR/Deployment (0.00s)
    --- PASS: TestResolveGVR/Service (0.00s)
    --- PASS: TestResolveGVR/ConfigMap (0.00s)
    --- PASS: TestResolveGVR/Secret (0.00s)
    --- PASS: TestResolveGVR/Unknown (0.00s)
=== RUN   TestResourceMetaMap
--- PASS: TestResourceMetaMap (0.00s)
=== RUN   TestKindAliases
--- PASS: TestKindAliases (0.00s)
=== RUN   TestClusterConfig
--- PASS: TestClusterConfig (0.00s)
=== RUN   TestNamespace
--- PASS: TestNamespace (0.00s)
=== RUN   TestResource
--- PASS: TestResource (0.00s)
=== RUN   TestDeploymentDetails
--- PASS: TestDeploymentDetails (0.00s)
=== RUN   TestClusterStats
--- PASS: TestClusterStats (0.00s)
=== RUN   TestCredentials
--- PASS: TestCredentials (0.00s)
=== RUN   TestClaims
--- PASS: TestClaims (0.00s)
PASS
ok  	github.com/flaucha/DKonsole/backend/internal/models	(cached)
{"fields.level":"warning","level":"warning","msg":"Generated random JWT_SECRET for non-production (set JWT_SECRET to persist sessions)","time":"2025-12-13T11:55:35.663-03:00","type":"warn"}
=== RUN   TestHasNamespaceAccess
=== RUN   TestHasNamespaceAccess/admin_has_access_to_any_namespace
=== RUN   TestHasNamespaceAccess/user_with_view_permission_has_access
=== RUN   TestHasNamespaceAccess/user_with_edit_permission_has_access
=== RUN   TestHasNamespaceAccess/user_without_permission_has_no_access
=== RUN   TestHasNamespaceAccess/user_with_empty_permissions_has_no_access
=== RUN   TestHasNamespaceAccess/no_user_in_context
--- PASS: TestHasNamespaceAccess (0.00s)
    --- PASS: TestHasNamespaceAccess/admin_has_access_to_any_namespace (0.00s)
    --- PASS: TestHasNamespaceAccess/user_with_view_permission_has_access (0.00s)
    --- PASS: TestHasNamespaceAccess/user_with_edit_permission_has_access (0.00s)
    --- PASS: TestHasNamespaceAccess/user_without_permission_has_no_access (0.00s)
    --- PASS: TestHasNamespaceAccess/user_with_empty_permissions_has_no_access (0.00s)
    --- PASS: TestHasNamespaceAccess/no_user_in_context (0.00s)
=== RUN   TestGetPermissionLevel
=== RUN   TestGetPermissionLevel/admin_returns_edit
=== RUN   TestGetPermissionLevel/user_with_view_permission_returns_view
=== RUN   TestGetPermissionLevel/user_with_edit_permission_returns_edit
=== RUN   TestGetPermissionLevel/user_without_access_returns_error
=== RUN   TestGetPermissionLevel/user_with_empty_permissions_has_no_access
=== RUN   TestGetPermissionLevel/no_user_in_context
--- PASS: TestGetPermissionLevel (0.00s)
    --- PASS: TestGetPermissionLevel/admin_returns_edit (0.00s)
    --- PASS: TestGetPermissionLevel/user_with_view_permission_returns_view (0.00s)
    --- PASS: TestGetPermissionLevel/user_with_edit_permission_returns_edit (0.00s)
    --- PASS: TestGetPermissionLevel/user_without_access_returns_error (0.00s)
    --- PASS: TestGetPermissionLevel/user_with_empty_permissions_has_no_access (0.00s)
    --- PASS: TestGetPermissionLevel/no_user_in_context (0.00s)
=== RUN   TestCanPerformAction
=== RUN   TestCanPerformAction/admin_can_perform_view_action
=== RUN   TestCanPerformAction/admin_can_perform_edit_action
=== RUN   TestCanPerformAction/user_with_view_permission_can_perform_view_action
=== RUN   TestCanPerformAction/user_with_view_permission_cannot_perform_edit_action
=== RUN   TestCanPerformAction/user_with_edit_permission_can_perform_edit_action
=== RUN   TestCanPerformAction/user_with_edit_permission_can_perform_view_action
=== RUN   TestCanPerformAction/invalid_action_returns_error
=== RUN   TestCanPerformAction/no_user_in_context
--- PASS: TestCanPerformAction (0.00s)
    --- PASS: TestCanPerformAction/admin_can_perform_view_action (0.00s)
    --- PASS: TestCanPerformAction/admin_can_perform_edit_action (0.00s)
    --- PASS: TestCanPerformAction/user_with_view_permission_can_perform_view_action (0.00s)
    --- PASS: TestCanPerformAction/user_with_view_permission_cannot_perform_edit_action (0.00s)
    --- PASS: TestCanPerformAction/user_with_edit_permission_can_perform_edit_action (0.00s)
    --- PASS: TestCanPerformAction/user_with_edit_permission_can_perform_view_action (0.00s)
    --- PASS: TestCanPerformAction/invalid_action_returns_error (0.00s)
    --- PASS: TestCanPerformAction/no_user_in_context (0.00s)
=== RUN   TestIsAdmin
=== RUN   TestIsAdmin/core_admin_is_admin
=== RUN   TestIsAdmin/user_in_LDAP_admin_group_is_admin
=== RUN   TestIsAdmin/user_not_in_LDAP_admin_group_is_not_admin
=== RUN   TestIsAdmin/regular_user_is_not_admin
=== RUN   TestIsAdmin/LDAP_disabled_means_no_LDAP_admin_check
=== RUN   TestIsAdmin/no_user_in_context
--- PASS: TestIsAdmin (0.00s)
    --- PASS: TestIsAdmin/core_admin_is_admin (0.00s)
    --- PASS: TestIsAdmin/user_in_LDAP_admin_group_is_admin (0.00s)
    --- PASS: TestIsAdmin/user_not_in_LDAP_admin_group_is_not_admin (0.00s)
    --- PASS: TestIsAdmin/regular_user_is_not_admin (0.00s)
    --- PASS: TestIsAdmin/LDAP_disabled_means_no_LDAP_admin_check (0.00s)
    --- PASS: TestIsAdmin/no_user_in_context (0.00s)
=== RUN   TestRequireAdmin
=== RUN   TestRequireAdmin/core_admin_passes
=== RUN   TestRequireAdmin/LDAP_admin_passes
=== RUN   TestRequireAdmin/regular_user_fails
=== RUN   TestRequireAdmin/no_user_in_context
--- PASS: TestRequireAdmin (0.00s)
    --- PASS: TestRequireAdmin/core_admin_passes (0.00s)
    --- PASS: TestRequireAdmin/LDAP_admin_passes (0.00s)
    --- PASS: TestRequireAdmin/regular_user_fails (0.00s)
    --- PASS: TestRequireAdmin/no_user_in_context (0.00s)
=== RUN   TestGetUserFromContext
=== RUN   TestGetUserFromContext/valid_user_from_AuthClaims
=== RUN   TestGetUserFromContext/valid_user_from_models.Claims
=== RUN   TestGetUserFromContext/no_user_in_context
=== RUN   TestGetUserFromContext/invalid_user_type_in_context
=== RUN   TestGetUserFromContext/user_from_map_(legacy_format)
--- PASS: TestGetUserFromContext (0.00s)
    --- PASS: TestGetUserFromContext/valid_user_from_AuthClaims (0.00s)
    --- PASS: TestGetUserFromContext/valid_user_from_models.Claims (0.00s)
    --- PASS: TestGetUserFromContext/no_user_in_context (0.00s)
    --- PASS: TestGetUserFromContext/invalid_user_type_in_context (0.00s)
    --- PASS: TestGetUserFromContext/user_from_map_(legacy_format) (0.00s)
=== RUN   TestFilterAllowedNamespaces
=== RUN   TestFilterAllowedNamespaces/admin_sees_all_namespaces
=== RUN   TestFilterAllowedNamespaces/user_sees_only_allowed_namespaces
=== RUN   TestFilterAllowedNamespaces/user_with_no_permissions_sees_none
=== RUN   TestFilterAllowedNamespaces/user_with_empty_permissions_sees_none
=== RUN   TestFilterAllowedNamespaces/no_user_in_context
--- PASS: TestFilterAllowedNamespaces (0.00s)
    --- PASS: TestFilterAllowedNamespaces/admin_sees_all_namespaces (0.00s)
    --- PASS: TestFilterAllowedNamespaces/user_sees_only_allowed_namespaces (0.00s)
    --- PASS: TestFilterAllowedNamespaces/user_with_no_permissions_sees_none (0.00s)
    --- PASS: TestFilterAllowedNamespaces/user_with_empty_permissions_sees_none (0.00s)
    --- PASS: TestFilterAllowedNamespaces/no_user_in_context (0.00s)
=== RUN   TestGetAllowedNamespaces
=== RUN   TestGetAllowedNamespaces/admin_returns_empty_list_(means_all)
=== RUN   TestGetAllowedNamespaces/user_returns_list_of_allowed_namespaces
=== RUN   TestGetAllowedNamespaces/user_with_no_permissions_returns_empty_list
=== RUN   TestGetAllowedNamespaces/user_with_empty_permissions_returns_empty_list
=== RUN   TestGetAllowedNamespaces/no_user_in_context
--- PASS: TestGetAllowedNamespaces (0.00s)
    --- PASS: TestGetAllowedNamespaces/admin_returns_empty_list_(means_all) (0.00s)
    --- PASS: TestGetAllowedNamespaces/user_returns_list_of_allowed_namespaces (0.00s)
    --- PASS: TestGetAllowedNamespaces/user_with_no_permissions_returns_empty_list (0.00s)
    --- PASS: TestGetAllowedNamespaces/user_with_empty_permissions_returns_empty_list (0.00s)
    --- PASS: TestGetAllowedNamespaces/no_user_in_context (0.00s)
=== RUN   TestFilterResources
=== RUN   TestFilterResources/admin_sees_all_resources
=== RUN   TestFilterResources/user_sees_only_resources_in_allowed_namespaces
{"kind":"Pod","level":"warning","msg":"Filtered out resource due to lack of namespace access","name":"res2","namespace":"ns2","time":"2025-12-13T11:55:35.665-03:00","type":"warn"}
=== RUN   TestFilterResources/cluster-scoped_resources_are_visible_to_all_users
{"kind":"Pod","level":"warning","msg":"Filtered out resource due to lack of namespace access","name":"res2","namespace":"ns2","time":"2025-12-13T11:55:35.665-03:00","type":"warn"}
=== RUN   TestFilterResources/user_with_no_permissions_sees_only_cluster-scoped_resources
{"kind":"Pod","level":"warning","msg":"Filtered out resource due to lack of namespace access","name":"res1","namespace":"ns1","time":"2025-12-13T11:55:35.665-03:00","type":"warn"}
=== RUN   TestFilterResources/no_user_in_context
--- PASS: TestFilterResources (0.00s)
    --- PASS: TestFilterResources/admin_sees_all_resources (0.00s)
    --- PASS: TestFilterResources/user_sees_only_resources_in_allowed_namespaces (0.00s)
    --- PASS: TestFilterResources/cluster-scoped_resources_are_visible_to_all_users (0.00s)
    --- PASS: TestFilterResources/user_with_no_permissions_sees_only_cluster-scoped_resources (0.00s)
    --- PASS: TestFilterResources/no_user_in_context (0.00s)
=== RUN   TestNewService
--- PASS: TestNewService (0.00s)
=== RUN   TestSetLDAPAdminChecker
--- PASS: TestSetLDAPAdminChecker (0.00s)
=== RUN   TestValidateNamespaceAccess
=== RUN   TestValidateNamespaceAccess/admin_has_access
=== RUN   TestValidateNamespaceAccess/user_with_permission_has_access
=== RUN   TestValidateNamespaceAccess/user_without_permission_denied
=== RUN   TestValidateNamespaceAccess/no_user_in_context
--- PASS: TestValidateNamespaceAccess (0.00s)
    --- PASS: TestValidateNamespaceAccess/admin_has_access (0.00s)
    --- PASS: TestValidateNamespaceAccess/user_with_permission_has_access (0.00s)
    --- PASS: TestValidateNamespaceAccess/user_without_permission_denied (0.00s)
    --- PASS: TestValidateNamespaceAccess/no_user_in_context (0.00s)
=== RUN   TestValidateAction
=== RUN   TestValidateAction/admin_can_perform_any_action
=== RUN   TestValidateAction/user_with_edit_permission_can_perform_edit
=== RUN   TestValidateAction/user_with_view_permission_can_perform_view
=== RUN   TestValidateAction/user_with_view_permission_cannot_perform_edit
=== RUN   TestValidateAction/invalid_action_returns_error
=== RUN   TestValidateAction/no_user_in_context
--- PASS: TestValidateAction (0.00s)
    --- PASS: TestValidateAction/admin_can_perform_any_action (0.00s)
    --- PASS: TestValidateAction/user_with_edit_permission_can_perform_edit (0.00s)
    --- PASS: TestValidateAction/user_with_view_permission_can_perform_view (0.00s)
    --- PASS: TestValidateAction/user_with_view_permission_cannot_perform_edit (0.00s)
    --- PASS: TestValidateAction/invalid_action_returns_error (0.00s)
    --- PASS: TestValidateAction/no_user_in_context (0.00s)
PASS
ok  	github.com/flaucha/DKonsole/backend/internal/permissions	(cached)
{"fields.level":"warning","level":"warning","msg":"Generated random JWT_SECRET for non-production (set JWT_SECRET to persist sessions)","time":"2025-12-13T11:58:32.337-03:00","type":"warn"}
=== RUN   TestK8sEventRepository_GetEvents_Success
--- PASS: TestK8sEventRepository_GetEvents_Success (0.00s)
=== RUN   TestK8sEventRepository_GetEvents_Error
--- PASS: TestK8sEventRepository_GetEvents_Error (0.00s)
=== RUN   TestExecService_CreateExecutor
=== RUN   TestExecService_CreateExecutor/Success
=== RUN   TestExecService_CreateExecutor/Executor_Creation_Fail
--- PASS: TestExecService_CreateExecutor (0.00s)
    --- PASS: TestExecService_CreateExecutor/Success (0.00s)
    --- PASS: TestExecService_CreateExecutor/Executor_Creation_Fail (0.00s)
=== RUN   TestExecService_RequestStructure
--- PASS: TestExecService_RequestStructure (0.00s)
=== RUN   TestExecService_Security_NoCommandInjection
--- PASS: TestExecService_Security_NoCommandInjection (0.00s)
=== RUN   TestExecService_ValidationIntegration
--- PASS: TestExecService_ValidationIntegration (0.00s)
=== RUN   TestService_ExecIntoPod_Mocked
=== RUN   TestService_ExecIntoPod_Mocked/ExecIntoPod_Success
{"container":"c1","level":"info","msg":"WebSocket upgraded successfully","pod":"default/pod-1","time":"2025-12-13T11:58:32.339-03:00","type":"info"}
=== RUN   TestService_ExecIntoPod_Mocked/ExecIntoPod_Missing_Params
=== RUN   TestService_ExecIntoPod_Mocked/ExecIntoPod_Cluster_Client_Error
=== RUN   TestService_ExecIntoPod_Mocked/ExecIntoPod_Forbidden
=== RUN   TestService_ExecIntoPod_Mocked/ExecIntoPod_Message_Filtering
{"container":"c1","level":"info","msg":"WebSocket upgraded successfully","pod":"default/pod-1","time":"2025-12-13T11:58:32.341-03:00","type":"info"}
=== RUN   TestService_ExecIntoPod_Mocked/ExecIntoPod_Allowed_Origins
{"container":"c1","level":"info","msg":"WebSocket upgraded successfully","pod":"default/pod-1","time":"2025-12-13T11:58:32.392-03:00","type":"info"}
{"error":"websocket: request origin not allowed by Upgrader.CheckOrigin","host":"127.0.0.1:36985","level":"error","message":"WebSocket upgrade failed","msg":"WebSocket upgrade failed","origin":"https://malicious.com","pod":"default/pod-1","time":"2025-12-13T11:58:32.393-03:00","type":"error"}
--- PASS: TestService_ExecIntoPod_Mocked (0.05s)
    --- PASS: TestService_ExecIntoPod_Mocked/ExecIntoPod_Success (0.00s)
    --- PASS: TestService_ExecIntoPod_Mocked/ExecIntoPod_Missing_Params (0.00s)
    --- PASS: TestService_ExecIntoPod_Mocked/ExecIntoPod_Cluster_Client_Error (0.00s)
    --- PASS: TestService_ExecIntoPod_Mocked/ExecIntoPod_Forbidden (0.00s)
    --- PASS: TestService_ExecIntoPod_Mocked/ExecIntoPod_Message_Filtering (0.05s)
    --- PASS: TestService_ExecIntoPod_Mocked/ExecIntoPod_Allowed_Origins (0.00s)
=== RUN   TestSetWebSocketCORSHeaders
--- PASS: TestSetWebSocketCORSHeaders (0.00s)
=== RUN   TestSetWebSocketCORSHeaders_NoOrigin
--- PASS: TestSetWebSocketCORSHeaders_NoOrigin (0.00s)
=== RUN   TestK8sLogRepository_GetLogStream
--- PASS: TestK8sLogRepository_GetLogStream (0.00s)
=== RUN   TestLogService_StreamLogs
=== RUN   TestLogService_StreamLogs/successful_log_stream
=== RUN   TestLogService_StreamLogs/stream_logs_with_follow
=== RUN   TestLogService_StreamLogs/stream_logs_with_container_specified
=== RUN   TestLogService_StreamLogs/repository_error
=== RUN   TestLogService_StreamLogs/stream_logs_with_container_and_follow
--- PASS: TestLogService_StreamLogs (0.00s)
    --- PASS: TestLogService_StreamLogs/successful_log_stream (0.00s)
    --- PASS: TestLogService_StreamLogs/stream_logs_with_follow (0.00s)
    --- PASS: TestLogService_StreamLogs/stream_logs_with_container_specified (0.00s)
    --- PASS: TestLogService_StreamLogs/repository_error (0.00s)
    --- PASS: TestLogService_StreamLogs/stream_logs_with_container_and_follow (0.00s)
=== RUN   TestDefaultFactories
--- PASS: TestDefaultFactories (0.00s)
=== RUN   TestStreamPodLogs_InvalidParams
--- PASS: TestStreamPodLogs_InvalidParams (0.00s)
=== RUN   TestStreamPodLogs_Forbidden
--- PASS: TestStreamPodLogs_Forbidden (0.00s)
=== RUN   TestGetPodEvents_Forbidden
--- PASS: TestGetPodEvents_Forbidden (0.00s)
=== RUN   TestExecIntoPod_PermissionDenied
--- PASS: TestExecIntoPod_PermissionDenied (0.00s)
=== RUN   TestStreamPodLogs_ClientError
--- PASS: TestStreamPodLogs_ClientError (0.00s)
=== RUN   TestStreamPodLogs_Success
--- PASS: TestStreamPodLogs_Success (0.00s)
=== RUN   TestExecIntoPod_MissingClient
--- PASS: TestExecIntoPod_MissingClient (0.00s)
=== RUN   TestExecIntoPod_MissingRESTConfig
--- PASS: TestExecIntoPod_MissingRESTConfig (0.00s)
=== RUN   TestExecIntoPod_SuccessWithMockExecutor
{"container":"","level":"info","msg":"WebSocket upgraded successfully","pod":"ns1/pod1","time":"2025-12-13T11:58:32.395-03:00","type":"info"}
--- PASS: TestExecIntoPod_SuccessWithMockExecutor (0.00s)
=== RUN   TestGetPodEvents_Success
--- PASS: TestGetPodEvents_Success (0.00s)
=== RUN   TestGetPodEvents_RepoError
--- PASS: TestGetPodEvents_RepoError (0.00s)
=== RUN   TestGetPodEvents_InvalidParams
--- PASS: TestGetPodEvents_InvalidParams (0.00s)
=== RUN   TestGetPodEvents_ClientError
--- PASS: TestGetPodEvents_ClientError (0.00s)
=== RUN   TestStreamPodLogs_AuthError
--- PASS: TestStreamPodLogs_AuthError (0.00s)
=== RUN   TestPodService_GetPodEvents
=== RUN   TestPodService_GetPodEvents/successful_events_retrieval
=== RUN   TestPodService_GetPodEvents/empty_events_list
=== RUN   TestPodService_GetPodEvents/repository_error
=== RUN   TestPodService_GetPodEvents/events_sorted_by_LastSeen_(most_recent_first)
--- PASS: TestPodService_GetPodEvents (0.00s)
    --- PASS: TestPodService_GetPodEvents/successful_events_retrieval (0.00s)
    --- PASS: TestPodService_GetPodEvents/empty_events_list (0.00s)
    --- PASS: TestPodService_GetPodEvents/repository_error (0.00s)
    --- PASS: TestPodService_GetPodEvents/events_sorted_by_LastSeen_(most_recent_first) (0.00s)
PASS
ok  	github.com/flaucha/DKonsole/backend/internal/pod	(cached)
=== RUN   TestHTTPHandler_IsConfigured
--- PASS: TestHTTPHandler_IsConfigured (0.04s)
=== RUN   TestHTTPHandler_HealthCheck
=== RUN   TestHTTPHandler_HealthCheck/not_configured
=== RUN   TestHTTPHandler_HealthCheck/healthy
=== RUN   TestHTTPHandler_HealthCheck/unhealthy
--- PASS: TestHTTPHandler_HealthCheck (0.00s)
    --- PASS: TestHTTPHandler_HealthCheck/not_configured (0.00s)
    --- PASS: TestHTTPHandler_HealthCheck/healthy (0.00s)
    --- PASS: TestHTTPHandler_HealthCheck/unhealthy (0.00s)
=== RUN   TestHTTPHandler_GetMetrics
=== RUN   TestHTTPHandler_GetMetrics/missing_params
{"deployment":"","level":"warning","msg":"Missing deployment or namespace","namespace":"","time":"2025-12-13T11:55:36.546-03:00","type":"warn"}
=== RUN   TestHTTPHandler_GetMetrics/success
=== RUN   TestHTTPHandler_GetMetrics/not_configured
{"level":"warning","msg":"Prometheus URL not configured","time":"2025-12-13T11:55:36.546-03:00","type":"warn"}
=== RUN   TestHTTPHandler_GetMetrics/service_error
--- PASS: TestHTTPHandler_GetMetrics (0.00s)
    --- PASS: TestHTTPHandler_GetMetrics/missing_params (0.00s)
    --- PASS: TestHTTPHandler_GetMetrics/success (0.00s)
    --- PASS: TestHTTPHandler_GetMetrics/not_configured (0.00s)
    --- PASS: TestHTTPHandler_GetMetrics/service_error (0.00s)
=== RUN   TestHTTPHandler_GetClusterOverview
=== RUN   TestHTTPHandler_GetClusterOverview/not_configured
=== RUN   TestHTTPHandler_GetClusterOverview/success
--- PASS: TestHTTPHandler_GetClusterOverview (0.00s)
    --- PASS: TestHTTPHandler_GetClusterOverview/not_configured (0.00s)
    --- PASS: TestHTTPHandler_GetClusterOverview/success (0.00s)
=== RUN   TestHTTPHandler_GetStatus
--- PASS: TestHTTPHandler_GetStatus (0.00s)
=== RUN   TestHTTPHandler_GetPodMetrics
=== RUN   TestHTTPHandler_GetPodMetrics/missing_params
=== RUN   TestHTTPHandler_GetPodMetrics/success
=== RUN   TestHTTPHandler_GetPodMetrics/not_configured
--- PASS: TestHTTPHandler_GetPodMetrics (0.00s)
    --- PASS: TestHTTPHandler_GetPodMetrics/missing_params (0.00s)
    --- PASS: TestHTTPHandler_GetPodMetrics/success (0.00s)
    --- PASS: TestHTTPHandler_GetPodMetrics/not_configured (0.00s)
=== RUN   TestGetNodeMetrics
--- PASS: TestGetNodeMetrics (0.00s)
=== RUN   TestHTTPPrometheusRepository_QueryRange
--- PASS: TestHTTPPrometheusRepository_QueryRange (0.00s)
=== RUN   TestHTTPPrometheusRepository_QueryInstant
--- PASS: TestHTTPPrometheusRepository_QueryInstant (0.00s)
=== RUN   TestIsControlPlaneNode
=== RUN   TestIsControlPlaneNode/node_with_control-plane_label
=== RUN   TestIsControlPlaneNode/node_with_master_label
=== RUN   TestIsControlPlaneNode/worker_node_without_control-plane_labels
=== RUN   TestIsControlPlaneNode/node_with_control-plane_taint
=== RUN   TestIsControlPlaneNode/node_with_master_taint
=== RUN   TestIsControlPlaneNode/worker_node_with_other_taints
--- PASS: TestIsControlPlaneNode (0.00s)
    --- PASS: TestIsControlPlaneNode/node_with_control-plane_label (0.00s)
    --- PASS: TestIsControlPlaneNode/node_with_master_label (0.00s)
    --- PASS: TestIsControlPlaneNode/worker_node_without_control-plane_labels (0.00s)
    --- PASS: TestIsControlPlaneNode/node_with_control-plane_taint (0.00s)
    --- PASS: TestIsControlPlaneNode/node_with_master_taint (0.00s)
    --- PASS: TestIsControlPlaneNode/worker_node_with_other_taints (0.00s)
=== RUN   TestService_GetDeploymentMetrics
=== RUN   TestService_GetDeploymentMetrics/successful_get_deployment_metrics
=== RUN   TestService_GetDeploymentMetrics/invalid_namespace_parameter
=== RUN   TestService_GetDeploymentMetrics/invalid_deployment_parameter
=== RUN   TestService_GetDeploymentMetrics/CPU_query_error
=== RUN   TestService_GetDeploymentMetrics/Memory_query_error
--- PASS: TestService_GetDeploymentMetrics (0.00s)
    --- PASS: TestService_GetDeploymentMetrics/successful_get_deployment_metrics (0.00s)
    --- PASS: TestService_GetDeploymentMetrics/invalid_namespace_parameter (0.00s)
    --- PASS: TestService_GetDeploymentMetrics/invalid_deployment_parameter (0.00s)
    --- PASS: TestService_GetDeploymentMetrics/CPU_query_error (0.00s)
    --- PASS: TestService_GetDeploymentMetrics/Memory_query_error (0.00s)
=== RUN   TestService_GetPodMetrics
=== RUN   TestService_GetPodMetrics/successful_get_pod_metrics
=== RUN   TestService_GetPodMetrics/invalid_namespace_parameter
=== RUN   TestService_GetPodMetrics/invalid_pod_name_parameter
--- PASS: TestService_GetPodMetrics (0.00s)
    --- PASS: TestService_GetPodMetrics/successful_get_pod_metrics (0.00s)
    --- PASS: TestService_GetPodMetrics/invalid_namespace_parameter (0.00s)
    --- PASS: TestService_GetPodMetrics/invalid_pod_name_parameter (0.00s)
=== RUN   TestService_CalculateClusterStats
=== RUN   TestService_CalculateClusterStats/single_worker_node
=== RUN   TestService_CalculateClusterStats/multiple_worker_nodes
=== RUN   TestService_CalculateClusterStats/worker_nodes_with_control_plane_excluded_from_stats
=== RUN   TestService_CalculateClusterStats/empty_nodes_list
--- PASS: TestService_CalculateClusterStats (0.00s)
    --- PASS: TestService_CalculateClusterStats/single_worker_node (0.00s)
    --- PASS: TestService_CalculateClusterStats/multiple_worker_nodes (0.00s)
    --- PASS: TestService_CalculateClusterStats/worker_nodes_with_control_plane_excluded_from_stats (0.00s)
    --- PASS: TestService_CalculateClusterStats/empty_nodes_list (0.00s)
=== RUN   TestValidatePromQLParam
=== RUN   TestValidatePromQLParam/valid_namespace
=== RUN   TestValidatePromQLParam/valid_deployment_name_with_hyphens
=== RUN   TestValidatePromQLParam/valid_pod_name_with_dots
=== RUN   TestValidatePromQLParam/invalid_characters_-_spaces
=== RUN   TestValidatePromQLParam/invalid_characters_-_special_chars
=== RUN   TestValidatePromQLParam/empty_param
=== RUN   TestValidatePromQLParam/too_long_param
=== RUN   TestValidatePromQLParam/param_at_max_length_(253)
--- PASS: TestValidatePromQLParam (0.00s)
    --- PASS: TestValidatePromQLParam/valid_namespace (0.00s)
    --- PASS: TestValidatePromQLParam/valid_deployment_name_with_hyphens (0.00s)
    --- PASS: TestValidatePromQLParam/valid_pod_name_with_dots (0.00s)
    --- PASS: TestValidatePromQLParam/invalid_characters_-_spaces (0.00s)
    --- PASS: TestValidatePromQLParam/invalid_characters_-_special_chars (0.00s)
    --- PASS: TestValidatePromQLParam/empty_param (0.00s)
    --- PASS: TestValidatePromQLParam/too_long_param (0.00s)
    --- PASS: TestValidatePromQLParam/param_at_max_length_(253) (0.00s)
=== RUN   TestParseDuration
=== RUN   TestParseDuration/1h_range
=== RUN   TestParseDuration/6h_range
=== RUN   TestParseDuration/12h_range
=== RUN   TestParseDuration/1d_range
=== RUN   TestParseDuration/7d_range
=== RUN   TestParseDuration/15d_range
=== RUN   TestParseDuration/empty_range_defaults_to_1h
=== RUN   TestParseDuration/invalid_range_defaults_to_1h
--- PASS: TestParseDuration (0.00s)
    --- PASS: TestParseDuration/1h_range (0.00s)
    --- PASS: TestParseDuration/6h_range (0.00s)
    --- PASS: TestParseDuration/12h_range (0.00s)
    --- PASS: TestParseDuration/1d_range (0.00s)
    --- PASS: TestParseDuration/7d_range (0.00s)
    --- PASS: TestParseDuration/15d_range (0.00s)
    --- PASS: TestParseDuration/empty_range_defaults_to_1h (0.00s)
    --- PASS: TestParseDuration/invalid_range_defaults_to_1h (0.00s)
PASS
ok  	github.com/flaucha/DKonsole/backend/internal/prometheus	(cached)
{"fields.level":"warning","level":"warning","msg":"Generated random JWT_SECRET for non-production (set JWT_SECRET to persist sessions)","time":"2025-12-13T12:16:38.436-03:00","type":"warn"}
=== RUN   TestRouter_HelmRoutes_Coverage
{"level":"warning","msg":"Static directory not found, frontend will not be served","static_dir":"/tmp/TestRouter_HelmRoutes_Coverage3932823097/001/static","time":"2025-12-13T12:16:38.469-03:00","type":"warn"}
{"level":"info","msg":"AuthMiddleware: extracted claims from JWT","permissions":null,"role":"admin","time":"2025-12-13T12:16:38.469-03:00","type":"info","username":"admin"}
{"action":"http_request","duration":"179.15s","ip":"192.0.2.1","level":"info","method":"GET","msg":"audit log","path":"/api/helm/releases","status":200,"success":true,"time":"2025-12-13T12:16:38.470-03:00","type":"audit","user":"anonymous","user_agent":""}
{"level":"info","msg":"AuthMiddleware: extracted claims from JWT","permissions":null,"role":"admin","time":"2025-12-13T12:16:38.470-03:00","type":"info","username":"admin"}
{"action":"http_request","duration":"31.789s","ip":"192.0.2.1","level":"info","method":"POST","msg":"audit log","path":"/api/helm/releases/install","status":400,"success":false,"time":"2025-12-13T12:16:38.470-03:00","type":"audit","user":"anonymous","user_agent":""}
{"level":"info","msg":"AuthMiddleware: extracted claims from JWT","permissions":null,"role":"admin","time":"2025-12-13T12:16:38.470-03:00","type":"info","username":"admin"}
{"action":"http_request","duration":"23.04s","ip":"192.0.2.1","level":"info","method":"PUT","msg":"audit log","path":"/api/helm/releases/install","status":405,"success":false,"time":"2025-12-13T12:16:38.470-03:00","type":"audit","user":"anonymous","user_agent":""}
{"level":"info","msg":"AuthMiddleware: extracted claims from JWT","permissions":null,"role":"admin","time":"2025-12-13T12:16:38.470-03:00","type":"info","username":"admin"}
{"action":"http_request","duration":"20.94s","ip":"192.0.2.1","level":"info","method":"PUT","msg":"audit log","path":"/api/helm/releases","status":405,"success":false,"time":"2025-12-13T12:16:38.470-03:00","type":"audit","user":"anonymous","user_agent":""}
--- PASS: TestRouter_HelmRoutes_Coverage (0.03s)
=== RUN   TestRouter_OtherRoutes_Coverage
{"level":"warning","msg":"Static directory not found, frontend will not be served","static_dir":"/tmp/TestRouter_OtherRoutes_Coverage648731230/001/static","time":"2025-12-13T12:16:38.471-03:00","type":"warn"}
=== RUN   TestRouter_OtherRoutes_Coverage/GET_/api/logo
{"action":"http_request","duration":"40.09s","ip":"192.0.2.1","level":"info","method":"GET","msg":"audit log","path":"/api/logo","status":204,"success":true,"time":"2025-12-13T12:16:38.471-03:00","type":"audit","user":"anonymous","user_agent":""}
=== RUN   TestRouter_OtherRoutes_Coverage/POST_/api/logo
=== RUN   TestRouter_OtherRoutes_Coverage/DELETE_/api/logo
=== RUN   TestRouter_OtherRoutes_Coverage/GET_/api/prometheus/status
{"action":"http_request","duration":"11.3s","ip":"192.0.2.1","level":"info","method":"GET","msg":"audit log","path":"/api/prometheus/status","status":401,"success":false,"time":"2025-12-13T12:16:38.471-03:00","type":"audit","user":"anonymous","user_agent":""}
=== RUN   TestRouter_OtherRoutes_Coverage/GET_/api/prometheus/metrics
{"action":"http_request","duration":"7.08s","ip":"192.0.2.1","level":"info","method":"GET","msg":"audit log","path":"/api/prometheus/metrics","status":401,"success":false,"time":"2025-12-13T12:16:38.471-03:00","type":"audit","user":"anonymous","user_agent":""}
=== RUN   TestRouter_OtherRoutes_Coverage/GET_/api/prometheus/pod-metrics
{"action":"http_request","duration":"5.96s","ip":"192.0.2.1","level":"info","method":"GET","msg":"audit log","path":"/api/prometheus/pod-metrics","status":401,"success":false,"time":"2025-12-13T12:16:38.471-03:00","type":"audit","user":"anonymous","user_agent":""}
=== RUN   TestRouter_OtherRoutes_Coverage/GET_/api/prometheus/cluster-overview
{"action":"http_request","duration":"6.15s","ip":"192.0.2.1","level":"info","method":"GET","msg":"audit log","path":"/api/prometheus/cluster-overview","status":401,"success":false,"time":"2025-12-13T12:16:38.471-03:00","type":"audit","user":"anonymous","user_agent":""}
=== RUN   TestRouter_OtherRoutes_Coverage/GET_/api/settings/prometheus/url
{"action":"http_request","duration":"7.23s","ip":"192.0.2.1","level":"info","method":"GET","msg":"audit log","path":"/api/settings/prometheus/url","status":401,"success":false,"time":"2025-12-13T12:16:38.471-03:00","type":"audit","user":"anonymous","user_agent":""}
=== RUN   TestRouter_OtherRoutes_Coverage/PUT_/api/settings/prometheus/url
=== RUN   TestRouter_OtherRoutes_Coverage/GET_/api/ldap/status
{"action":"http_request","duration":"20.79s","ip":"192.0.2.1","level":"info","method":"GET","msg":"audit log","path":"/api/ldap/status","status":200,"success":true,"time":"2025-12-13T12:16:38.471-03:00","type":"audit","user":"anonymous","user_agent":""}
=== RUN   TestRouter_OtherRoutes_Coverage/GET_/api/ldap/config
{"action":"http_request","duration":"10.87s","ip":"192.0.2.1","level":"info","method":"GET","msg":"audit log","path":"/api/ldap/config","status":401,"success":false,"time":"2025-12-13T12:16:38.471-03:00","type":"audit","user":"anonymous","user_agent":""}
=== RUN   TestRouter_OtherRoutes_Coverage/PUT_/api/ldap/config
=== RUN   TestRouter_OtherRoutes_Coverage/GET_/api/ldap/groups
{"action":"http_request","duration":"26.36s","ip":"192.0.2.1","level":"info","method":"GET","msg":"audit log","path":"/api/ldap/groups","status":401,"success":false,"time":"2025-12-13T12:16:38.471-03:00","type":"audit","user":"anonymous","user_agent":""}
=== RUN   TestRouter_OtherRoutes_Coverage/PUT_/api/ldap/groups
=== RUN   TestRouter_OtherRoutes_Coverage/GET_/api/ldap/credentials
{"action":"http_request","duration":"7.21s","ip":"192.0.2.1","level":"info","method":"GET","msg":"audit log","path":"/api/ldap/credentials","status":401,"success":false,"time":"2025-12-13T12:16:38.471-03:00","type":"audit","user":"anonymous","user_agent":""}
=== RUN   TestRouter_OtherRoutes_Coverage/PUT_/api/ldap/credentials
=== RUN   TestRouter_OtherRoutes_Coverage/POST_/api/ldap/test
--- PASS: TestRouter_OtherRoutes_Coverage (0.00s)
    --- PASS: TestRouter_OtherRoutes_Coverage/GET_/api/logo (0.00s)
    --- PASS: TestRouter_OtherRoutes_Coverage/POST_/api/logo (0.00s)
    --- PASS: TestRouter_OtherRoutes_Coverage/DELETE_/api/logo (0.00s)
    --- PASS: TestRouter_OtherRoutes_Coverage/GET_/api/prometheus/status (0.00s)
    --- PASS: TestRouter_OtherRoutes_Coverage/GET_/api/prometheus/metrics (0.00s)
    --- PASS: TestRouter_OtherRoutes_Coverage/GET_/api/prometheus/pod-metrics (0.00s)
    --- PASS: TestRouter_OtherRoutes_Coverage/GET_/api/prometheus/cluster-overview (0.00s)
    --- PASS: TestRouter_OtherRoutes_Coverage/GET_/api/settings/prometheus/url (0.00s)
    --- PASS: TestRouter_OtherRoutes_Coverage/PUT_/api/settings/prometheus/url (0.00s)
    --- PASS: TestRouter_OtherRoutes_Coverage/GET_/api/ldap/status (0.00s)
    --- PASS: TestRouter_OtherRoutes_Coverage/GET_/api/ldap/config (0.00s)
    --- PASS: TestRouter_OtherRoutes_Coverage/PUT_/api/ldap/config (0.00s)
    --- PASS: TestRouter_OtherRoutes_Coverage/GET_/api/ldap/groups (0.00s)
    --- PASS: TestRouter_OtherRoutes_Coverage/PUT_/api/ldap/groups (0.00s)
    --- PASS: TestRouter_OtherRoutes_Coverage/GET_/api/ldap/credentials (0.00s)
    --- PASS: TestRouter_OtherRoutes_Coverage/PUT_/api/ldap/credentials (0.00s)
    --- PASS: TestRouter_OtherRoutes_Coverage/POST_/api/ldap/test (0.00s)
=== RUN   TestRegisterStaticRoutes
=== RUN   TestRegisterStaticRoutes/Index_page
=== RUN   TestRegisterStaticRoutes/Robots.txt
=== RUN   TestRegisterStaticRoutes/Asset_JS
=== RUN   TestRegisterStaticRoutes/Asset_CSS
=== RUN   TestRegisterStaticRoutes/API_path_should_verify_not_found_(handled_by_API_router_usually)
=== RUN   TestRegisterStaticRoutes/Missing_Asset
--- PASS: TestRegisterStaticRoutes (0.00s)
    --- PASS: TestRegisterStaticRoutes/Index_page (0.00s)
    --- PASS: TestRegisterStaticRoutes/Robots.txt (0.00s)
    --- PASS: TestRegisterStaticRoutes/Asset_JS (0.00s)
    --- PASS: TestRegisterStaticRoutes/Asset_CSS (0.00s)
    --- PASS: TestRegisterStaticRoutes/API_path_should_verify_not_found_(handled_by_API_router_usually) (0.00s)
    --- PASS: TestRegisterStaticRoutes/Missing_Asset (0.00s)
=== RUN   TestRegisterStaticRoutes_DirNotFound
{"level":"warning","msg":"Static directory not found, frontend will not be served","static_dir":"/path/to/non/existent/dir","time":"2025-12-13T12:16:38.473-03:00","type":"warn"}
--- PASS: TestRegisterStaticRoutes_DirNotFound (0.00s)
=== RUN   TestRouter_HealthAndCORS
{"level":"warning","msg":"Static directory not found, frontend will not be served","static_dir":"/tmp/TestRouter_HealthAndCORS4072690290/001/static","time":"2025-12-13T12:16:38.474-03:00","type":"warn"}
--- PASS: TestRouter_HealthAndCORS (0.00s)
=== RUN   TestRouter_ReadyzVariants
{"level":"warning","msg":"Static directory not found, frontend will not be served","static_dir":"/tmp/TestRouter_ReadyzVariants3656501359/001/static","time":"2025-12-13T12:16:38.474-03:00","type":"warn"}
--- PASS: TestRouter_ReadyzVariants (0.00s)
=== RUN   TestContentTypeFixer_WriteHeader
--- PASS: TestContentTypeFixer_WriteHeader (0.00s)
=== RUN   TestRouter_StaticFiles
=== RUN   TestRouter_StaticFiles/serve_index.html
=== RUN   TestRouter_StaticFiles/serve_asset
=== RUN   TestRouter_StaticFiles/404_for_unknown
=== RUN   TestRouter_StaticFiles/404_for_api
--- PASS: TestRouter_StaticFiles (0.00s)
    --- PASS: TestRouter_StaticFiles/serve_index.html (0.00s)
    --- PASS: TestRouter_StaticFiles/serve_asset (0.00s)
    --- PASS: TestRouter_StaticFiles/404_for_unknown (0.00s)
    --- PASS: TestRouter_StaticFiles/404_for_api (0.00s)
=== RUN   TestEnableCors
=== RUN   TestEnableCors/no_origin
=== RUN   TestEnableCors/same_origin
=== RUN   TestEnableCors/different_origin_allowed_via_env
=== RUN   TestEnableCors/different_origin_denied
{"host":"example.com","level":"warning","msg":"CORS: Origin not allowed","origin":"http://denied.com","path":"/","time":"2025-12-13T12:16:38.475-03:00","type":"warn"}
--- PASS: TestEnableCors (0.00s)
    --- PASS: TestEnableCors/no_origin (0.00s)
    --- PASS: TestEnableCors/same_origin (0.00s)
    --- PASS: TestEnableCors/different_origin_allowed_via_env (0.00s)
    --- PASS: TestEnableCors/different_origin_denied (0.00s)
PASS
ok  	github.com/flaucha/DKonsole/backend/internal/server	(cached)
=== RUN   TestNewRepositoryDefaultsAndEnvNamespace
--- PASS: TestNewRepositoryDefaultsAndEnvNamespace (0.00s)
=== RUN   TestRepository_GetPrometheusURL
--- PASS: TestRepository_GetPrometheusURL (0.00s)
=== RUN   TestRepository_UpdatePrometheusURL_CreateAndUpdate
{"configmap_name":"cfg","level":"info","msg":"Created ConfigMap for Prometheus URL","namespace":"default","time":"2025-12-13T11:55:36.576-03:00","type":"info"}
{"configmap_name":"cfg","level":"info","msg":"Updated Prometheus URL in ConfigMap","namespace":"default","time":"2025-12-13T11:55:36.576-03:00","type":"info","url":"http://second"}
--- PASS: TestRepository_UpdatePrometheusURL_CreateAndUpdate (0.00s)
=== RUN   TestRepository_UpdatePrometheusURL_NoClient
--- PASS: TestRepository_UpdatePrometheusURL_NoClient (0.00s)
=== RUN   TestServiceFactory_NewService
{"error":"could not determine namespace: service account file not found and POD_NAMESPACE not set","level":"warning","msg":"Failed to get current namespace, using default","time":"2025-12-13T11:55:36.577-03:00","type":"warn"}
--- PASS: TestServiceFactory_NewService (0.00s)
=== RUN   TestService_GetPrometheusURLHandler
=== RUN   TestService_GetPrometheusURLHandler/successful_get_URL
=== RUN   TestService_GetPrometheusURLHandler/empty_URL
=== RUN   TestService_GetPrometheusURLHandler/repository_error
--- PASS: TestService_GetPrometheusURLHandler (0.00s)
    --- PASS: TestService_GetPrometheusURLHandler/successful_get_URL (0.00s)
    --- PASS: TestService_GetPrometheusURLHandler/empty_URL (0.00s)
    --- PASS: TestService_GetPrometheusURLHandler/repository_error (0.00s)
=== RUN   TestService_UpdatePrometheusURLHandler
=== RUN   TestService_UpdatePrometheusURLHandler/successful_update_URL
{"level":"info","msg":"Prometheus URL updated","time":"2025-12-13T11:55:36.612-03:00","type":"info","url":"http://prometheus:9090"}
=== RUN   TestService_UpdatePrometheusURLHandler/successful_update_HTTPS_URL
{"level":"info","msg":"Prometheus URL updated","time":"2025-12-13T11:55:36.612-03:00","type":"info","url":"https://prometheus.example.com"}
=== RUN   TestService_UpdatePrometheusURLHandler/empty_URL_(reset)
{"level":"info","msg":"Prometheus URL updated","time":"2025-12-13T11:55:36.612-03:00","type":"info","url":""}
=== RUN   TestService_UpdatePrometheusURLHandler/invalid_JSON
=== RUN   TestService_UpdatePrometheusURLHandler/URL_without_protocol
=== RUN   TestService_UpdatePrometheusURLHandler/invalid_URL_format
=== RUN   TestService_UpdatePrometheusURLHandler/repository_update_error
--- PASS: TestService_UpdatePrometheusURLHandler (0.04s)
    --- PASS: TestService_UpdatePrometheusURLHandler/successful_update_URL (0.04s)
    --- PASS: TestService_UpdatePrometheusURLHandler/successful_update_HTTPS_URL (0.00s)
    --- PASS: TestService_UpdatePrometheusURLHandler/empty_URL_(reset) (0.00s)
    --- PASS: TestService_UpdatePrometheusURLHandler/invalid_JSON (0.00s)
    --- PASS: TestService_UpdatePrometheusURLHandler/URL_without_protocol (0.00s)
    --- PASS: TestService_UpdatePrometheusURLHandler/invalid_URL_format (0.00s)
    --- PASS: TestService_UpdatePrometheusURLHandler/repository_update_error (0.00s)
PASS
ok  	github.com/flaucha/DKonsole/backend/internal/settings	(cached)
=== RUN   TestLoggerFunctions
=== RUN   TestLoggerFunctions/LogInfo
=== RUN   TestLoggerFunctions/LogWarn
=== RUN   TestLoggerFunctions/LogError
=== RUN   TestLoggerFunctions/LogAuditEntry
--- PASS: TestLoggerFunctions (0.00s)
    --- PASS: TestLoggerFunctions/LogInfo (0.00s)
    --- PASS: TestLoggerFunctions/LogWarn (0.00s)
    --- PASS: TestLoggerFunctions/LogError (0.00s)
    --- PASS: TestLoggerFunctions/LogAuditEntry (0.00s)
=== RUN   TestIsSystemNamespace
=== RUN   TestIsSystemNamespace/kube-system
=== RUN   TestIsSystemNamespace/kube-public
=== RUN   TestIsSystemNamespace/kube-node-lease
=== RUN   TestIsSystemNamespace/default
=== RUN   TestIsSystemNamespace/custom-namespace
=== RUN   TestIsSystemNamespace/empty
--- PASS: TestIsSystemNamespace (0.00s)
    --- PASS: TestIsSystemNamespace/kube-system (0.00s)
    --- PASS: TestIsSystemNamespace/kube-public (0.00s)
    --- PASS: TestIsSystemNamespace/kube-node-lease (0.00s)
    --- PASS: TestIsSystemNamespace/default (0.00s)
    --- PASS: TestIsSystemNamespace/custom-namespace (0.00s)
    --- PASS: TestIsSystemNamespace/empty (0.00s)
=== RUN   TestValidateK8sName
=== RUN   TestValidateK8sName/valid_name
=== RUN   TestValidateK8sName/valid_name_with_dot
=== RUN   TestValidateK8sName/valid_name_alphanumeric
=== RUN   TestValidateK8sName/empty_name
=== RUN   TestValidateK8sName/name_too_long
=== RUN   TestValidateK8sName/name_with_uppercase
=== RUN   TestValidateK8sName/name_starting_with_dash
=== RUN   TestValidateK8sName/name_ending_with_dash
=== RUN   TestValidateK8sName/name_with_underscore
--- PASS: TestValidateK8sName (0.00s)
    --- PASS: TestValidateK8sName/valid_name (0.00s)
    --- PASS: TestValidateK8sName/valid_name_with_dot (0.00s)
    --- PASS: TestValidateK8sName/valid_name_alphanumeric (0.00s)
    --- PASS: TestValidateK8sName/empty_name (0.00s)
    --- PASS: TestValidateK8sName/name_too_long (0.00s)
    --- PASS: TestValidateK8sName/name_with_uppercase (0.00s)
    --- PASS: TestValidateK8sName/name_starting_with_dash (0.00s)
    --- PASS: TestValidateK8sName/name_ending_with_dash (0.00s)
    --- PASS: TestValidateK8sName/name_with_underscore (0.00s)
=== RUN   TestCreateTimeoutContext
--- PASS: TestCreateTimeoutContext (0.00s)
=== RUN   TestCreateRequestContext
--- PASS: TestCreateRequestContext (0.00s)
=== RUN   TestHandleError
=== RUN   TestHandleError/internal_error
{"level":"error","message":"Internal server error","msg":"Internal server error","status_code":500,"time":"2025-12-13T11:55:36.570-03:00","type":"error"}
=== RUN   TestHandleError/not_found
{"level":"error","message":"Not found","msg":"Not found","status_code":404,"time":"2025-12-13T11:55:36.570-03:00","type":"error"}
=== RUN   TestHandleError/bad_request
{"level":"error","message":"Bad request","msg":"Bad request","status_code":400,"time":"2025-12-13T11:55:36.570-03:00","type":"error"}
--- PASS: TestHandleError (0.00s)
    --- PASS: TestHandleError/internal_error (0.00s)
    --- PASS: TestHandleError/not_found (0.00s)
    --- PASS: TestHandleError/bad_request (0.00s)
=== RUN   TestCheckQuotaLimits
--- PASS: TestCheckQuotaLimits (0.00s)
=== RUN   TestCheckStorageQuota
--- PASS: TestCheckStorageQuota (0.00s)
=== RUN   TestGetClientIP
=== RUN   TestGetClientIP/X-Forwarded-For
=== RUN   TestGetClientIP/X-Real-IP
=== RUN   TestGetClientIP/RemoteAddr
=== RUN   TestGetClientIP/X-Forwarded-For_multiple_IPs
--- PASS: TestGetClientIP (0.00s)
    --- PASS: TestGetClientIP/X-Forwarded-For (0.00s)
    --- PASS: TestGetClientIP/X-Real-IP (0.00s)
    --- PASS: TestGetClientIP/RemoteAddr (0.00s)
    --- PASS: TestGetClientIP/X-Forwarded-For_multiple_IPs (0.00s)
=== RUN   TestAuditLog
--- PASS: TestAuditLog (0.00s)
=== RUN   TestLogAuditEntry
--- PASS: TestLogAuditEntry (0.00s)
=== RUN   TestJSONResponse
--- PASS: TestJSONResponse (0.00s)
=== RUN   TestErrorResponse
--- PASS: TestErrorResponse (0.00s)
=== RUN   TestSuccessResponse
--- PASS: TestSuccessResponse (0.00s)
=== RUN   TestParsePodParams
=== RUN   TestParsePodParams/valid_params
=== RUN   TestParsePodParams/missing_namespace
=== RUN   TestParsePodParams/missing_pod
=== RUN   TestParsePodParams/invalid_namespace
--- PASS: TestParsePodParams (0.00s)
    --- PASS: TestParsePodParams/valid_params (0.00s)
    --- PASS: TestParsePodParams/missing_namespace (0.00s)
    --- PASS: TestParsePodParams/missing_pod (0.00s)
    --- PASS: TestParsePodParams/invalid_namespace (0.00s)
=== RUN   TestValidateNamespace
=== RUN   TestValidateNamespace/valid_namespace
=== RUN   TestValidateNamespace/valid_namespace_with_hyphen
=== RUN   TestValidateNamespace/empty_namespace
=== RUN   TestValidateNamespace/namespace_with_uppercase
=== RUN   TestValidateNamespace/namespace_with_dots
=== RUN   TestValidateNamespace/namespace_starting_with_hyphen
=== RUN   TestValidateNamespace/namespace_too_long
--- PASS: TestValidateNamespace (0.00s)
    --- PASS: TestValidateNamespace/valid_namespace (0.00s)
    --- PASS: TestValidateNamespace/valid_namespace_with_hyphen (0.00s)
    --- PASS: TestValidateNamespace/empty_namespace (0.00s)
    --- PASS: TestValidateNamespace/namespace_with_uppercase (0.00s)
    --- PASS: TestValidateNamespace/namespace_with_dots (0.00s)
    --- PASS: TestValidateNamespace/namespace_starting_with_hyphen (0.00s)
    --- PASS: TestValidateNamespace/namespace_too_long (0.00s)
=== RUN   TestValidateResourceName
=== RUN   TestValidateResourceName/valid_resource_name
=== RUN   TestValidateResourceName/valid_resource_name_with_dots
=== RUN   TestValidateResourceName/empty_resource_name
=== RUN   TestValidateResourceName/resource_name_with_uppercase
=== RUN   TestValidateResourceName/resource_name_starting_with_hyphen
=== RUN   TestValidateResourceName/resource_name_too_long
--- PASS: TestValidateResourceName (0.00s)
    --- PASS: TestValidateResourceName/valid_resource_name (0.00s)
    --- PASS: TestValidateResourceName/valid_resource_name_with_dots (0.00s)
    --- PASS: TestValidateResourceName/empty_resource_name (0.00s)
    --- PASS: TestValidateResourceName/resource_name_with_uppercase (0.00s)
    --- PASS: TestValidateResourceName/resource_name_starting_with_hyphen (0.00s)
    --- PASS: TestValidateResourceName/resource_name_too_long (0.00s)
=== RUN   TestValidatePath
=== RUN   TestValidatePath/valid_relative_path
=== RUN   TestValidatePath/empty_path
=== RUN   TestValidatePath/path_with_..
=== RUN   TestValidatePath/path_with_/
=== RUN   TestValidatePath/path_with_\
=== RUN   TestValidatePath/path_with_URL_encoded_..
=== RUN   TestValidatePath/path_with_protocol
=== RUN   TestValidatePath/path_with_file_protocol
--- PASS: TestValidatePath (0.00s)
    --- PASS: TestValidatePath/valid_relative_path (0.00s)
    --- PASS: TestValidatePath/empty_path (0.00s)
    --- PASS: TestValidatePath/path_with_.. (0.00s)
    --- PASS: TestValidatePath/path_with_/ (0.00s)
    --- PASS: TestValidatePath/path_with_\ (0.00s)
    --- PASS: TestValidatePath/path_with_URL_encoded_.. (0.00s)
    --- PASS: TestValidatePath/path_with_protocol (0.00s)
    --- PASS: TestValidatePath/path_with_file_protocol (0.00s)
=== RUN   TestValidatePodName
=== RUN   TestValidatePodName/valid_pod_name
=== RUN   TestValidatePodName/empty_pod_name
=== RUN   TestValidatePodName/pod_name_with_dots
=== RUN   TestValidatePodName/pod_name_with_uppercase
--- PASS: TestValidatePodName (0.00s)
    --- PASS: TestValidatePodName/valid_pod_name (0.00s)
    --- PASS: TestValidatePodName/empty_pod_name (0.00s)
    --- PASS: TestValidatePodName/pod_name_with_dots (0.00s)
    --- PASS: TestValidatePodName/pod_name_with_uppercase (0.00s)
=== RUN   TestValidateContainerName
=== RUN   TestValidateContainerName/valid_container_name
=== RUN   TestValidateContainerName/empty_container_name
=== RUN   TestValidateContainerName/container_name_with_dots
--- PASS: TestValidateContainerName (0.00s)
    --- PASS: TestValidateContainerName/valid_container_name (0.00s)
    --- PASS: TestValidateContainerName/empty_container_name (0.00s)
    --- PASS: TestValidateContainerName/container_name_with_dots (0.00s)
PASS
ok  	github.com/flaucha/DKonsole/backend/internal/utils	(cached)
FAIL
